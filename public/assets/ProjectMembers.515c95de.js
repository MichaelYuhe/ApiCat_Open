var ne=Object.defineProperty,re=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var H=(a,t,e)=>t in a?ne(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,x=(a,t)=>{for(var e in t||(t={}))ie.call(t,e)&&H(a,e,t[e]);if(G)for(var e of G(t))ue.call(t,e)&&H(a,e,t[e]);return a},R=(a,t)=>re(a,le(t));import{K as ce,L as de,M as me,v as pe,e as fe,d as he,E as K,l as ge,I as _e,J as ye,g as be,h as ve,i as Se,f as q,H as Ce}from"./element-plus.85f938a9.js";import{b as O,u as ke,x as V,z as J,a as we,B as A,d as W,C as je,E as Pe,F as Me,G as Le,H as Te}from"./index.a22b0d3c.js";import{o as u,f as b,R as Ee,W as v,X as _,T as C,U as j,an as E,H as $,Z as c,a3 as Be,v as xe,aa as Re,G as z,aT as D,t as F,u as S,B as Ke,r as w,aZ as Ae,b0 as Ie,bf as I,ai as L,h as Z,$ as X,av as Oe}from"./vendor.b27f3889.js";import{u as Ve}from"./usePage.a5962d78.js";const ze={name:"AcTable",props:{isShowIndex:{type:Boolean,default:!1},isShowSelection:{type:Boolean,default:!1},columns:{type:Array,default:()=>[]},tableData:{type:Array,default:()=>[]},pageSize:{type:Number,default:()=>15},pageTotal:{type:Number,default:()=>0},pageCount:{type:Number,default:()=>0},currentPage:{type:Number,default:()=>1},loading:{type:Boolean,default:!1},isShowPager:{type:Boolean,default:!0},emptyText:{type:String,default:"\u6682\u65E0\u6570\u636E"},dataKey:{type:Object,default:()=>({label:"title",prop:"key"})}},setup(a,t){const{emit:e}=t;return{handleSizeChange:r=>e("size-change",r),handleCurrentChange:r=>{e("update:currentPage",a.currentPage),e("current-change",r)},handleSelectionChange:r=>e("selection-change",r)}}},De={class:"ac-table"},Fe={key:0,class:"mt-4 flex justify-end"};function Ne(a,t,e,p,o,d){const r=ce,m=de,s=me,y=pe;return u(),b("div",De,[Ee((u(),v(m,{data:e.tableData,"empty-text":e.emptyText,onSelectionChange:p.handleSelectionChange},{default:_(()=>[e.isShowIndex?(u(),v(r,{key:0,type:"index",width:"50",label:"\u5E8F\u53F7"})):C("",!0),e.isShowSelection?(u(),v(r,{key:1,type:"selection",width:"55"})):C("",!0),(u(!0),b(j,null,E(e.columns,n=>(u(),b(j,{key:n.prop},[n[e.dataKey.label]&&!n.slot?(u(),v(r,{key:0,prop:n[e.dataKey.prop],"show-overflow-tooltip":"",label:n[e.dataKey.label],formatter:n.render||n.formatter,width:n.width},null,8,["prop","label","formatter","width"])):C("",!0),n.slot&&n[e.dataKey.label]?$(a.$slots,n.slot,{key:1}):C("",!0)],64))),128)),$(a.$slots,"operation")]),_:3},8,["data","empty-text","onSelectionChange"])),[[y,e.loading]]),e.isShowPager&&e.pageTotal?(u(),b("div",Fe,[c(s,{"page-size":e.pageSize,layout:"prev, pager, next",total:e.pageTotal,"current-page":e.currentPage,"onUpdate:current-page":t[0]||(t[0]=n=>e.currentPage=n),onSizeChange:p.handleSizeChange,onCurrentChange:p.handleCurrentChange},null,8,["page-size","total","current-page","onSizeChange","onCurrentChange"])])):C("",!0)])}var Q=O(ze,[["render",Ne]]);const Y=(a,t={isLoaded:!0,dataKey:"data",totalKey:"total"})=>{const{isLoaded:e=!0,searchParam:p={},dataKey:o,totalKey:d}=t,[r,m]=ke(a,{isShowMessage:!1}),s=Be({data:[],total:0}),{page:y}=Ve(()=>n()),n=async()=>{const f=await m(R(x({},p),{page:y.value}));f&&f.data?(s.data=f.data[o]||[],s.total=f.data[d]||1):(s.data=[],s.total=0)};return e&&xe(async()=>{await n()}),R(x({isLoading:r,currentPage:y},Re(s)),{getTableData:n})};var Ue=z({emits:["on-success"],setup(a,{emit:t}){const e=[{title:"\u59D3\u540D",key:"name"},{title:"\u90AE\u7BB1",key:"email"},{title:"\u89D2\u8272",render:f=>c("span",{class:"text dis_hover"},[f.authority_name])}],p={project_id:""},o=V(),{projectInfo:d}=D(o),{isLoading:r,total:m,currentPage:s,data:y,getTableData:n}=Y(J,{searchParam:p,totalKey:"total_members",dataKey:"project_members",isLoaded:!1});return F(()=>d.value,async()=>{d.value&&d.value.id&&(p.project_id=d.value.id,await n(),t("on-success",m.value||0))},{immediate:!0}),(f,l)=>{const h=Q;return u(),v(h,{loading:S(r),"table-data":S(y),"page-total":S(m),"current-page":S(s),"onUpdate:current-page":l[0]||(l[0]=k=>Ke(s)?s.value=k:null),columns:e,class:"pb-3"},null,8,["loading","table-data","page-total","current-page"])}}});I.configure({showSpinner:!1});var Ge=z({emits:["on-remove","on-success"],setup(a,{emit:t}){const e={project_id:""},p=V(),{projectInfo:o}=D(p),d=we(),r=w(),m=w(!1),s=w(),y=A,n=Ae();let f=null;const{isLoading:l,currentPage:h,data:k,total:T,getTableData:M}=Y(J,{searchParam:e,totalKey:"total_members",dataKey:"project_members",isLoaded:!1}),ee=[{title:"\u59D3\u540D",key:"name"},{title:"\u90AE\u7BB1",key:"email"},{title:"\u89D2\u8272",render:i=>d.userInfo.user_id===i.user_id?c("span",null,[i.authority_name]):c("a",{class:"inline-flex items-center el-icon__more",onClick:g=>te(g,i),"data-role":i.authority,href:"javascript:void(0)"},[c("span",null,[i.authority_name]),c(fe,null,{default:()=>[c(he,null,null)]})])},{title:"\u64CD\u4F5C",width:160,render:i=>{if(i.authority===0)return[];let g=[];return i.authority!==2&&g.push(c("span",{class:"cursor-pointer text-blue-600 mr-2",onClick:()=>ae(i)},[L("\u79FB\u4EA4\u9879\u76EE")])),d.userInfo.user_id!==i.user_id&&g.push(c("span",{class:"cursor-pointer text-red-400",onClick:()=>oe(i)},[L("\u79FB\u9664\u6210\u5458")])),g}}],te=(i,g)=>{f=g,r.value=i.currentTarget,m.value=!0},ae=i=>{W({title:"\u79FB\u4EA4\u63D0\u793A",content:"\u786E\u5B9A\u5C06\u9879\u76EE\u79FB\u4EA4\u7ED9\u8BE5\u6210\u5458\u5417\uFF1F",onOk:g=>je(o.value.id,i.user_id).then(P=>{K.success(P.msg||"\u79FB\u4EA4\u6210\u529F\uFF01"),n.replace({name:"projects"})}).catch(()=>g())})},oe=i=>{W({title:"\u5220\u9664\u63D0\u793A",content:"\u786E\u5B9A\u79FB\u9664\u8BE5\u6210\u5458\u5417\uFF1F",onOk:()=>Pe(o.value.id,i.user_id).then(g=>{K.success(g.msg||"\u79FB\u9664\u6210\u529F\uFF01"),t("on-remove"),M()})})},se=i=>{I.start(),Me({authority:i.value,user_id:f.user_id,project_id:o.value.id}).then(g=>{K.success(g.msg||"\u6743\u9650\u4FEE\u6539\u6210\u529F\uFF01"),f.authority=i.value,f.authority_name=i.text}).catch(()=>{}).finally(()=>{I.done()})};return Ie(r,i=>{var N,U;const P=i.target.parentNode,B=P.parentNode;((N=P==null?void 0:P.classList)==null?void 0:N.contains("el-icon__more"))||((U=B==null?void 0:B.classList)==null?void 0:U.contains("el-icon__more"))||(m.value=!1)}),F(()=>o.value,async()=>{o.value&&o.value.id&&(e.project_id=o.value.id,await M(),t("on-success",T.value||0))},{immediate:!0}),{isLoading:l,roles:y,project:o,members:k,currentPage:h,total:T,columns:ee,popoverRef:s,isShowPopover:m,rolePopperRef:r,onRoleItemClick:se,getTableData:M}}});const He=["onClick"];function We(a,t,e,p,o,d){const r=Q,m=ge;return u(),b(j,null,[c(r,{loading:a.isLoading,"table-data":a.members,"page-total":a.total,"current-page":a.currentPage,"onUpdate:current-page":t[0]||(t[0]=s=>a.currentPage=s),columns:a.columns,class:"pb-3"},null,8,["loading","table-data","page-total","current-page","columns"]),c(m,{ref:"popoverRef","popper-class":"ac-popper-menu",width:"auto",visible:a.isShowPopover,"onUpdate:visible":t[1]||(t[1]=s=>a.isShowPopover=s),"virtual-ref":a.rolePopperRef,"virtual-triggering":""},{default:_(()=>[Z("ul",null,[(u(!0),b(j,null,E(a.roles,s=>(u(),b("li",{key:s.value,class:"ac-popper-menu__item",onClick:y=>a.onRoleItemClick(s)},X(s.text),9,He))),128))])]),_:1},8,["visible","virtual-ref"])],64)}var $e=O(Ge,[["render",We]]);const qe={emits:["on-ok"],props:{members:{type:Array,default:()=>[]},project:{type:Object,default:()=>({})}},data(){return{isShow:!1,isLoading:!1,roles:A,form:{user_ids:[],authority:A[0].value},rules:{user_ids:{required:!0,message:"\u8BF7\u9009\u62E9\u9700\u8981\u6DFB\u52A0\u7684\u6210\u5458",trigger:"change",type:"array"}}}},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{show(a){this.form.project_id=a.id,this.isShow=!0},hide(){this.isShow=!1},onCloseBtnClick(){this.isShow=!1,this.reset()},reset(){this.$refs.teamForm.resetFields()},handleSubmit(a){this.$refs[a].validate(t=>t&&this.submit())},submit(){this.isLoading=!0,Le(this.form).then(a=>{this.$Message.success(a.msg||"\u6DFB\u52A0\u6210\u5458\u6210\u529F!"),this.hide(),this.$emit("on-ok")}).catch(a=>{}).finally(()=>{this.isLoading=!1})}}},Je=L("\u53D6\u6D88"),Ze=L("\u786E\u5B9A");function Xe(a,t,e,p,o,d){const r=_e,m=ye,s=be,y=ve,n=q,f=Se;return u(),v(f,{modelValue:o.isShow,"onUpdate:modelValue":t[5]||(t[5]=l=>o.isShow=l),width:340,"close-on-click-modal":!1,title:"\u6DFB\u52A0\u6210\u5458","append-to-body":"","custom-class":"show-footer-line vertical-center-modal"},{footer:_(()=>[c(n,{onClick:t[3]||(t[3]=l=>d.onCloseBtnClick())},{default:_(()=>[Je]),_:1}),c(n,{loading:o.isLoading,type:"primary",onClick:t[4]||(t[4]=l=>d.handleSubmit("teamForm"))},{default:_(()=>[Ze]),_:1},8,["loading"])]),default:_(()=>[c(y,{onKeyup:t[2]||(t[2]=Oe(l=>d.handleSubmit("teamForm"),["enter"])),ref:"teamForm",model:o.form,rules:o.rules,"label-position":"top",style:{"margin-bottom":"-19px"}},{default:_(()=>[c(s,{label:"\u9009\u62E9\u6210\u5458",prop:"user_ids",class:"hide_required"},{default:_(()=>[c(m,{modelValue:o.form.user_ids,"onUpdate:modelValue":t[0]||(t[0]=l=>o.form.user_ids=l),placeholder:"\u9009\u62E9\u6210\u5458","no-data-text":"\u6682\u65E0\u6210\u5458",filterable:"",multiple:"",clearable:"",class:"w-full"},{default:_(()=>[(u(!0),b(j,null,E(e.members,l=>(u(),v(r,{value:l.user_id,key:l.user_id,label:l.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),c(s,{label:"\u6743\u9650",prop:"authority"},{default:_(()=>[c(m,{modelValue:o.form.authority,"onUpdate:modelValue":t[1]||(t[1]=l=>o.form.authority=l),class:"w-full"},{default:_(()=>[(u(!0),b(j,null,E(o.roles,l=>(u(),v(r,{value:l.value,key:l.value,label:l.text},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var Qe=O(qe,[["render",Xe]]);const Ye={key:0,class:"absolute right-2",style:{top:"7px"}},et=L("\u6DFB\u52A0\u6210\u5458");var rt=z({setup(a){const t=V(),{projectInfo:e,isManager:p}=D(t),o=w([]),d=w(),r=w(),m=w(0),s=()=>{var h;(h=d.value)==null||h.show(e.value)},y=async()=>{var h;(h=r.value)==null||h.getTableData(),await l()},n=async()=>{await l()},f=h=>{m.value=h},l=async()=>{const{id:h}=e.value||{};if(!!p)try{const{data:k}=await Te(h);o.value=k||[]}catch{o.value=[]}};return F(()=>e.value,async()=>{e.value&&e.value.id&&await l()},{immediate:!0}),(h,k)=>{const T=q,M=Ce;return u(),b(j,null,[c(M,{shadow:"never","body-style":{padding:0}},{header:_(()=>[Z("span",null,"\u6210\u5458\u5217\u8868"+X(m.value?`(${m.value})`:""),1),S(p)?(u(),b("div",Ye,[c(T,{onClick:s,type:"primary"},{default:_(()=>[et]),_:1})])):C("",!0)]),default:_(()=>[S(e)&&S(p)?(u(),v($e,{key:0,ref_key:"projectMembersManage",ref:r,onOnRemove:n,onOnSuccess:f},null,512)):C("",!0),S(e)&&!S(p)?(u(),v(Ue,{key:1,onOnSuccess:f})):C("",!0)]),_:1}),c(Qe,{members:o.value,ref_key:"addProjectMemberModal",ref:d,onOnOk:y},null,8,["members"])],64)}}});export{rt as default};
