var Zo=Object.defineProperty,Xo=Object.defineProperties;var es=Object.getOwnPropertyDescriptors;var qt=Object.getOwnPropertySymbols;var ts=Object.prototype.hasOwnProperty,os=Object.prototype.propertyIsEnumerable;var mt=(e,t,s)=>t in e?Zo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,V=(e,t)=>{for(var s in t||(t={}))ts.call(t,s)&&mt(e,s,t[s]);if(qt)for(var s of qt(t))os.call(t,s)&&mt(e,s,t[s]);return e},ve=(e,t)=>Xo(e,es(t));var T=(e,t,s)=>(mt(e,typeof t!="symbol"?t+"":t,s),s);import{aQ as Fe,o as d,f as g,aR as at,aS as ct,h as a,G as q,aT as ue,u as k,W as O,T as j,Z as h,aU as ss,U as G,r as I,aV as lt,aW as ao,aX as D,aY as ns,aZ as xe,v as dt,ac as Y,X as m,an as oe,ai as U,$ as M,V as L,t as re,a2 as rs,q as ne,H as st,az as is,aA as as,a_ as fe,a$ as cs,_ as se,P as rt,b0 as co,A as ls,R as X,S as ie,b1 as ds,b2 as us,b3 as lo,a3 as jt,aa as uo,p as le,b4 as hs,m as Re,b5 as Rt,am as It,aP as ps,b6 as Ye,b7 as fs,b8 as _s,b9 as Ie,k as bt,ba as gt,bb as ms,n as ho,l as gs,d as vs,a0 as po,Y as ys,L as Qt,y as As,Q as Cs,bc as we,bd as fo,as as xt,be as Es,bf as Ae,bg as Zt,aw as _o,av as mo,I as ks,bh as ws,bi as go,bj as Ns,bk as Is,bl as bs,bm as Ds,bn as Ps,bo as Xt,aM as Ss,bp as js}from"./vendor.be35f7a8.js";import{E as pe,a as Rs,b as xs,c as Ts,d as Ls,e as Te,f as Je,g as Tt,h as Lt,i as We,j as ut,k as Ot,l as Mt,m as Os,n as Ms,o as vo,p as Bs,q as $s,_ as Fs,v as ht,r as yo,s as Ao,t as eo,u as Co,w as Eo,x as Ks,y as Vs,z as Us,A as ko,B as Gs,C as Ys,D as Hs,F as wo}from"./element-plus.071360b2.js";const zs=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}};zs();const Js=Fe({id:"app.store",state:()=>({isShowLoading:!1}),actions:{showLoading(){this.isShowLoading=!0},hideLoading(){this.isShowLoading=!1}}});var H=(e,t)=>{const s=e.__vccOpts||e;for(const[o,n]of t)s[o]=n;return s};const Ws={},qs=e=>(at("data-v-2dbca8a7"),e=e(),ct(),e),Qs={class:"vertical-center splash"},Zs=qs(()=>a("div",{class:"w-full text-center text-light"},[a("svg",{class:"spin",style:{width:"70px"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},[a("path",{id:"p",fill:"#006bff",d:"M94.1 58.8c.6-2.8.9-5.8.9-8.8s-.3-6-.9-8.8l-11.7-.4c-.7-2.6-1.7-5-3-7.3l8-8.5c-3.3-4.9-7.5-9.2-12.5-12.5l-8.5 8c-2.3-1.3-4.7-2.3-7.3-3l-.3-11.6C56 5.3 53 5 50 5s-6 .3-8.8.9l-.4 11.7c-2.6.7-5 1.7-7.3 3l-8.5-8c-4.9 3.3-9.2 7.5-12.5 12.5l8 8.5c-1.3 2.3-2.3 4.7-3 7.3l-11.6.3C5.3 44 5 47 5 50s.3 6 .9 8.8l11.7.4c.7 2.6 1.7 5 3 7.3l-8 8.5c3.3 4.9 7.5 9.2 12.5 12.5l8.5-8c2.3 1.3 4.7 2.3 7.3 3l.4 11.7c2.7.5 5.7.8 8.7.8s6-.3 8.8-.9l.4-11.7c2.6-.7 5-1.7 7.3-3l8.5 8c4.9-3.3 9.2-7.5 12.5-12.5l-8-8.5c1.3-2.3 2.3-4.7 3-7.3l11.6-.3zM50 66.9c-9.3 0-16.9-7.6-16.9-16.9S40.7 33.1 50 33.1 66.9 40.7 66.9 50 59.3 66.9 50 66.9z"})])],-1)),Xs=[Zs];function en(e,t){return d(),g("div",Qs,Xs)}var tn=H(Ws,[["render",en],["__scopeId","data-v-2dbca8a7"]]);const on=q({setup(e){const t=Js(),{isShowLoading:s}=ue(t);return(o,n)=>(d(),g(G,null,[k(s)?(d(),O(tn,{key:0})):j("",!0),h(k(ss))],64))}}),sn="/",He="/login",Bt="/register",$t="/main",de={path:"/404"},Ft="document",No="/project/:project_id",nn=No,Io="/project/:project_id/setting",bo="/project/:project_id/members",Do="/project/:project_id/params",Po="/project/:project_id/trash",Kt="preview.project",Vt=`${Kt}.verification`,ze="preview.document",it=`${ze}.verification`,Pe="document.api.edit",Se="document.api.detail",Ut="/project/:project_id/doc/:node_id?",So="/project/:project_id/doc/:node_id/edit";var qe="/assets/logo.1c8e1405.svg";function rn(e,t){t=V({isCatch:!0,isShowMessage:!0},t);const s=I(!1),{isCatch:o,isShowMessage:n,msg:r}=t;async function i(c){s.value=!0;try{const l=await e(c)||{};return n&&(r||l.msg)&&pe.success(r||l.msg),l}catch(l){if(o)return{};throw l}finally{s.value=!1}}return[s,i]}const an="/api",cn=1e3*10,id=15;var Oe=(e=>(e[e.OK=0]="OK",e[e.FAIL=-1]="FAIL",e[e.NO_LOGIN=-2]="NO_LOGIN",e[e.NO_PARENT_DIR=-102]="NO_PARENT_DIR",e[e.NO_EXIST_TEAM=-100]="NO_EXIST_TEAM",e[e.INVALID_PREVIEW_SECRET=-103]="INVALID_PREVIEW_SECRET",e[e.NOT_FOUND=-404]="NOT_FOUND",e))(Oe||{});const be={DIR:0,DOC:1,HTTP:1,OTHER:2,MARKDOWN:3},ad={API:{text:"\u63A5\u53E3\u6587\u6863",key:"api.doc",value:1},DB:{text:"\u6570\u636E\u5E93\u6587\u6863",key:"db.doc",value:2}},Me={WAIT:"wait",FINISH:"finish",FAIL:"fail"},W={ADMIN:"admin",MANAGER:"manage",DEVELOPER:"write",READER:"read",NONE:"none"},vt={MANAGER:0,DEVELOPER:1,READER:2},ln=[{text:"\u56E2\u961F\u7BA1\u7406\u5458",value:999,key:W.ADMIN},{text:"\u7BA1\u7406\u8005",value:vt.MANAGER,key:W.MANAGER},{text:"\u7EF4\u62A4\u8005",value:vt.DEVELOPER,key:W.DEVELOPER},{text:"\u9605\u8BFB\u8005",value:vt.READER,key:W.READER}],cd=ln.filter(e=>[W.DEVELOPER,W.READER].indexOf(e.key)!==-1),ld="/static/icon-project.png",Ce={PRIVATE:"private",PUBLIC:"public"},to=[{text:"\u79C1\u6709",value:0,key:Ce.PRIVATE},{text:"\u516C\u5F00",value:1,key:Ce.PUBLIC}],Ue={PRIVATE:0,PUBLIC:1},Be={ADMIN:0,MANAGER:1,NORMAL:2},dn=[{text:"\u7BA1\u7406\u5458",value:Be.MANAGER},{text:"\u666E\u901A\u6210\u5458",value:Be.NORMAL}];[Be.ADMIN,...dn];const jo={baseURL:an,headers:{Accept:"application/json, text/plain, */*"}};lt.defaults.timeout=cn;var E=lt.create(jo);const Dt=lt.create(jo),un=(e={})=>E.post("/email_login",V({},e)),hn=(e={})=>E.post("/email_register",V({},e)),pn=()=>E.post("/logout"),dd=(e={})=>E.post("/user/change_avatar",e),fn=(e={})=>E.post("/user/change_profile",V({},e)),_n=()=>E.get("/user/profile").then(e=>{if(e.data){const{name:t,avatar:s}=e.data;s||(e.data.lastName=ao(t||"\u65E0"))}return e}),ud=()=>rn((e={})=>E.post("/user/change_password",V({},e))),De=Fe({id:"user",state:()=>({token:D.get(D.KEYS.TOKEN)||null,userInfo:D.get(D.KEYS.USER_INFO)||{}}),getters:{isLogin:e=>!!e.token,isAdmin:e=>e.userInfo.authority===Be.ADMIN,isManager:e=>e.userInfo.authority===Be.MANAGER,isNormal:e=>e.userInfo.authority===Be.NORMAL,lastName:e=>ao(e.userInfo.name)},actions:{updateToken(e){D.set(D.KEYS.TOKEN,e),this.token=e},async login(e){try{const t=await un(e);return await this.getUserInfo(),this.goHome(),t}catch{}},async register(e){try{const t=await hn(e);return this.goHome(),t}catch{}},async logout(){D.removeAll([D.KEYS.TOKEN,D.KEYS.USER_INFO,D.KEYS.ACTIVE_PROJECT_GROUP]);try{await pn()}catch{}finally{this.token=null,this.userInfo={},location.href=He}},async getUserInfo(){if(!ns.exports.isEmpty(this.userInfo))return this.userInfo;try{const{data:e}=await _n()||{};return D.set(D.KEYS.USER_INFO,e),this.userInfo=e,this.userInfo}catch{}return{}},goHome(e){Ee.replace(e||$t)},async updateUserInfo(e){await fn(e),this.$patch({userInfo:{name:e.name,email:e.email,avatar:e.avatar}}),D.set(D.KEYS.USER_INFO,this.userInfo)}}}),mn={class:"h-14"},gn={class:"shadow bg-white fixed top-0 w-full z-50"},vn={class:"viewport relative flex items-center justify-between h-14"},yn={class:"flex-1 flex items-center"},An=a("img",{class:"h-10 w-auto",src:qe,alt:"ApiCat"},null,-1),Cn=a("span",{class:"logo-text logo-apicat"},"ApiCat",-1),En={class:"ml-6"},kn={class:"flex items-center"},wn={class:"ml-3 relative"},Nn={class:"el-dropdown-link"},In={type:"button",class:"flex items-center rounded-full","aria-expanded":"false","aria-haspopup":"true"},bn=["src"],Dn={key:1},Pn={class:"flex flex-col divide-y text-sm justify-center"},Sn={class:"px-6 py-2"},jn=["title"],Rn=["title"],xn={class:"ml-1"},Tn=a("i",{class:"iconfont iconIconPopoverExit"},null,-1),Ln=a("span",{class:"ml-1"},"\u9000\u51FA\u767B\u5F55",-1),On=[Tn,Ln],Mn=q({setup(e){const t={modifiers:[{name:"offset",options:{offset:[-24,10]}}]},s=I([{name:"user.profile",title:"\u4E2A\u4EBA\u4FE1\u606F",icon:"iconIconPopoverUser"}]),o=[{name:"projects",title:"\u9879\u76EE",active:"project"},{name:"members",title:"\u6210\u5458"}],n=De(),{currentRoute:r}=xe(),{userInfo:i,lastName:c}=ue(n),l=async()=>{await n.logout()},f=y=>["px-3",{"text-blue-600":(r.value.name||"").startsWith(y.active||y.name)}];return dt(async()=>{await n.getUserInfo()}),(y,p)=>{const A=Y("router-link"),C=Rs,u=Te,_=xs,v=Ts;return d(),g("header",mn,[a("div",gn,[a("div",vn,[a("div",yn,[h(A,{class:"inline-flex items-center",to:"/main"},{default:m(()=>[An,Cn]),_:1}),a("div",En,[(d(),g(G,null,oe(o,N=>h(A,{to:{name:N.name},key:N.name,class:L(f(N))},{default:m(()=>[U(M(N.title),1)]),_:2},1032,["to","class"])),64))])]),a("div",kn,[a("div",wn,[h(v,{placement:"bottom-end",trigger:"click","popper-class":"nav-dropdown","popper-options":t},{dropdown:m(()=>[h(_,null,{default:m(()=>[a("div",Pn,[a("div",Sn,[a("p",{class:"text-base font-bold text-gray-600 truncate",title:k(i).name},M(k(i).name),9,jn),a("p",{class:"text-gray-500 truncate",title:k(i).email},M(k(i).email),9,Rn)]),(d(!0),g(G,null,oe(s.value,N=>(d(),O(A,{key:N.name,class:"flex items-center px-6 py-3 hover:text-gray-700",to:{name:N.name}},{default:m(()=>[a("i",{class:L("iconfont "+N.icon)},null,2),a("span",xn,M(N.title),1)]),_:2},1032,["to"]))),128)),a("a",{class:"flex items-center px-6 py-3 hover:text-gray-700",href:"javascript:void(0)",onClick:l},On)])]),_:1})]),default:m(()=>[a("span",Nn,[a("button",In,[h(C,null,{default:m(()=>[k(i).avatar?(d(),g("img",{key:0,src:k(i).avatar},null,8,bn)):(d(),g("span",Dn,M(k(c)),1))]),_:1}),h(u,{class:"el-icon--right"},{default:m(()=>[h(k(Ls))]),_:1})])])]),_:1})])])])])])}}}),Bn={class:"viewport px-8 py-4"},$n=q({setup(e){return(t,s)=>{const o=Y("router-view");return d(),g(G,null,[h(Mn),a("main",Bn,[h(o)])],64)}}}),Fn="modulepreload",oo={},Kn="/",z=function(t,s){return!s||s.length===0?t():Promise.all(s.map(o=>{if(o=`${Kn}${o}`,o in oo)return;oo[o]=!0;const n=o.endsWith(".css"),r=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${r}`))return;const i=document.createElement("link");if(i.rel=n?"stylesheet":Fn,n||(i.as="script",i.crossOrigin=""),i.href=o,document.head.appendChild(i),n)return new Promise((c,l)=>{i.addEventListener("load",c),i.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t())};const ye=e=>(at("data-v-47f509cc"),e=e(),ct(),e),Vn={class:"h-14"},Un={class:"shadow bg-white fixed top-0 w-full z-50"},Gn={class:"viewport relative items-center justify-between h-14 lg:flex hidden"},Yn={class:"flex-1 flex items-center"},Hn=ye(()=>a("div",{class:"flex-shrink-0 flex"},[a("a",{class:"inline-flex items-center",href:"/"},[a("img",{class:"h-10 w-auto",src:qe,alt:"ApiCat"}),a("span",{class:"logo-text logo-apicat"},"ApiCat")])],-1)),zn={key:0,class:"ml-6 hidden lg:block"},Jn=ye(()=>a("div",{class:"flex text-gray-600"},[a("a",{href:"https://apicat.net",target:"_blank",class:"px-3 py-2 rounded-md text-sm"},"\u9996\u9875"),a("a",{href:"https://apicat.net/app/31eb8ec8c295c8c4130ee50304d55ab5",target:"_blank",class:"px-3 py-2 rounded-md text-sm"},"\u6587\u6863"),a("a",{href:"https://github.com/NatosoftCN/ApiCat_Open",target:"_blank",class:"px-3 py-2 rounded-md text-sm"},"Github")],-1)),Wn=[Jn],qn={key:0},Qn=U("\u767B\u5F55"),Zn=U("\u6CE8\u518C"),Xn={class:"lg:hidden"},er={class:"flex items-center justify-between h-14 px-4 relative"},tr=ye(()=>a("img",{class:"h-10 w-auto",src:qe,alt:"ApiCat"},null,-1)),or=ye(()=>a("span",{class:"logo-text logo-apicat"},"ApiCat",-1)),sr=ye(()=>a("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",style:{"font-size":"24px"},fill:"currentColor"},[a("path",{d:"M21 7H3V5H21V7Z","fill-rule":"evenodd","clip-rule":"evenodd",fill:"currentColor"}),a("path",{d:"M21 13H3V11H21V13Z","fill-rule":"evenodd","clip-rule":"evenodd",fill:"currentColor"}),a("path",{d:"M21 19H3V17H21V19Z","fill-rule":"evenodd","clip-rule":"evenodd",fill:"currentColor"})],-1)),nr=[sr],rr={key:0,class:"bg-white fixed top-0 left-0 w-full max-h-screen flex flex-col z-10"},ir={class:"flex items-center justify-between h-14 px-4"},ar=ye(()=>a("img",{class:"h-10 w-auto",src:qe,alt:"ApiCat"},null,-1)),cr=ye(()=>a("span",{class:"logo-text logo-apicat"},"ApiCat",-1)),lr=ye(()=>a("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",style:{"font-size":"24px"},fill:"currentColor"},[a("path",{d:"M12.0001 13.4141L17.6568 19.0708L19.0711 17.6566L13.4143 11.9998L19.0711 6.34304L17.6569 4.92883L12.0001 10.5856L6.34314 4.92871L4.92893 6.34292L10.5859 11.9998L4.92896 17.6567L6.34317 19.071L12.0001 13.4141Z","fill-rule":"evenodd","clip-rule":"evenodd",fill:"currentColor"})],-1)),dr=[lr],ur={class:"flex-1 overflow-y-auto"},hr=ye(()=>a("div",{class:"px-4 text-base font-medium"},[a("a",{class:"px-3 py-2 mb-1 rounded-lg block",href:"/"},"\u9996\u9875"),a("a",{class:"px-3 py-2 mb-1 rounded-lg block",href:"#"},"\u6587\u6863"),a("a",{class:"px-3 py-2 mb-1 rounded-lg block",href:"#"},"GitHub")],-1)),pr={class:"px-5"},fr=U("\u767B\u5F55"),_r=U("\u6CE8\u518C"),mr=q({props:{isShowNav:{type:Boolean,default:!0}},setup(e){const t=I(!1);return re(t,()=>{document.body.classList.toggle("overflow-hidden")}),(s,o)=>{const n=Je,r=Y("router-link");return d(),g("header",Vn,[a("div",Un,[a("div",Gn,[a("div",Yn,[Hn,e.isShowNav?(d(),g("div",zn,Wn)):j("",!0)]),e.isShowNav?(d(),g("div",qn,[h(r,{to:k(He),class:"mr-4"},{default:m(()=>[h(n,null,{default:m(()=>[Qn]),_:1})]),_:1},8,["to"]),h(r,{to:k(Bt)},{default:m(()=>[h(n,{type:"primary"},{default:m(()=>[Zn]),_:1})]),_:1},8,["to"])])):j("",!0)]),a("div",Xn,[a("div",er,[h(r,{class:"inline-flex items-center",to:"/"},{default:m(()=>[tr,or]),_:1}),a("div",{class:"cursor-pointer",onClick:o[0]||(o[0]=i=>t.value=!t.value)},nr),h(rs,{name:"slide-fade"},{default:m(()=>[t.value?(d(),g("div",rr,[a("div",ir,[h(r,{class:"inline-flex items-center",to:"/"},{default:m(()=>[ar,cr]),_:1}),a("div",{class:"cursor-pointer",onClick:o[1]||(o[1]=i=>t.value=!t.value)},dr)]),a("div",ur,[hr,a("div",pr,[h(r,{to:"/login"},{default:m(()=>[h(n,{class:"w-full"},{default:m(()=>[fr]),_:1})]),_:1}),h(r,{to:"/"},{default:m(()=>[h(n,{type:"primary",class:"w-full my-5"},{default:m(()=>[_r]),_:1})]),_:1})])])])):j("",!0)]),_:1}),t.value?(d(),g("div",{key:0,class:"fixed top-0 left-0 w-screen h-screen bg-opacity-40 bg-gray-900",onClick:o[2]||(o[2]=i=>t.value=!t.value)})):j("",!0)])])])])}}});var gr=H(mr,[["__scopeId","data-v-47f509cc"]]);const Ro=q({setup(e){const t=I(!0);return ne("switchNavState",o=>{t.value=o}),(o,n)=>{const r=Y("router-view");return d(),g(G,null,[h(gr,{"is-show-nav":t.value},null,8,["is-show-nav"]),h(r)],64)}}}),vr=()=>z(()=>import("./Index.69ce21ee.js"),["assets/Index.69ce21ee.js","assets/Index.46d30f47.css","assets/vendor.be35f7a8.js"]),yr=()=>z(()=>import("./Login.3bdec051.js"),["assets/Login.3bdec051.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js"]),Ar=()=>z(()=>import("./Register.9c85a847.js"),["assets/Register.9c85a847.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js"]),Cr=()=>z(()=>import("./NotFound.0653fa44.js"),["assets/NotFound.0653fa44.js","assets/NotFound.3339f423.css","assets/vendor.be35f7a8.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css"]),Er={path:sn,name:"index",component:Ro,meta:{ignoreAuth:!0},children:[{path:"",name:"index.feature",component:vr}]},kr={path:He,name:"login",meta:{ignoreAuth:!0},component:yr},wr={path:Bt,name:"register",meta:{ignoreAuth:!0},component:Ar},Nr={path:"/:path(.*)*",name:"error",component:Ro,meta:{ignoreAuth:!0},children:[{path:"/:path(.*)*",name:"error.not.found",component:Cr}]},Ir={class:"flex flex-col border divide-y bg-white"},br=q({props:{menus:{type:Array,default:()=>[]}},setup(e){return(t,s)=>{const o=Y("router-link");return d(),g("div",Ir,[(d(!0),g(G,null,oe(e.menus,n=>(d(),O(o,{key:n.name,to:{name:n.name},class:"relative h-12 pl-6 flex items-center text-neutral-600 hover:text-neutral-900"},{default:m(()=>[a("span",null,M(n.meta.title),1)]),_:2},1032,["to"]))),128))])}}}),Dr={},Pr={class:"flex justify-between flex-col lg:flex-row"},Sr={class:"sidebar-nav flex-none lg:w-64 mb-4 lg:mb-0"},jr={class:"flex-auto lg:ml-4 overflow-hidden"};function Rr(e,t){const s=br,o=Y("RouterView");return d(),g("div",Pr,[a("aside",Sr,[st(e.$slots,"default",{},()=>[h(s,is(as(e.$attrs)),null,16)])]),a("div",jr,[h(o)])])}var xo=H(Dr,[["render",Rr]]);const xr=q({setup(e){const t=I(To);return(s,o)=>(d(),O(xo,{menus:t.value},null,8,["menus"]))}}),Tr=()=>z(()=>import("./UserProfile.f89ca045.js"),["assets/UserProfile.f89ca045.js","assets/ImagePreview.2f24d34a.js","assets/ImagePreview.e9afec23.css","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js"]),Lr=()=>z(()=>import("./ModifyPassword.266c8dd5.js"),["assets/ModifyPassword.266c8dd5.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js"]),To=[{path:"profile",name:"user.profile",meta:{title:"\u4E2A\u4EBA\u4FE1\u606F"},component:Tr},{path:"password",name:"user.password",meta:{title:"\u4FEE\u6539\u5BC6\u7801"},component:Lr}];var Or={path:"/user",name:"user",redirect:{name:"user.profile"},component:xr,children:To};const Mr=()=>z(()=>import("./MemberList.b464e410.js"),["assets/MemberList.b464e410.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js","assets/usePage.b90d4e49.js"]);var Br={path:"/members",name:"members",component:Mr};const Ke=(e=!0)=>e?window.origin:"",hd=(e={})=>E.post("/project/create",e),pd=(e={})=>E.post("/project/icon",e),fd=e=>E.post("/project/remove",{project_id:e}),_d=e=>E.post("/project/quit",{project_id:e}),md=(e={})=>E.post("/project/add_member",e),gd=e=>E.get("/project/members",{params:e}),vd=(e,t)=>E.post("/project/remove_member",{project_id:e,user_id:t}),yd=(e,t)=>E.post("/project/transfer",{project_id:e,user_id:t}),Ad=(e={})=>E.post("/project/change_member_authority",e),$r=(e={})=>E.post("/project/setting",e),Fr=(e,t)=>E.post("/project/share",{project_id:e,share:t}),Kr=e=>E.post("/project/reset_share_secretkey",{project_id:e}),Cd=(e={})=>E.post("/doc/restore_api_doc",e),Ed=e=>E.get("/projects",{params:{group_id:e==0?"":e}}),Vr=e=>E.post("/project_group/create",e),Ur=()=>E.get("/project_groups"),Gr=e=>E.post("/project_group/remove",{id:e}),Yr=e=>E.post("/project_group/rename",e),Hr=e=>E.post("/project_group/change_order",{ids:e}),zr=(e,t)=>E.get("/project",{params:{project_id:e,token:t}}),Jr=e=>E.get("/project/status",{params:{project_id:e}}),kd=e=>E.post("/project/change_group",e),wd=e=>E.get("/doc/trash",{params:{project_id:e}}),Nd=e=>E.get("/project/without_members",{params:{project_id:e}}),so=(e,t)=>Ke(t)+fe(No)({project_id:e}),Wr=(e,t)=>Ke(t)+fe(Io)({project_id:e}),qr=(e,t)=>Ke(t)+fe(bo)({project_id:e}),Qr=(e,t)=>Ke(t)+fe(Do)({project_id:e}),Zr=(e,t)=>Ke(t)+fe(Po)({project_id:e}),no={id:0,name:"\u6240\u6709\u9879\u76EE"},Lo=Fe({id:"projects",state:()=>({projectGroupList:[],activeGroup:D.get(D.KEYS.ACTIVE_PROJECT_GROUP)||no}),getters:{},actions:{async getProjectGroupList(){const{data:e=[]}=await Ur()||{};this.projectGroupList=e},switchProjectGroup(e=no){D.set(D.KEYS.ACTIVE_PROJECT_GROUP,e),this.activeGroup=e},async addProjectGroup(e){const t=await Vr(e);return t&&this.projectGroupList.push(t.data),t},async renameProjectGroup(e){const t=await Yr(e);if(t){const s=this.projectGroupList.find(o=>o.id==e.id);s.name=e.name}return t},async deleteProjectGroup(e){const t=await Gr(e.id);return this.projectGroupList=this.projectGroupList.filter(s=>s.id!==e.id),this.activeGroup.id===e.id&&this.switchProjectGroup(),t},async sortProjectGroup(e,t){const s=this.projectGroupList.splice(e,1)[0];this.projectGroupList.splice(t,0,s),await Hr(this.projectGroupList.map(o=>o.id))}}}),Xr={data(){return{title:"",isShow:!1,isLoading:!1,isEdit:!1,form:{name:""},categoryInfo:null,rules:{name:{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u7EC4\u540D\u79F0",trigger:"blur"}}}},watch:{isShow:function(){this.isShow&&(this.title=`${this.isEdit?"\u7F16\u8F91":"\u6DFB\u52A0"}\u5206\u7EC4`),!this.isShow&&this.reset()}},methods:ve(V({},cs(Lo,["addProjectGroup","renameProjectGroup"])),{show(e){this.isEdit=!!e,e?(this.categoryInfo=e,this.form=V({},e)):this.form.name="",this.isShow=!0,this.focus()},hide(){this.isShow=!1},onCloseBtnClick(){this.isShow=!1,this.reset()},reset(){this.$refs.teamForm.resetFields()},handleSubmit(e){this.$refs[e].validate(t=>t&&this.submit())},submit(){this.isLoading=!0,(this.isEdit?this.renameProjectGroup:this.addProjectGroup)(this.form).then(t=>{this.$Message.success(t.msg||`${this.isEdit?"\u7F16\u8F91":"\u6DFB\u52A0"}\u5206\u7EC4\u6210\u529F!`),this.onCloseBtnClick()}).finally(()=>{this.isLoading=!1}).catch(t=>{})},focus(){setTimeout(()=>this.$refs.input.focus(),200)}})},ei=U(" \u53D6\u6D88 "),ti=U(" \u786E\u5B9A ");function oi(e,t,s,o,n,r){const i=ut,c=Tt,l=Lt,f=Je,y=We;return d(),O(y,{modelValue:n.isShow,"onUpdate:modelValue":t[4]||(t[4]=p=>n.isShow=p),width:340,"close-on-click-modal":!1,title:n.title,"append-to-body":"","custom-class":"show-footer-line"},{footer:m(()=>[h(f,{onClick:t[2]||(t[2]=p=>r.onCloseBtnClick())},{default:m(()=>[ei]),_:1}),h(f,{loading:n.isLoading,type:"primary",onClick:t[3]||(t[3]=p=>r.handleSubmit("teamForm"))},{default:m(()=>[ti]),_:1},8,["loading"])]),default:m(()=>[h(l,{ref:"teamForm",model:n.form,rules:n.rules,"label-position":"top",style:{"margin-bottom":"-19px"},onSubmit:t[1]||(t[1]=se(p=>r.handleSubmit("teamForm"),["prevent"]))},{default:m(()=>[h(c,{label:"\u5206\u7EC4\u540D\u79F0",prop:"name",class:"hide_required"},{default:m(()=>[h(i,{type:"text",ref:"input",modelValue:n.form.name,"onUpdate:modelValue":t[0]||(t[0]=p=>n.form.name=p),placeholder:"\u8BF7\u8F93\u5165\u5206\u7EC4\u540D\u79F0",maxlength:255},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}var si=H(Xr,[["render",oi]]);const Oo=(e=Ot)=>({title:t,message:s,content:o,cb:n,onOk:r})=>(n=n||r,s=s||o,e({title:t,message:s,showCancelButton:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",beforeClose:function(i,c,l){i==="confirm"?(c.confirmButtonLoading=!0,Promise.resolve(n(l)).then(()=>l()).catch(f=>f).finally(()=>{c.confirmButtonLoading=!1})):l()}})),Mo=Oo();var ni={install:function(e){const t=e.config.globalProperties.$msgbox||Ot;e.config.globalProperties.$asyncMsgBox=Oo(t)}};function ri(e,t){function s(){rt(async()=>{if(e=k(e),!e)return;(await z(()=>import("./sortable.esm.85cd8ec3.js"),[])).default.create(e,V({animation:200,delay:400,delayOnTouchOnly:!0},t))})}return{initSortable:s}}const Bo=e=>(at("data-v-a97b0cbc"),e=e(),ct(),e),ii={class:"flex flex-col border divide-y bg-white"},ai=Bo(()=>a("span",{class:"ml-1"},"\u6240\u6709\u9879\u76EE",-1)),ci=["onClick"],li=["title"],di=Bo(()=>a("span",{class:"ml-1"},"\u6DFB\u52A0\u5206\u7EC4",-1)),ui=U("\u91CD\u547D\u540D "),hi=U("\u5220\u9664 "),pi=q({setup(e){const t=Lo(),{activeGroup:s,projectGroupList:o}=ue(t),n=I(null),r=I(!1),i=I(),c=I();let l=null;const f=v=>[{active:s.value.id===v}],y=()=>{var v;(v=n.value)==null||v.show()},p=v=>{t.switchProjectGroup(v)},A=(v,N)=>{l=N,i.value=v.currentTarget,r.value=!0},C=()=>{var v;l&&((v=n.value)==null||v.show(l))},u=()=>{l&&Mo({title:"\u5220\u9664\u63D0\u793A",content:`\u786E\u5B9A\u5220\u9664${l.name}\u5206\u7EC4\uFF1F`,onOk:()=>t.deleteProjectGroup(l).then(v=>{pe.success(v.msg||"\u5220\u9664\u6210\u529F\uFF01")})})};co(i,v=>{var F,$;const P=v.target.parentNode,B=P.parentNode;((F=P==null?void 0:P.classList)==null?void 0:F.contains("el-icon__more"))||(($=B==null?void 0:B.classList)==null?void 0:$.contains("el-icon__more"))||(r.value=!1)});const{initSortable:_}=ri(c,{draggable:".ac-group-nav__item",onEnd(v){t.sortProjectGroup(v.oldIndex,v.newIndex)}});return dt(async()=>{await t.getProjectGroupList(),_()}),ls(()=>{l=null}),(v,N)=>{const P=Te,B=Mt;return d(),g(G,null,[h(xo,null,{default:m(()=>[a("div",ii,[a("a",{class:L(["relative h-12 pl-6 flex items-center text-neutral-600 hover:text-neutral-900",f(0)]),href:"javascript:void(0);",onClick:N[0]||(N[0]=F=>p())},[h(P,null,{default:m(()=>[h(k(Os))]),_:1}),ai],2),X(a("div",{class:"divide-y ac-group-nav",ref_key:"sortableList",ref:c},[(d(!0),g(G,null,oe(k(o),F=>(d(),g("a",{key:F.name,class:L(["relative flex pr-4 items-center justify-between text-neutral-600 hover:text-neutral-900 ac-group-nav__item",f(F.id)]),href:"javascript:void(0);"},[a("section",{class:"overflow-hidden flex items-center flex-1 h-12 pl-6",onClick:$=>p(F)},[h(P,null,{default:m(()=>[h(k(Ms))]),_:1}),a("span",{class:"ml-1 truncate",title:F.name},M(F.name),9,li)],8,ci),h(P,{onClick:$=>A($,F),class:"ml-1 el-icon__more"},{default:m(()=>[h(k(vo))]),_:2},1032,["onClick"])],2))),128))],512),[[ie,k(o).length]]),a("a",{class:"relative h-12 pl-6 flex items-center text-neutral-600 hover:text-neutral-900",href:"javascript:void(0);",onClick:y},[h(P,null,{default:m(()=>[h(k(Bs))]),_:1}),di])])]),_:1}),h(si,{ref_key:"addProjectCategoryModal",ref:n},null,512),h(B,{"popper-class":"ac-popper-menu",width:"auto",visible:r.value,"onUpdate:visible":N[1]||(N[1]=F=>r.value=F),"virtual-ref":i.value,"virtual-triggering":""},{default:m(()=>[a("ul",null,[a("li",{class:"ac-popper-menu__item",onClick:C},[h(P,{class:"mr-1"},{default:m(()=>[h(k($s))]),_:1}),ui]),a("li",{class:"ac-popper-menu__item",onClick:u},[h(P,{class:"mr-1"},{default:m(()=>[h(k(Fs))]),_:1}),hi])])]),_:1},8,["visible","virtual-ref"])],64)}}});var fi=H(pi,[["__scopeId","data-v-a97b0cbc"]]);const _i=()=>z(()=>import("./Projects.45d26825.js"),["assets/Projects.45d26825.js","assets/Projects.90bac76d.css","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js","assets/ImagePreview.2f24d34a.js","assets/ImagePreview.e9afec23.css"]),mi={path:"",name:"projects.index",meta:{title:"\u9879\u76EE\u5217\u8868"},component:_i},gi=[mi];var vi={path:"/home",name:"projects",redirect:{name:"projects.index"},component:fi,children:gi};const yi=()=>z(()=>import("./ProjectNav.1f24cf74.js"),["assets/ProjectNav.1f24cf74.js","assets/vendor.be35f7a8.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css"]),Ai=()=>z(()=>import("./ProjectSetting.a38c00f1.js"),["assets/ProjectSetting.a38c00f1.js","assets/ImagePreview.2f24d34a.js","assets/ImagePreview.e9afec23.css","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js"]),Ci=()=>z(()=>import("./ProjectMembers.7c59336d.js"),["assets/ProjectMembers.7c59336d.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js","assets/usePage.b90d4e49.js"]),Ei=()=>z(()=>import("./ProjectParam.7fe112b8.js"),["assets/ProjectParam.7fe112b8.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js","assets/params.5bd71d6d.js"]),ki=()=>z(()=>import("./ProjectTrash.6cb0b18a.js"),["assets/ProjectTrash.6cb0b18a.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js"]),$o=[{path:Io,name:"project.setting",component:Ai,meta:{title:"\u9879\u76EE\u8BBE\u7F6E",role:[W.MANAGER]}},{path:bo,name:"project.members",component:Ci,meta:{title:"\u9879\u76EE\u6210\u5458",role:[W.MANAGER,W.DEVELOPER,W.READER]}},{path:Do,name:"project.params",component:Ei,meta:{title:"\u516C\u5171\u53C2\u6570",role:[W.MANAGER,W.DEVELOPER]}},{path:Po,name:"project.trash",component:ki,meta:{title:"\u56DE\u6536\u7AD9",role:[W.MANAGER,W.DEVELOPER]}}],ro=ds($o);var wi={path:"/project/:project_id",name:"project",component:yi,children:$o};const Ni={data(){return{isShow:!1,isLoading:!1,isPoll:!1,title:"\u5BFC\u51FA\u9879\u76EE",params:{},exportList:[],jobParams:{id:null},currentConfig:null,timer:null}},watch:{isShow:function(){this.isShow||(this.clearTimer(),this.isLoading=!1)}},methods:{hide(){this.isShow=!1},show(e,t){this.clearTimer(),this.isShow=!0,this.exportList=t||[],this.params=e||{}},onItemClick(e){this.currentConfig=e||null,this.getImportJobId(this.buildParams(e))},getImportJobId(e){if(this.jobParams.id=null,!this.currentConfig||!this.currentConfig.action)return this.isLoading=!1,Promise.resolve();this.currentConfig.action(e).then(t=>{this.jobParams.id=t.data||null,this.isPoll=!0,this.getExecResult()}).catch(()=>{this.isLoading=!1})},clearTimer(){this.isLoading=!1,this.isPoll=!1},async exec(){if(!this.currentConfig||!this.currentConfig.getJobResult)return this.clearTimer(),Promise.resolve();this.isLoading=!0;try{const{data:e}=await this.currentConfig.getJobResult(this.params.project_id,this.jobParams.id);let t=e.description||"";if(e.result===Me.FAIL&&this.isShow){this.isLoading=!1,this.$Message.error(t||"\u5BFC\u51FA\u5931\u8D25\uFF01"),this.clearTimer();return}if(e.result===Me.WAIT&&this.isShow)return;e.result===Me.FINISH&&this.isShow&&(this.$Message.success(t||"\u5BFC\u51FA\u5B8C\u6210\uFF01"),this.isLoading=!1,this.clearTimer(),this.hide(),e.url&&us(e.url))}catch{this.clearTimer()}},async getExecResult(){for(;this.isPoll;)await this.exec(this.params),await lo(2e3)},buildParams(e){return this.params.type=e.type,this.params}},unmounted(){this.clearTimer()}},Ii={class:"ac-project-export","element-loading-text":"\u5BFC\u5165\u4E2D\uFF0C\u8BF7\u52FF\u5173\u95ED\u7A97\u53E3\uFF01"},bi=["onClick"],Di=["src","alt"],Pi={class:"mt-1.5"};function Si(e,t,s,o,n,r){const i=We,c=ht;return d(),O(i,{modelValue:n.isShow,"onUpdate:modelValue":t[0]||(t[0]=l=>n.isShow=l),width:"fit-content","close-on-click-modal":!1,"append-to-body":"",title:n.title},{default:m(()=>[X((d(),g("div",Ii,[(d(!0),g(G,null,oe(n.exportList,l=>(d(),g("div",{class:"ac-project-export-item",key:l.type},[a("div",{class:"ac-project-export-inner",onClick:f=>r.onItemClick(l)},[a("img",{src:l.icon,alt:l.text},null,8,Di),a("p",Pi,M(l.text),1)],8,bi)]))),128))])),[[c,n.isLoading]])]),_:1},8,["modelValue","title"])}var ji=H(Ni,[["render",Si],["__scopeId","data-v-159cc67b"]]),Fo="/assets/logo-apicat@2x.ca5d403d.png",Ri="/assets/logo-markdown@2x.084fed6d.png",Ko="/assets/logo-postman@2x.3bda39f9.png";const Id=e=>E.get("/api_url/list",{params:{project_id:e}}),bd=(e,t)=>E.post("/api_url/remove",{project_id:e,url_id:t}),Dd=(e,t,s="json")=>{const o=D.get(D.KEYS.SECRET_PROJECT_TOKEN+e||"",!0);return E.get("/api_doc",{params:{project_id:e,doc_id:t,format:s,token:o}})},xi=(e,t)=>{const s=D.get(D.KEYS.SECRET_PROJECT_TOKEN+e||"",!0);return E.get("/api_doc/search",{params:{project_id:e,keywords:t,token:s}})},Ti=(e={})=>E.post("/api_doc/create",V({},e)),Li=(e={})=>E.post("/api_doc/http_template",V({},e)),Pd=(e={})=>(typeof e.content=="object"&&(e.content=JSON.stringify(e.content)),E.post("/api_doc/update",e)),Oi=(e={})=>E.post("/api_doc/copy",e),Mi=(e={})=>E.post("/api_doc/rename",e),Bi=(e={})=>E.post("/api_doc/remove",e),$i=(e={})=>E.post("/api_doc/share",V({},e)),Fi=(e={})=>E.post("/api_doc/share_detail",V({},e)),Ki=(e={})=>E.post("/api_doc/share_secretkey",V({},e)),yt=e=>E.post("/api_doc/import",e),At=(e,t)=>E.get("/api_doc/import_result",{params:{project_id:e,job_id:t}}),Vi=[{text:"ApiCat",icon:Fo,type:"apicat",action:yt,getJobResult:At,maxSize:2,accept:".json"},{text:"Markdown",icon:Ri,type:"markdown",action:yt,getJobResult:At,maxSize:.5,accept:".md"},{text:"Postman(v2.1)",icon:Ko,type:"postman",action:yt,getJobResult:At,maxSize:2,accept:".json"}],Ui=(e,t,s)=>Ke(s)+fe(Ut)({project_id:e,node_id:t}),Gi={watch:{shareData(){this.shareData.docId!==-1&&this.getShareDetail()}},setup(){const{currentRoute:e}=xe(),t=jt({project_id:parseInt(e.value.params.project_id,10),document:null,isShow:!1,isShowDetail:!1,isLoading:!1,isLoadingResetPwd:!1,shareUrl:"",isShare:!1,password:"",copyText:"",copyTextEl:I(),shareData:{docId:-1}});return V({},uo(t))},methods:{onShareStatusSwitch(e){this.document!==null&&(this.isLoading=!0,$i({project_id:this.project_id,doc_id:this.shareData.docId,share:e}).then(({data:t})=>{e?(this.updateLinkAndPassword(t.link,t.secret_key),this.document.secret_key=t.secret_key):(this.document.secret_key="",this.isShare=!1)}).catch(t=>{this.isShare=!this.isShare}).finally(()=>{this.isLoading=!1}))},copy(){this.copyTextEl.select(),document.execCommand("copy")&&(this.copyText="\u590D\u5236\u6210\u529F",setTimeout(()=>{this.copyText=this.document.visibility===Ue.PUBLIC?"\u590D\u5236\u94FE\u63A5":"\u590D\u5236\u94FE\u63A5\u548C\u5BC6\u7801"},2e3))},show(e){this.shareData=e||{docId:-1},this.isShow=!0},setDocument(e={}){return this.document=e,this.copyText=e.visibility===Ue.PUBLIC?"\u590D\u5236\u94FE\u63A5":"\u590D\u5236\u94FE\u63A5\u548C\u5BC6\u7801",this.isShare=e.visibility===Ue.PRIVATE&&!!e.secret_key,e.visibility===Ue.PUBLIC&&(e.link=Ui(this.project_id,this.shareData.docId)),this.updateLinkAndPassword(e.link,e.secret_key),this},updateLinkAndPassword(e,t){this.shareUrl=e||this.shareUrl,this.password=t||this.password,this.updateCopyText()},onResetPasswordBtnClick(){this.isLoadingResetPwd=!0,Ki({project_id:this.project_id,doc_id:this.shareData.docId}).then(({data:e})=>this.updateLinkAndPassword(null,e)).finally(()=>{this.isLoadingResetPwd=!1})},updateCopyText(){this.copyTextEl.value=this.document.visibility===Ue.PRIVATE?this.shareUrl:[`\u94FE\u63A5\uFF1A${this.shareUrl}`,`\u5BC6\u7801\uFF1A${this.password}`].join(`
`)},getShareDetail(){this.isShowDetail=!0,Fi({project_id:this.project_id,doc_id:this.shareData.docId}).then(({data:e})=>{this.setDocument(e)}).finally(()=>{this.isShowDetail=!1})}}},Yi={class:"-m-4"},Hi={key:0},zi={key:1},Ji=a("div",{class:"flex-1"},[a("h4",null,"\u5F00\u542F\u5206\u4EAB"),a("div",{class:"ivu-list-item-meta-description"},"\u5F00\u542F\u5206\u4EAB\u540E\uFF0C\u83B7\u5F97\u94FE\u63A5\u7684\u4EBA\u53EF\u4EE5\u8BBF\u95EE\u9879\u76EE\u5185\u5BB9\u3002")],-1),Wi=U("\u91CD\u7F6E\u5BC6\u7801"),qi={ref:"copyTextEl",style:{position:"fixed",left:"-9999px"}};function Qi(e,t,s,o,n,r){const i=Je,c=ut,l=Tt,f=Lt,y=yo,p=Ao,A=We,C=ht;return d(),O(A,{modelValue:e.isShow,"onUpdate:modelValue":t[4]||(t[4]=u=>e.isShow=u),title:"\u5206\u4EAB\u6587\u6863","custom-class":"vertical-center-modal",width:540,"append-to-body":""},{default:m(()=>[X((d(),g("div",Yi,[e.document&&e.document.visibility===1?(d(),g("div",Hi,[h(f,{"label-position":"top",class:"px-6 py-3"},{default:m(()=>[h(l,{label:""},{default:m(()=>[h(c,{readonly:"",modelValue:e.shareUrl,"onUpdate:modelValue":t[0]||(t[0]=u=>e.shareUrl=u)},{append:m(()=>[h(i,{type:"primary",onClick:r.copy},{default:m(()=>[U(M(e.copyText),1)]),_:1},8,["onClick"])]),_:1},8,["modelValue"])]),_:1})]),_:1})])):j("",!0),e.document&&e.document.visibility===0?(d(),g("div",zi,[a("div",{class:L(["px-6 flex items-center",{"py-3":!e.isShare,"pt-3":e.isShare}])},[Ji,h(y,{loading:e.isLoading,modelValue:e.isShare,"onUpdate:modelValue":t[1]||(t[1]=u=>e.isShare=u),onChange:r.onShareStatusSwitch,"inline-prompt":"","active-text":"\u5F00","inactive-text":"\u5173"},null,8,["loading","modelValue","onChange"])],2),e.isShare?(d(),O(p,{key:0})):j("",!0),e.isShare?(d(),O(f,{key:1,"label-position":"top",class:"px-6"},{default:m(()=>[h(l,{label:"\u6587\u6863\u94FE\u63A5"},{default:m(()=>[h(c,{readonly:"",modelValue:e.shareUrl,"onUpdate:modelValue":t[2]||(t[2]=u=>e.shareUrl=u)},{append:m(()=>[h(i,{type:"primary",onClick:r.copy},{default:m(()=>[U(M(e.copyText),1)]),_:1},8,["onClick"])]),_:1},8,["modelValue"])]),_:1}),h(l,{label:"\u5BC6\u7801"},{default:m(()=>[h(l,{prop:"date",class:"mr-1"},{default:m(()=>[h(c,{readonly:"",modelValue:e.password,"onUpdate:modelValue":t[3]||(t[3]=u=>e.password=u)},null,8,["modelValue"])]),_:1}),h(i,{loading:e.isLoadingResetPwd,onClick:r.onResetPasswordBtnClick},{default:m(()=>[Wi]),_:1},8,["loading","onClick"])]),_:1})]),_:1})):j("",!0)])):j("",!0)])),[[C,e.isShowDetail]]),a("textarea",qi,null,512)]),_:1},8,["modelValue"])}var Zi=H(Gi,[["render",Qi]]);const Xi={setup(){const e=jt({project:null,dom:null,isShow:!1,isLoading:!1,isLoadingResetPwd:!1,shareUrl:"",isShare:!1,password:"",copyText:"",copyTextEl:I()});return V({PROJECT_VISIBLE_TYPES:Ce},uo(e))},methods:{onShareStatusSwitch(e){this.project!==null&&(this.isLoading=!0,Fr(this.project.id,Number(e)).then(({msg:t,data:s})=>{s=s||{},this.$Message.success(t||"\u64CD\u4F5C\u6210\u529F"),this.updateLinkAndPassword(so(this.project.id),s.secret_key),e?this.project.secret_key=s.secret_key:delete this.project.secret_key}).catch(t=>{this.isShare=!this.isShare}).finally(()=>{this.isLoading=!1}))},copy(){this.copyTextEl.select(),document.execCommand("copy")&&(this.copyText="\u590D\u5236\u6210\u529F",setTimeout(()=>{this.copyText=this.project.visibility===Ce.PUBLIC?"\u590D\u5236\u94FE\u63A5":"\u590D\u5236\u94FE\u63A5\u548C\u5BC6\u7801"},2e3))},show(e={}){this.isShow=!0,this.project=e,this.copyText=e.visibility===Ce.PUBLIC?"\u590D\u5236\u94FE\u63A5":"\u590D\u5236\u94FE\u63A5\u548C\u5BC6\u7801",e.visibility===Ce.PRIVATE&&e.secret_key?this.isShare=!0:this.isShare=!1,this.updateLinkAndPassword(so(e.id),e.secret_key)},updateLinkAndPassword(e,t){this.shareUrl=e||this.shareUrl,this.password=t||this.password,this.updateCopyText()},onResetPasswordBtnClick(){this.isLoadingResetPwd=!0,Kr(this.project.id).then(({data:e})=>{this.project.secret_key=e,this.updateLinkAndPassword(null,e)}).finally(()=>{this.isLoadingResetPwd=!1})},updateCopyText(){var e=[this.project.name?`\u300A${this.project.name}\u300B`:"",`\u94FE\u63A5\uFF1A${this.shareUrl}`];this.project.visibility!==Ce.PUBLIC&&e.push(`\u5BC6\u7801\uFF1A${this.password}`),this.$nextTick(()=>{this.copyTextEl.value=e.join(`
`)})}}},ea={key:0,class:"-m-4"},ta={key:1,class:"-m-4"},oa=a("div",{class:"flex-1"},[a("h4",null,"\u5F00\u542F\u5206\u4EAB"),a("div",{class:"ivu-list-item-meta-description"},"\u5F00\u542F\u5206\u4EAB\u540E\uFF0C\u83B7\u5F97\u94FE\u63A5\u7684\u4EBA\u53EF\u4EE5\u8BBF\u95EE\u9879\u76EE\u5185\u5BB9\u3002")],-1),sa=U("\u91CD\u7F6E\u5BC6\u7801"),na={ref:"copyTextEl",style:{position:"fixed",left:"-9999px"}};function ra(e,t,s,o,n,r){const i=Je,c=ut,l=Tt,f=Lt,y=yo,p=Ao,A=We;return d(),O(A,{modelValue:e.isShow,"onUpdate:modelValue":t[4]||(t[4]=C=>e.isShow=C),width:540,"close-on-click-modal":!1,title:"\u5206\u4EAB\u9879\u76EE","append-to-body":""},{default:m(()=>[e.project&&e.project.visibility===o.PROJECT_VISIBLE_TYPES.PUBLIC?(d(),g("div",ea,[h(f,{"label-position":"top",class:"px-6 py-3"},{default:m(()=>[h(l,{label:""},{default:m(()=>[h(c,{readonly:"",modelValue:e.shareUrl,"onUpdate:modelValue":t[0]||(t[0]=C=>e.shareUrl=C)},{append:m(()=>[h(i,{type:"primary",onClick:r.copy},{default:m(()=>[U(M(e.copyText),1)]),_:1},8,["onClick"])]),_:1},8,["modelValue"])]),_:1})]),_:1})])):j("",!0),e.project&&e.project.visibility===o.PROJECT_VISIBLE_TYPES.PRIVATE?(d(),g("div",ta,[a("div",{class:L(["px-6 flex items-center",{"py-3":!e.isShare,"pt-3":e.isShare}])},[oa,h(y,{loading:e.isLoading,modelValue:e.isShare,"onUpdate:modelValue":t[1]||(t[1]=C=>e.isShare=C),onChange:r.onShareStatusSwitch,"inline-prompt":"","active-text":"\u5F00","inactive-text":"\u5173"},null,8,["loading","modelValue","onChange"])],2),e.isShare?(d(),O(p,{key:0})):j("",!0),e.isShare?(d(),O(f,{key:1,"label-position":"top",class:"px-6"},{default:m(()=>[h(l,{label:"\u9879\u76EE\u94FE\u63A5"},{default:m(()=>[h(c,{readonly:"",modelValue:e.shareUrl,"onUpdate:modelValue":t[2]||(t[2]=C=>e.shareUrl=C)},{append:m(()=>[h(i,{type:"primary",onClick:r.copy},{default:m(()=>[U(M(e.copyText),1)]),_:1},8,["onClick"])]),_:1},8,["modelValue"])]),_:1}),h(l,{label:"\u5BC6\u7801"},{default:m(()=>[h(l,{prop:"date",class:"mr-1"},{default:m(()=>[h(c,{readonly:"",modelValue:e.password,"onUpdate:modelValue":t[3]||(t[3]=C=>e.password=C)},null,8,["modelValue"])]),_:1}),h(i,{loading:e.isLoadingResetPwd,onClick:r.onResetPasswordBtnClick},{default:m(()=>[sa]),_:1},8,["loading","onClick"])]),_:1})]),_:1})):j("",!0)])):j("",!0),a("textarea",na,null,512)]),_:1},8,["modelValue"])}var ia=H(Xi,[["render",ra]]);const _e=Fe({id:"project",state:()=>({projectInfo:null,projectAuthInfo:{}}),getters:{isManager:e=>e.projectAuthInfo&&e.projectAuthInfo.authority===W.MANAGER,isDeveloper:e=>e.projectAuthInfo&&e.projectAuthInfo.authority===W.DEVELOPER,isReader:e=>e.projectAuthInfo&&e.projectAuthInfo.authority===W.READER,isGuest:e=>e.projectAuthInfo&&e.projectAuthInfo.authority===W.NONE,isPrivate:e=>e.projectAuthInfo&&e.projectAuthInfo.visibility===Ce.PRIVATE},actions:{async getProjectDetail(e){var o;const t=D.get(D.KEYS.SECRET_PROJECT_TOKEN+e||"",!0),{data:s}=await zr(e,t);return this.projectInfo=ve(V({},s||{}),{visible:(o=to.find(n=>n.key===s.visibility))==null?void 0:o.value}),this.projectInfo},async getProjectAuth(e){const{data:t}=await Jr(e);return this.projectAuthInfo=t||{},this.projectAuthInfo.id=e,this.projectAuthInfo.in_this=this.projectAuthInfo.authority!==W.NONE,this.projectAuthInfo},async updateProjectInfo(e){var s;const t=await $r(e);return this.projectInfo=ve(V(V({},this.projectInfo),e),{visibility:(s=to.find(o=>o.value===e.visible))==null?void 0:s.key}),t},clearProjectInfo(){this.projectInfo=null}}});var aa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAJiElEQVR4Xu2de4xU5RnGn+/Msgu7zMzusgGJlUiCCZcELbFJi7GJtrShtgs21RJMi4tim0aqmF5iayMtsTQkbbdYtNTSKtYorpWGmOItqESwaKDEFhURpFsKre7szsyZ3dlhZ87bnDNd3MvMzvnO9ZvZ9/zH8j7v937P8+NcdoYZARcHEcWSur4OhBUA5gNoIyLhomXVSJ996eDjq69fvrpqBi4zqOOwkkn9RhL0ABHNqHYTnMz/SNczmNXWWvUQOAKgL5W6gwidToyrFY0JgHlUOwTSAPTp+jUw6EUi0molTCf7GAag2iGQAsC8vidT+lECLXZiWi1pRgJQzRBIAZBOp5fmDTpQS0E63ctYAKoVAikA+lKpjUS416lptaQrBUA1QiAHQDK9g0BraylIp3spB0C1QSALwJMEusGpabWkmwiAaoKAAXBIZSUAqgUCBsBHAKoBAgbAZwBUh4ABCAAAlSFgAAICQFUIGIAAAVARAgYgYABUg4ABCAEAlSBgAEICQBUIGIAQAVABAgYgZADChoABUACAMCFgABQBICwIGACFAAgDAgZAMQCChoABcAjAY7ufRT6fd6iuLAvq3cYMQOUsSlb8+blXkErrDtX2ZEFAwADYy2Jc1etHj+HtE+87VNuX+Q0BA2A/i1GVybSOPc/vBxE57GBf5icEDID9HMZVHjryd7xz8p8uOtiX+gUBA2A/g3GVhmHghf2H8J8PEy662Jf6AQEDYN//kpUmBG8cPYbjp7qr8nLAALgEYFhu3hO8e6obZ//bg/6BbNU8IjIAHgEwtk2mP4v+7KBP3YEF8y6Vyq7cIFJN+pJp/o8hEpH6CQEDIBFEmKV+QcAAhJmq5Np+QMAASIYQdrnXEDAAYSfqYH0vIWAAHASggsQrCBgAFdJ0OIMXEDAADs1XReYWAgZAlSRdzOEGAgbAhfEqSZ1CwAColKLLWZxAwAC4NF01uSwEDIBqCXowjwwEDIAHhqvYwi4EDICK6Xk0kx0IGACPzFa1TSUIGABVk/NwrokgYAA8NFrlVuUgYABUTs3j2UpBwAB4bLLq7cZCwAConpgP842EgAHwweBqaDkMAQNQDWn5NKMJwZyLL5J6R3e5UaSa8NvCfUrUQdvW5rhUdgyAA5NVljAAKqcTwGwMQAAmq7wEA6ByOgHMxgAEYLLKSzAAKqcTwGwMQAAmq7yE5wAkOlZ83iD6IYiWAGhSefNVOVusGWLeQogVqyCaW11vwVMAejra15BBD7ueihtUdqBxOrTv/9Q1BJ4BQLfd1pjInTtHQKzy9FzhhQNiyVJoa77lqpVnAPSuab+qAHrV1TQslnMg1ozIpl/LacZUewZA4ub2GwyiJ11Nw2JpByK/+qO0ZqSAAXBlX/hiBiD8DEKdgAEI1f7wF2cAws8g1AkYgFDtD39xBiD8DEKdgAEI1f7wF2cAws8g1AkYgFDtD3/xmgWg/spPYerVy0o6TNkBFBIfoHD2DHKH9gNjvnUruv5uiLopo7VEKPQlUDh3BoWz/0L+vXdAg9mS/UvqS1Tmz5zGQNfOUCmoWQCmLb8eTV/tqGhuobcHmR1bMXTs6IXaGdu7IBoaJtRauoe3YejNw+Pq7OhN0dDxfyC1+QcVZ/SzYFIAMLB3N8x/9dYhAK1xOiJz5qJ+wWLrR0ZGR/Ke9TCSvdafhwPMnz6J3JG/FmX19Yi0zYQ2czbq5l4GIYpvhzd7D+z6w6iMSulLhWj0fIDcwZf8zLdi70kBQO9da2H09owzo+GqaxFdd6f18/6nHkX2ma5RAAzufwGZ398/TmcC0PT1b2LK3Musr2dJ/eQ7yL9/YtwZpJy+YioBFkxqAEyfWx98Atq0Rgy+9goy239uCwDrjBCNo2XLdks7dOpdC4LhY/gMwADYJ1l4/XLwyHuAcmcANEzFjK07IRqmInf4Nej3b7YNgFnYuHI1GleusjSJ228CZYrf4MkA2A9+uDIUABqu/iyit3y7eC3fswsDTz8mFWD9FZ9A7M4fWZrkpu8if/L4KH3ujYPof6r8Xb7RlwDO5+Td8lAxKS4B6a33wUinLtgmmqKou+RSTFv2RWjxFlChgJQZ4On3pACIXDwHLfcV31Gj//aXF27o7D4FpH7x45JPER7mW7HVpABgIhfMm7iBrkeQ/cvT0tdw84mgdct2S2c+Eg6+/NwogCq5zwB85JCvlwDKDwEjvlqXsv0o9HyIwtluZPfuRuHf3aOysnsNn7LwcsS/t8nSprbcg6G33hx9BjmwD5mdvynPwfnzABmVOPH17yfFGaDsTWAZa+0CMPUz12H6175hdRm5hl29r8nabM4AlDDKVoCROrRs3obIzNnWL5B6N3QA//8Gb1t6mwH5XcYAOAGgvh5Nq9Zi2rVfKN4APtSJ3IF90vcQfodrpz8DMAEA5q+Bs3t2FSummL8KnoXIrNlo+PQyRFrbrB8PnTxuPUGMPPgMYAe90TW+3gQ6vQeYaBvm08Pgvr3WE8TYVwUZgBoFwHwF0Hwp2HxJOPf6q8ifeLvkThkABQCQH2FyKmr2HmByxim/awZA3rOaUjAANRWn/GYYAHnPakrBANRUnPKbYQDkPaspBQNQU3HKb0YZAHpubv8yEf1JfguscOyAEIh0PupYbgq9+4SQjhULDcM45moaFks5IC76GLS7fyalGVvsGQC0caPWc/rIYRBd4WoiFtt2QLvuKxCfW2m7vlShZwCYzRPrvrSIhsReIrrE1VQsruzAoo8jcusGQNMq105Q4SkAFgTrb4qRnl4DaEsAKvlJoWLe/E/S9BhD4iQ665NCF0AsvtKJepzGcwDsTMVfGWPHpWBqGIBgfFZ2FQZA2WiCGYwBCMZnZVdhAJSNJpjBGIBgfFZ2FQZA2WiCGYwBCMZnZVdhAJSNJpjBGIBgfFZ2FQZA2WiCGYwBCMZnZVdhAJSNJpjBwgJgB4HWBrNFXmUCBzKtzfGoFw4VP3XR5tGX0u8lMjbaLOcyvxwQ4q3WeGyRF+2lAEin00vzBh3wYmHu4dwBIbTOlnh0g/MOHymlACAiLZnS/0ag4me98hG4A0IIo04Ti6PRqCfv45QCwNxtn65fA4NeNGEIfPe8IITAtpZ4/HavrJAGwIIglbqDCJ1eDcF97DkgIPY1x6PLhRDn7SkqVzkCwGybTOo3kqAHiGhG5WW4wo0D5mkfoAebY7G7vAzfnMkxAKa4lyiu6fo6IrQDmA+gjYhc9XRjVI1pMxCiW0A8X6fhd15d88d69D+MM3rbPGNofwAAAABJRU5ErkJggg==";const Ct=(e={})=>E.post("/api_doc/export",e),Et=(e,t)=>E.get("/api_doc/export_result",{params:{project_id:e,job_id:t}}),Vo=[{text:"ApiCat",icon:Fo,type:"apicat",action:Ct,getJobResult:Et},{text:"PDF",icon:aa,type:"pdf",action:Ct,getJobResult:Et},{text:"Postman(v2.1)",icon:Ko,type:"postman",action:Ct,getJobResult:Et}],Uo=Vo,ca={class:"ac-project-info ac-project-info--hover"},la={class:"ac-project-info__img"},da=["src","alt"],ua=["onClick"],ha={key:1,class:"ac-project-info__img"},pa=["src","alt"],fa=["title"],_a=q({setup(e){const{push:t,currentRoute:s}=xe(),o=_e(),{projectInfo:n,isManager:r,isPrivate:i,isDeveloper:c}=ue(o),l=I(),f=le("projectExportModal"),y=_=>{if(_.hrefFn){t(_.hrefFn(s.value.params.project_id,!1));return}},p=()=>{var _;f.value.title="\u5BFC\u51FA\u9879\u76EE",(_=f.value)==null||_.show({project_id:n.value.id},Vo)},A=()=>{var _;(_=l.value)==null||_.show(n.value)},C=[{text:"\u9879\u76EE\u8BBE\u7F6E",icon:"iconIconPopoverSetting",hrefFn:Wr},{text:"\u516C\u5171\u53C2\u6570",icon:"iconIconPopoverConfig",hrefFn:Qr},{text:"\u9879\u76EE\u6210\u5458",icon:"iconIconPopoverUser",hrefFn:qr},{text:"\u5206\u4EAB\u9879\u76EE",icon:"iconshare2",onClick:()=>A()},{text:"\u5BFC\u51FA\u9879\u76EE",icon:"iconIconPopoverUpload",onClick:()=>p()},{text:"\u56DE\u6536\u7AD9",icon:"icontrash",hrefFn:Zr}],u=I(C);return re(n,()=>{n.value&&!r.value&&(u.value=C.filter(_=>_.icon!=="iconIconPopoverSetting"))},{immediate:!0}),(_,v)=>{const N=Te,P=Y("router-link"),B=Mt,F=Eo,$=ia;return d(),g(G,null,[a("div",ca,[k(r)||k(c)?(d(),O(B,{key:0,placement:"bottom","popper-class":"ac-popper-menu ac-popper-menu--large",width:"250px"},{reference:m(()=>[a("div",la,[a("img",{src:k(n).icon,alt:k(n).name},null,8,da),h(P,{to:{name:"projects"}},{default:m(()=>[h(N,{class:"ac-project-info__back"},{default:m(()=>[h(k(eo))]),_:1})]),_:1})])]),default:m(()=>[a("ul",null,[(d(!0),g(G,null,oe(u.value,Q=>(d(),g("li",{key:Q.icon,class:L(["ac-popper-menu__item",{"border-t":Q.divided}]),onClick:me=>Q.onClick?Q.onClick(Q):y(Q)},[a("i",{class:L(["icon iconfont mr-1",Q.icon])},null,2),U(M(Q.text),1)],10,ua))),128))])]),_:1})):(d(),g("div",ha,[a("img",{src:k(n).icon,alt:k(n).name},null,8,pa),h(P,{to:{name:"projects"}},{default:m(()=>[h(N,{class:"ac-project-info__back"},{default:m(()=>[h(k(eo))]),_:1})]),_:1})])),a("div",{class:"ac-project-info__title",title:k(n).name},[U(M(k(n).name)+" ",1),k(i)?(d(),O(F,{key:0,effect:"dark",content:"\u79C1\u6709\u9879\u76EE",placement:"bottom"},{default:m(()=>[h(N,{class:"ac-project-info__icon"},{default:m(()=>[h(k(Co))]),_:1})]),_:1})):j("",!0)],8,fa)]),h($,{ref_key:"projectShareModal",ref:l},null,512)],64)}}}),ma={class:"ac-project-info"},ga={class:"ac-project-info__img"},va={href:"/"},ya=["src","alt"],Aa=["title"],Ca=q({setup(e){const t=_e(),{projectInfo:s,isPrivate:o}=ue(t);return(n,r)=>{const i=Te,c=Eo;return d(),g("div",ma,[a("div",ga,[a("a",va,[a("img",{src:k(s).icon,alt:k(s).name},null,8,ya)])]),a("div",{class:"ac-project-info__title",title:k(s).name},[U(M(k(s).name)+" ",1),k(o)?(d(),O(c,{key:0,effect:"dark",content:"\u79C1\u6709\u9879\u76EE",placement:"bottom"},{default:m(()=>[h(i,{class:"ac-project-info__icon"},{default:m(()=>[h(k(Co))]),_:1})]),_:1})):j("",!0)],8,Aa)])}}}),Ea="is.show.document.title",ka="doc.save.ing",wa="doc.save.done",Na="doc.save.error";var Xe=hs();const Ia={class:"ac-header-operate"},ba={class:"ac-header-operate__main"},Da={key:1},Pa={key:0,class:"ac-header-operate__btns"},Sa=q({props:{title:{type:String,default:""}},setup(e){const t=le("documentShareModal"),s=le("projectExportModal"),{currentRoute:o,push:n}=xe(),r=_e(),{isGuest:i}=ue(r),c=I(!1),l=I(!1),f=Re(()=>["ac-header-operate__title",{hidden:!l.value,animate__slideInDown:l.value,animate__slideOutUp:!l.value}]),y=Re(()=>o.value.name===Pe),p=()=>{const{params:v}=o.value,N=v.project_id,P=parseInt(v.node_id,10);return{project_id:N,node_id:P}},A=()=>{const{project_id:v,node_id:N}=p();if(y.value){n({name:Se,params:{project_id:v,node_id:N}});return}n({name:Pe,params:{project_id:v,node_id:N}})},C=()=>{var N;const{node_id:v}=p();(N=t.value)==null||N.show({docId:v,nodeId:v})},u=()=>{const{project_id:v,node_id:N}=p();s.value.title="\u5BFC\u51FA\u6587\u6863",s.value.show({project_id:v,doc_id:N},Uo)},_=()=>{c.value=!1};return Xe.on(Ea,v=>{l.value=v}),Xe.on(ka,()=>{c.value=!0}),Xe.on(wa,_),Xe.on(Na,_),(v,N)=>{const P=Je;return d(),g("div",Ia,[a("div",ba,[k(y)?(d(),g("p",Da,[a("i",{class:L(["iconfont",c.value?"iconcloud-upload":"iconcloud"])},null,2),U(" "+M(c.value?"\u4FDD\u5B58\u4E2D...":"\u5DF2\u4FDD\u5B58\u5728\u4E91\u7AEF"),1)])):(d(),g("p",{key:0,class:L(k(f))},M(e.title),3))]),k(i)?j("",!0):(d(),g("div",Pa,[h(P,{type:"primary",onClick:A},{default:m(()=>[U(M(k(y)?"\u9884\u89C8":"\u7F16\u8F91"),1)]),_:1}),a("i",{class:"iconfont iconshare2",onClick:C}),a("i",{class:"iconfont iconIconPopoverUpload",onClick:u})]))])}}}),ja={emits:["on-menu-item-click"],name:"NewMenus",props:{node:{type:Object,default:()=>({})}},setup(){return{menus:Yo}},methods:{onPopperItemClick(e){Rt(this,"on-menu-item-click",e)}}},Ra={class:"ac-popper-menu"},xa=["onClick"],Ta=["src"];function La(e,t,s,o,n,r){return d(),g("ul",Ra,[(d(!0),g(G,null,oe(o.menus,i=>(d(),g(G,{key:i.value},[s.node.level<5||s.node.level===5&&i.value!=="newCatetory"?(d(),g("li",{key:0,class:L(["ac-popper-menu__item",{"border-t":i.divided}]),onClick:se(c=>r.onPopperItemClick(i),["stop"])},[i.icon?(d(),g("span",{key:0,class:L(["icon iconfont ac-popper-menu__icon",i.icon])},null,2)):j("",!0),i.img?(d(),g("img",{key:1,class:"ac-popper-menu__icon",src:i.img,alt:""},null,8,Ta)):j("",!0),U(M(i.text),1)],10,xa)):j("",!0)],64))),128))])}var Oa=H(ja,[["render",La]]);const Ma={name:"DirOperateMenus",data(){return{menus:qa}},methods:{onPopperItemClick(e){Rt(this,"on-menu-item-click",e)}}},Ba={class:"ac-popper-menu ac-popper-menu--thin"},$a=["onClick"];function Fa(e,t,s,o,n,r){return d(),g("ul",Ba,[(d(!0),g(G,null,oe(n.menus,i=>(d(),g("li",{class:L(["ac-popper-menu__item",{"border-t":i.divided}]),key:i.value,onClick:se(c=>r.onPopperItemClick(i),["stop"])},M(i.text),11,$a))),128))])}var Ka=H(Ma,[["render",Fa]]);const Va={emits:["on-menu-item-click"],name:"DocOperateMenus",props:{node:{type:Object,default:()=>({})},source:{type:Object,default:()=>({})},isDetailPage:{type:Boolean,default:!1}},data(){return{menus:Pt}},methods:{onPopperItemClick(e){Rt(this,"on-menu-item-click",e)}}},Ua={class:"ac-popper-menu ac-popper-menu--thin"},Ga=["onClick"],Ya=["onClick"],Ha=["onClick"];function za(e,t,s,o,n,r){return d(),g("ul",Ua,[(d(!0),g(G,null,oe(n.menus,i=>(d(),g(G,null,[(i.value==="delete"||i.value==="export"||i.value==="share"||i.value==="copy")&&s.isDetailPage&&s.source.isCurrent?(d(),g("li",{class:L(["ac-popper-menu__item",{"border-t":i.divided}]),key:i.value,onClick:se(c=>r.onPopperItemClick(i),["stop"])},M(i.text),11,Ga)):j("",!0),i.value==="delete"&&!s.isDetailPage&&s.source.isCurrent?(d(),g("li",{class:L(["ac-popper-menu__item",{"border-t":i.divided}]),key:i.value,onClick:se(c=>r.onPopperItemClick(i),["stop"])},M(i.text),11,Ya)):j("",!0),s.source.isCurrent?j("",!0):(d(),g("li",{class:L(["ac-popper-menu__item",{"border-t":i.divided}]),key:i.value,onClick:se(c=>r.onPopperItemClick(i),["stop"])},M(i.text),11,Ha))],64))),256))])}var Ja=H(Va,[["render",za]]),Go="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAUGVYSWZNTQAqAAAACAACARIAAwAAAAEAAQAAh2kABAAAAAEAAAAmAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAL5bTO0AAAIwaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+MTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+MzI8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MzI8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4K9GTeTwAAAW9JREFUWAntVLtKQ0EQvWsUi0AKtRFESaWlP2Nl/AMLK62sbExhlz+I8XusxE6sfRRBCxuv50guXJKZfS8IZuBw787ZmTk7+6iq/25GacA5/IcKZ3O/gxwBj7ZJbW6lPWj9xxRn+AZwARxw4GNaB+5mwWN8nx2J9sEfAVz9N7AFfAFDwNmJVUyyGYs/2CaA6874D3xvgEuAItgJpwhtCxAbZS+IugJegXXAuR25BaBmFSSihIAgEaUESCJO6Zw31yGcn28bb4O8FiY0i+QVXbAcAp6QlddvDdhdqOBw5BDAE38G9JVaO/DznRAthwAmpghCsk/J2fia/WnGoV++pEk5UjtQQwARbb7qO9EVHIG+ApJWadPgK4DXrIj5CihSnEmXApYdCOpAXdfm9vitp51Icpyj8ZI/6CU0xvA9mEqJ6BtMNqeDicbK/qAOyCnSvK4O7KWl/4225nAJOMkgwJpC24J7a1QcWSJnnJI/FfUDsbg5OtwYRrcAAAAASUVORK5CYII=",Wa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABZUlEQVRYR+3XMUvEMBTA8X9uvkHE2wQRBMHJQScdHO4rCCL4DTp4izgoOLh4KBxSP4HgZ3AQXHRzcBJXXVxEHE8FI4EuXtt7LyGhg3ZsXvJ+eU3T1NDwZRrOTx1gB1gMwL0BOfCo7VsHuNAOUBH3ARxpERLgHHgSMPPAOuBm/w1MAWqEBDgEHgTAMtADnoETYN8HERuwC3R8ECkArmBqRCqAGpESMIpwizQbXU8xAV/AS8WCbQOTxf3NFAD32g2AlmLvSAJweR1itgYwXewTrjkZYNzkF4C9lI9AqnwEQGaXsFxJmX61G7rk5g6IAljBcuMJWCU3t3EALvO2nfACDMx7ER+hAl6ZS8ERAD07xyfHpaENQ3KzIfgiADK7huW6MtGZkY51EQAHts0r3RKgxZBTc5m+Ao2vgX/AX66A5lgu1WcG2Ar9GkqD+7arzwOhv2bjQPdAX3sk851ZcLy0jQYPrO34A6sFhSHFThBJAAAAAElFTkSuQmCC";const Yo=[{text:"\u65B0\u5EFA\u6587\u6863",value:"createDoc",img:Go,onClick:"createDoc"},{text:"\u65B0\u5EFA HTTP API \u6587\u6863",value:"createHttpDoc",img:Wa,onClick:"createHttpDoc"},{text:"\u5BFC\u5165\u6587\u4EF6",value:"importFile",icon:"iconimport",onClick:"onImportBtnClick",divided:!0},{text:"\u65B0\u5EFA\u5206\u7C7B",value:"newCatetory",type:"newCatetory",icon:"iconIconPopoverTree",onClick:"onCreateDirBtnClick",divided:!0}],Pt=[{text:"\u590D\u5236",value:"copy",onClick:"onCopyBtnClick"},{text:"\u91CD\u547D\u540D",value:"rename",onClick:"onRenameBtnClick"},{text:"\u5206\u4EAB",value:"share",onClick:"onShareBtnClick"},{text:"\u5BFC\u51FA",value:"export",onClick:"onExportBtnClick"},{text:"\u5220\u9664",value:"delete",onClick:"onDeleteBtnClick"}],qa=[Pt[1],Pt[4]],Qa="DIR_NEW_TYPE",Za="DIR_OPERATE_TYPE",Xa="DOC_OPERATE_TYPE";function kt(e,t){const s=document.createElement("div"),o=It(e);return ps(o,s),Object.keys(t).forEach(n=>{o.component.props[n]=t[n]}),o}var ec={[Qa]:{render(e){return kt(Oa,e)}},[Za]:{render(e){return kt(Ka,e)}},[Xa]:{render(e){return kt(Ja,e)}}},wt={onPopperItemClick:Ye,onPopperHide:Ye,popper:fs(document.body,{appendTo:()=>document.body,trigger:"manual",placement:"bottom",interactive:!0,theme:"light",zIndex:10}),show(e,t,s,o){const n=ec[e];!n||(this.$vm=n.render(s),_s(this.$vm.component.proxy,"on-menu-item-click",r=>{this.onPopperItemClick(V({menu:r},s)),this.hide()}),this.popper.setProps({appendTo:()=>o||document.body,getReferenceClientRect:()=>t.getBoundingClientRect(),content:this.$vm.el,onHide:()=>{this.onPopperHide()}}),this.popper.show())},hide(){this.popper.hide()}};const tc=(e={})=>E.post("/dir/create",e),oc=(e={})=>E.post("/dir/remove",e),sc=(e={})=>E.post("/dir/rename",e),nc=(e={})=>E.post("/api_tree/sort",e),rc=(e,t)=>E.get("/api_tree",{params:{project_id:e,token:t}}),Sd=e=>E.get("/dir/list",{params:{project_id:e}}),et=(e={},t=be.DOC)=>ve(V({},e),{type:e.type===void 0?t:e.type,isEditable:!1,isCurrent:!1,isLeaf:(e.type===void 0?t:e.type)===be.DOC}),Ho=Fe({id:"document",state:()=>({apiDocTree:[]}),getters:{},actions:{async getApiDocTree(e){if(!e)return[];try{const t=D.get(D.KEYS.SECRET_PROJECT_TOKEN+e||"",!0),{data:s}=await rc(e,t);this.apiDocTree=Ie(o=>(o.isLeaf=o.type===be.DOC,o.isEditable=!1,o.isCurrent=!1,o),s||[],{subKey:"sub_nodes"})}catch{}return this.apiDocTree}}}),ic="el",ac="is-",Ne=(e,t,s,o,n)=>{let r=`${e}-${t}`;return s&&(r+=`-${s}`),o&&(r+=`__${o}`),n&&(r+=`--${n}`),r},Qe=e=>{const t=Re(()=>ic);return{namespace:t,b:(u="")=>Ne(k(t),e,u,"",""),e:u=>u?Ne(k(t),e,"",u,""):"",m:u=>u?Ne(k(t),e,"","",u):"",be:(u,_)=>u&&_?Ne(k(t),e,u,_,""):"",em:(u,_)=>u&&_?Ne(k(t),e,"",u,_):"",bm:(u,_)=>u&&_?Ne(k(t),e,u,"",_):"",bem:(u,_,v)=>u&&_&&v?Ne(k(t),e,u,_,v):"",is:(u,..._)=>{const v=_.length>=1?_[0]:!0;return u&&v?`${ac}${u}`:""},cssVar:u=>{const _={};for(const v in u)_[`--${t.value}-${v}`]=u[v];return _},cssVarName:u=>`--${t.value}-${u}`,cssVarBlock:u=>{const _={};for(const v in u)_[`--${t.value}-${e}-${v}`]=u[v];return _},cssVarBlockName:u=>`--${t.value}-${e}-${u}`}},cc=(e,t,s,o=!1)=>{e&&t&&s&&(e==null||e.addEventListener(t,s,o))},lc=(e,t,s,o=!1)=>{e&&t&&s&&(e==null||e.removeEventListener(t,s,o))},$e="$treeNodeId",io=function(e,t){!t||t[$e]||Object.defineProperty(t,$e,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},Gt=function(e,t){return e?t[e]:t[$e]},St=e=>{let t=!0,s=!0,o=!0;for(let n=0,r=e.length;n<r;n++){const i=e[n];(i.checked!==!0||i.indeterminate)&&(t=!1,i.disabled||(o=!1)),(i.checked!==!1||i.indeterminate)&&(s=!1)}return{all:t,none:s,allWithoutDisable:o,half:!t&&!s}},nt=function(e){if(e.childNodes.length===0)return;const{all:t,none:s,half:o}=St(e.childNodes);t?(e.checked=!0,e.indeterminate=!1):o?(e.checked=!1,e.indeterminate=!0):s&&(e.checked=!1,e.indeterminate=!1);const n=e.parent;!n||n.level===0||e.store.checkStrictly||nt(n)},tt=function(e,t){const s=e.store.props,o=e.data||{},n=s[t];if(typeof n=="function")return n(o,e);if(typeof n=="string")return o[n];if(typeof n=="undefined"){const r=o[t];return r===void 0?"":r}};let dc=0;class je{constructor(t){T(this,"id");T(this,"text");T(this,"checked");T(this,"indeterminate");T(this,"data");T(this,"expanded");T(this,"parent");T(this,"visible");T(this,"isCurrent");T(this,"store");T(this,"isLeafByUser");T(this,"isLeaf");T(this,"canFocus");T(this,"level");T(this,"loaded");T(this,"childNodes");T(this,"loading");this.id=dc++,this.text=void 0,this.checked=!1,this.indeterminate=!1,this.data=void 0,this.expanded=!1,this.parent=void 0,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const s in t)bt(t,s)&&(this[s]=t[s]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){const t=this.store;if(!t)throw new Error("[Node]store is required!");t.registerNode(this);const s=t.props;if(s&&typeof s.isLeaf!="undefined"){const r=tt(this,"isLeaf");typeof r=="boolean"&&(this.isLeafByUser=r)}if(t.lazy!==!0&&this.data?(this.setData(this.data),t.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&t.lazy&&t.defaultExpandAll&&this.expand(),Array.isArray(this.data)||io(this,this.data),!this.data)return;const o=t.defaultExpandedKeys,n=t.key;n&&o&&o.includes(this.key)&&this.expand(void 0,t.autoExpandParent),n&&t.currentNodeKey!==void 0&&this.key===t.currentNodeKey&&(t.currentNode=this,t.currentNode.isCurrent=!0),t.lazy&&t._initDefaultCheckedNode(this),this.updateLeafState(),this.parent&&(this.level===1||this.parent.expanded===!0)&&(this.canFocus=!0)}setData(t){Array.isArray(t)||io(this,t),this.data=t,this.childNodes=[];let s;this.level===0&&Array.isArray(this.data)?s=this.data:s=tt(this,"children")||[];for(let o=0,n=s.length;o<n;o++)this.insertChild({data:s[o]})}get label(){return tt(this,"label")}get key(){const t=this.store.key;return this.data?this.data[t]:null}get disabled(){return tt(this,"disabled")}get nextSibling(){const t=this.parent;if(t){const s=t.childNodes.indexOf(this);if(s>-1)return t.childNodes[s+1]}return null}get previousSibling(){const t=this.parent;if(t){const s=t.childNodes.indexOf(this);if(s>-1)return s>0?t.childNodes[s-1]:null}return null}contains(t,s=!0){return(this.childNodes||[]).some(o=>o===t||s&&o.contains(t))}remove(){const t=this.parent;t&&t.removeChild(this)}insertChild(t,s,o){if(!t)throw new Error("InsertChild error: child is required.");if(!(t instanceof je)){if(!o){const n=this.getChildren(!0);n.includes(t.data)||(typeof s=="undefined"||s<0?n.push(t.data):n.splice(s,0,t.data))}Object.assign(t,{parent:this,store:this.store}),t=jt(new je(t)),t instanceof je&&t.initialize()}t.level=this.level+1,typeof s=="undefined"||s<0?this.childNodes.push(t):this.childNodes.splice(s,0,t),this.updateLeafState()}insertBefore(t,s){let o;s&&(o=this.childNodes.indexOf(s)),this.insertChild(t,o)}insertAfter(t,s){let o;s&&(o=this.childNodes.indexOf(s),o!==-1&&(o+=1)),this.insertChild(t,o)}removeChild(t){const s=this.getChildren()||[],o=s.indexOf(t.data);o>-1&&s.splice(o,1);const n=this.childNodes.indexOf(t);n>-1&&(this.store&&this.store.deregisterNode(t),t.parent=null,this.childNodes.splice(n,1)),this.updateLeafState()}removeChildByData(t){let s=null;for(let o=0;o<this.childNodes.length;o++)if(this.childNodes[o].data===t){s=this.childNodes[o];break}s&&this.removeChild(s)}expand(t,s){const o=()=>{if(s){let n=this.parent;for(;n.level>0;)n.expanded=!0,n=n.parent}this.expanded=!0,t&&t(),this.childNodes.forEach(n=>{n.canFocus=!0})};this.shouldLoadData()?this.loadData(n=>{Array.isArray(n)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||nt(this),o())}):o()}doCreateChildren(t,s={}){t.forEach(o=>{this.insertChild(Object.assign({data:o},s),void 0,!0)})}collapse(){this.expanded=!1,this.childNodes.forEach(t=>{t.canFocus=!1})}shouldLoadData(){return this.store.lazy===!0&&this.store.load&&!this.loaded}updateLeafState(){if(typeof this.isLeafByUser!="undefined"){this.isLeaf=this.isLeafByUser;return}this.isLeaf=!1}setChecked(t,s,o,n){if(this.indeterminate=t==="half",this.checked=t===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:i,allWithoutDisable:c}=St(this.childNodes);!this.isLeaf&&!i&&c&&(this.checked=!1,t=!1);const l=()=>{if(s){const f=this.childNodes;for(let A=0,C=f.length;A<C;A++){const u=f[A];n=n||t!==!1;const _=u.disabled?u.checked:n;u.setChecked(_,s,!0,n)}const{half:y,all:p}=St(f);p||(this.checked=p,this.indeterminate=y)}};if(this.shouldLoadData()){this.loadData(()=>{l(),nt(this)},{checked:t!==!1});return}else l()}const r=this.parent;!r||r.level===0||o||nt(r)}getChildren(t=!1){if(this.level===0)return this.data;const s=this.data;if(!s)return null;const o=this.store.props;let n="children";return o&&(n=o.children||"children"),s[n]===void 0&&(s[n]=null),t&&!s[n]&&(s[n]=[]),s[n]}updateChildren(){const t=this.getChildren()||[],s=this.childNodes.map(r=>r.data),o={},n=[];t.forEach((r,i)=>{const c=r[$e];!!c&&s.findIndex(f=>f[$e]===c)>=0?o[c]={index:i,data:r}:n.push({index:i,data:r})}),this.store.lazy||s.forEach(r=>{o[r[$e]]||this.removeChildByData(r)}),n.forEach(({index:r,data:i})=>{this.insertChild({data:i},r)}),this.updateLeafState()}loadData(t,s={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(s).length)){this.loading=!0;const o=n=>{this.loaded=!0,this.loading=!1,this.childNodes=[],this.doCreateChildren(n,s),this.updateLeafState(),t&&t.call(this,n)};this.store.load(this,o)}else t&&t.call(this)}}class uc{constructor(t){T(this,"currentNode");T(this,"currentNodeKey");T(this,"nodesMap");T(this,"root");T(this,"data");T(this,"lazy");T(this,"load");T(this,"filterNodeMethod");T(this,"key");T(this,"defaultCheckedKeys");T(this,"checkStrictly");T(this,"defaultExpandedKeys");T(this,"autoExpandParent");T(this,"defaultExpandAll");T(this,"checkDescendants");T(this,"props");this.currentNode=null,this.currentNodeKey=null;for(const s in t)bt(t,s)&&(this[s]=t[s]);this.nodesMap={}}initialize(){this.root=new je({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load?this.load(this.root,s=>{this.root.doCreateChildren(s),this._initDefaultCheckedNodes()}):this._initDefaultCheckedNodes()}filter(t){const s=this.filterNodeMethod,o=this.lazy,n=function(r){const i=r.root?r.root.childNodes:r.childNodes;if(i.forEach(c=>{c.visible=s.call(c,t,c.data,c),n(c)}),!r.visible&&i.length){let c=!0;c=!i.some(l=>l.visible),r.root?r.root.visible=c===!1:r.visible=c===!1}!t||r.visible&&!r.isLeaf&&!o&&r.expand()};n(this)}setData(t){t!==this.root.data?(this.root.setData(t),this._initDefaultCheckedNodes()):this.root.updateChildren()}getNode(t){if(t instanceof je)return t;const s=typeof t!="object"?t:Gt(this.key,t);return this.nodesMap[s]||null}insertBefore(t,s){const o=this.getNode(s);o.parent.insertBefore({data:t},o)}insertAfter(t,s){const o=this.getNode(s);o.parent.insertAfter({data:t},o)}remove(t){const s=this.getNode(t);s&&s.parent&&(s===this.currentNode&&(this.currentNode=null),s.parent.removeChild(s))}append(t,s){const o=s?this.getNode(s):this.root;o&&o.insertChild({data:t})}_initDefaultCheckedNodes(){const t=this.defaultCheckedKeys||[],s=this.nodesMap;t.forEach(o=>{const n=s[o];n&&n.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(t){(this.defaultCheckedKeys||[]).includes(t.key)&&t.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(t){t!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=t,this._initDefaultCheckedNodes())}registerNode(t){const s=this.key;!t||!t.data||(s?t.key!==void 0&&(this.nodesMap[t.key]=t):this.nodesMap[t.id]=t)}deregisterNode(t){!this.key||!t||!t.data||(t.childNodes.forEach(o=>{this.deregisterNode(o)}),delete this.nodesMap[t.key])}getCheckedNodes(t=!1,s=!1){const o=[],n=function(r){(r.root?r.root.childNodes:r.childNodes).forEach(c=>{(c.checked||s&&c.indeterminate)&&(!t||t&&c.isLeaf)&&o.push(c.data),n(c)})};return n(this),o}getCheckedKeys(t=!1){return this.getCheckedNodes(t).map(s=>(s||{})[this.key])}getHalfCheckedNodes(){const t=[],s=function(o){(o.root?o.root.childNodes:o.childNodes).forEach(r=>{r.indeterminate&&t.push(r.data),s(r)})};return s(this),t}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(t=>(t||{})[this.key])}_getAllNodes(){const t=[],s=this.nodesMap;for(const o in s)bt(s,o)&&t.push(s[o]);return t}updateChildren(t,s){const o=this.nodesMap[t];if(!o)return;const n=o.childNodes;for(let r=n.length-1;r>=0;r--){const i=n[r];this.remove(i.data)}for(let r=0,i=s.length;r<i;r++){const c=s[r];this.append(c,o.data)}}_setCheckedKeys(t,s=!1,o){const n=this._getAllNodes().sort((c,l)=>l.level-c.level),r=Object.create(null),i=Object.keys(o);n.forEach(c=>c.setChecked(!1,!1));for(let c=0,l=n.length;c<l;c++){const f=n[c],y=f.data[t].toString();if(!i.includes(y)){f.checked&&!r[y]&&f.setChecked(!1,!1);continue}let A=f.parent;for(;A&&A.level>0;)r[A.data[t]]=!0,A=A.parent;if(f.isLeaf||this.checkStrictly){f.setChecked(!0,!1);continue}if(f.setChecked(!0,!0),s){f.setChecked(!1,!1);const C=function(u){u.childNodes.forEach(v=>{v.isLeaf||v.setChecked(!1,!1),C(v)})};C(f)}}}setCheckedNodes(t,s=!1){const o=this.key,n={};t.forEach(r=>{const i=r||{};n[i[o]]=!0}),this._setCheckedKeys(o,s,n)}setCheckedKeys(t,s=!1){this.defaultCheckedKeys=t;const o=this.key,n={};t.forEach(r=>{n[r]=!0}),this._setCheckedKeys(o,s,n)}setDefaultExpandedKeys(t){t=t||[],this.defaultExpandedKeys=t,t.forEach(s=>{const o=this.getNode(s);o&&o.expand(void 0,this.autoExpandParent)})}setChecked(t,s,o){const n=this.getNode(t);n&&n.setChecked(!!s,o)}getCurrentNode(){return this.currentNode}setCurrentNode(t){const s=this.currentNode;s&&(s.isCurrent=!1),this.currentNode=t,this.currentNode.isCurrent=!0}setUserCurrentNode(t,s=!0){const o=t[this.key],n=this.nodesMap[o];this.setCurrentNode(n),s&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0)}setCurrentNodeKey(t,s=!0){if(t==null){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const o=this.getNode(t);o&&(this.setCurrentNode(o),s&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0))}}const hc=q({name:"AcTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(e){const t=Qe("tree"),s=le("NodeInstance"),o=le("RootTree");return()=>{const n=e.node,{data:r,store:i}=n;return e.renderContent?e.renderContent(It,{_self:s,node:n,data:r,store:i}):o.ctx.slots.default?o.ctx.slots.default({node:n,data:r}):It("span",{class:t.be("node","label")},[n.label])}}});function zo(e){const t=le("TreeNodeMap",void 0),s={treeNodeExpand:o=>{e.node!==o&&e.node.collapse()},children:[]};return t&&t.children.push(s),ne("TreeNodeMap",s),{broadcastExpanded:o=>{if(!!e.accordion)for(const n of s.children)n.treeNodeExpand(o)}}}const Jo=Symbol("dragEvents");function pc({props:e,ctx:t,el$:s,dropIndicator$:o,store:n}){const r=Qe("tree"),i=I({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return ne(Jo,{treeNodeDragStart:({event:y,treeNode:p})=>{if(typeof e.allowDrag=="function"&&!e.allowDrag(p.node))return y.preventDefault(),!1;y.dataTransfer.effectAllowed="move";try{y.dataTransfer.setData("text/plain","")}catch{}i.value.draggingNode=p,t.emit("node-drag-start",p.node,y)},treeNodeDragOver:({event:y,treeNode:p})=>{const A=p,C=i.value.dropNode;C&&C!==A&&gt(C.$el,r.is("drop-inner"));const u=i.value.draggingNode;if(!u||!A)return;let _=!0,v=!0,N=!0,P=!0;typeof e.allowDrop=="function"&&(_=e.allowDrop(u.node,A.node,"prev"),P=v=e.allowDrop(u.node,A.node,"inner"),N=e.allowDrop(u.node,A.node,"next")),y.dataTransfer.dropEffect=v||_||N?"move":"none",(_||v||N)&&C!==A&&(C&&t.emit("node-drag-leave",u.node,C.node,y),t.emit("node-drag-enter",u.node,A.node,y)),(_||v||N)&&(i.value.dropNode=A),A.node.nextSibling===u.node&&(N=!1),A.node.previousSibling===u.node&&(_=!1),A.node.contains(u.node,!1)&&(v=!1),(u.node===A.node||u.node.contains(A.node))&&(_=!1,v=!1,N=!1);const B=A.$el.getBoundingClientRect(),F=s.value.getBoundingClientRect();let $;const Q=_?v?.25:N?.45:1:-1,me=N?v?.75:_?.55:0:1;let Z=-9999;const b=y.clientY-B.top;b<B.height*Q?$="before":b>B.height*me?$="after":v?$="inner":$="none";const K=A.$el.querySelector(`.${r.be("node","expand-icon")}`).getBoundingClientRect(),J=o.value;$==="before"?Z=K.top-F.top:$==="after"&&(Z=K.bottom-F.top),J.style.top=`${Z}px`,J.style.left=`${K.right-F.left}px`,$==="inner"?ms(A.$el,r.is("drop-inner")):gt(A.$el,r.is("drop-inner")),i.value.showDropIndicator=$==="before"||$==="after",i.value.allowDrop=i.value.showDropIndicator||P,i.value.dropType=$,t.emit("node-drag-over",u.node,A.node,y)},treeNodeDragEnd:y=>{const{draggingNode:p,dropType:A,dropNode:C}=i.value;if(y.preventDefault(),y.dataTransfer.dropEffect="move",p&&C){const u={data:p.node.data};A!=="none"&&p.node.remove(),A==="before"?C.node.parent.insertBefore(u,C.node):A==="after"?C.node.parent.insertAfter(u,C.node):A==="inner"&&C.node.insertChild(u),A!=="none"&&n.value.registerNode(u),gt(C.$el,r.is("drop-inner")),t.emit("node-drag-end",p.node,C.node,A,y),A!=="none"&&t.emit("node-drop",p.node,C.node,A,y)}p&&!C&&t.emit("node-drag-end",p.node,null,A,y),i.value.showDropIndicator=!1,i.value.draggingNode=null,i.value.dropNode=null,i.value.allowDrop=!0}}),{dragState:i}}const fc=q({name:"AcTreeNode",components:{NodeContent:hc,Loading:Ks},props:{node:{type:je,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:{type:Boolean,default:!1}},emits:["node-expand"],setup(e,t){const s=Qe("tree"),{broadcastExpanded:o}=zo(e),n=le("RootTree"),r=I(!1),i=I(!1),c=I(!1),l=I(!1),f=I(null),y=le(Jo),p=ho();ne("NodeInstance",p),e.node.expanded&&(r.value=!0,i.value=!0);const A=n.props.children||"children";re(()=>{const b=e.node.data[A];return b&&[...b]},()=>{e.node.updateChildren()}),re(()=>e.node.indeterminate,b=>{_(e.node.checked,b)}),re(()=>e.node.checked,b=>{_(b,e.node.indeterminate)}),re(()=>e.node.expanded,b=>{rt(()=>r.value=b),b&&(i.value=!0)});const C=b=>Gt(n.props.nodeKey,b.data),u=b=>{const K=e.props.class;if(!K)return{};let J;if(gs(K)){const{data:Ve}=b;J=K(Ve,b)}else J=K;return vs(J)?{[J]:!0}:J},_=(b,K)=>{(c.value!==b||l.value!==K)&&n.ctx.emit("check-change",e.node.data,b,K),c.value=b,l.value=K},v=b=>{const K=n.store.value;K.setCurrentNode(e.node),n.ctx.emit("current-change",K.currentNode?K.currentNode.data:null,K.currentNode),n.currentNode.value=e.node,n.props.expandOnClickNode&&P(),n.props.checkOnClickNode&&!e.node.disabled&&B(null,{target:{checked:!e.node.checked}}),n.ctx.emit("node-click",e.node.data,e.node,p,b)},N=b=>{n.instance.vnode.props.onNodeContextmenu&&(b.stopPropagation(),b.preventDefault()),n.ctx.emit("node-contextmenu",b,e.node.data,e.node,p)},P=()=>{e.node.isLeaf||(r.value?(n.ctx.emit("node-collapse",e.node.data,e.node,p),e.node.collapse()):(e.node.expand(),t.emit("node-expand",e.node.data,e.node,p)))},B=(b,K)=>{e.node.setChecked(K.target.checked,!n.props.checkStrictly),rt(()=>{const J=n.store.value;n.ctx.emit("check",e.node.data,{checkedNodes:J.getCheckedNodes(),checkedKeys:J.getCheckedKeys(),halfCheckedNodes:J.getHalfCheckedNodes(),halfCheckedKeys:J.getHalfCheckedKeys()})})};return{ns:s,node$:f,tree:n,expanded:r,childNodeRendered:i,oldChecked:c,oldIndeterminate:l,getNodeKey:C,getNodeClass:u,handleSelectChange:_,handleClick:v,handleContextMenu:N,handleExpandIconClick:P,handleCheckChange:B,handleChildNodeExpand:(b,K,J)=>{o(K),n.ctx.emit("node-expand",b,K,J)},handleDragStart:b=>{!n.props.draggable||y.treeNodeDragStart({event:b,treeNode:e})},handleDragOver:b=>{b.preventDefault(),n.props.draggable&&y.treeNodeDragOver({event:b,treeNode:{$el:f.value,node:e.node}})},handleDrop:b=>{b.preventDefault()},handleDragEnd:b=>{!n.props.draggable||y.treeNodeDragEnd(b)},CaretRight:Vs}}}),_c=["aria-expanded","aria-disabled","aria-checked","draggable","data-key"],mc=["aria-expanded"];function gc(e,t,s,o,n,r){const i=Te,c=Us,l=Y("loading"),f=Y("node-content"),y=Y("ac-tree-node");return X((d(),g("div",{ref:"node$",class:L([e.ns.b("node"),e.ns.is("expanded",e.expanded),e.ns.is("current",e.node.isCurrent),e.ns.is("hidden",!e.node.visible),e.ns.is("focusable",!e.node.disabled),e.ns.is("checked",!e.node.disabled&&e.node.checked),e.getNodeClass(e.node)]),role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.props.draggable,"data-key":e.getNodeKey(e.node),onClick:t[1]||(t[1]=se((...p)=>e.handleClick&&e.handleClick(...p),["stop"])),onContextmenu:t[2]||(t[2]=(...p)=>e.handleContextMenu&&e.handleContextMenu(...p)),onDragstart:t[3]||(t[3]=se((...p)=>e.handleDragStart&&e.handleDragStart(...p),["stop"])),onDragover:t[4]||(t[4]=se((...p)=>e.handleDragOver&&e.handleDragOver(...p),["stop"])),onDragend:t[5]||(t[5]=se((...p)=>e.handleDragEnd&&e.handleDragEnd(...p),["stop"])),onDrop:t[6]||(t[6]=se((...p)=>e.handleDrop&&e.handleDrop(...p),["stop"]))},[a("div",{class:L(e.ns.be("node","content")),style:po({paddingLeft:(e.node.level-1)*e.tree.props.indent+"px"})},[e.tree.props.icon||e.CaretRight?(d(),O(i,{key:0,class:L([e.ns.be("node","expand-icon"),e.ns.is("leaf",e.node.isLeaf),{expanded:!e.node.isLeaf&&e.expanded}]),onClick:se(e.handleExpandIconClick,["stop"])},{default:m(()=>[(d(),O(ys(e.tree.props.icon||e.CaretRight)))]),_:1},8,["class","onClick"])):j("",!0),e.showCheckbox?(d(),O(c,{key:1,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:!!e.node.disabled,onClick:t[0]||(t[0]=se(()=>{},["stop"])),onChange:e.handleCheckChange},null,8,["model-value","indeterminate","disabled","onChange"])):j("",!0),e.node.loading?(d(),O(i,{key:2,class:L([e.ns.be("node","loading-icon"),e.ns.is("loading")])},{default:m(()=>[h(l)]),_:1},8,["class"])):j("",!0),h(f,{node:e.node,"render-content":e.renderContent},null,8,["node","render-content"])],6),!e.renderAfterExpand||e.childNodeRendered?X((d(),g("div",{key:0,class:L(e.ns.be("node","children")),role:"group","aria-expanded":e.expanded},[(d(!0),g(G,null,oe(e.node.childNodes,p=>(d(),O(y,{key:e.getNodeKey(p),"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:p,accordion:e.accordion,props:e.props,onNodeExpand:e.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,mc)),[[ie,e.expanded]]):j("",!0)],42,_c)),[[ie,e.node.visible]])}var vc=H(fc,[["render",gc]]);function yc({el$:e},t){const s=Qe("tree"),o=Qt([]),n=Qt([]);dt(()=>{i(),cc(e.value,"keydown",r)}),As(()=>{lc(e.value,"keydown",r)}),Cs(()=>{o.value=Array.from(e.value.querySelectorAll("[role=treeitem]")),n.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"))}),re(n,c=>{c.forEach(l=>{l.setAttribute("tabindex","-1")})});const r=c=>{const l=c.target;if(!l.className.includes(s.b("node")))return;const f=c.code;o.value=Array.from(e.value.querySelectorAll(`.${s.is("focusable")}[role=treeitem]`));const y=o.value.indexOf(l);let p;if([we.up,we.down].includes(f)){if(c.preventDefault(),f===we.up){p=y===-1?0:y!==0?y-1:o.value.length-1;const C=p;for(;!t.value.getNode(o.value[p].dataset.key).canFocus;){if(p--,p===C){p=-1;break}p<0&&(p=o.value.length-1)}}else{p=y===-1?0:y<o.value.length-1?y+1:0;const C=p;for(;!t.value.getNode(o.value[p].dataset.key).canFocus;){if(p++,p===C){p=-1;break}p>=o.value.length&&(p=0)}}p!==-1&&o.value[p].focus()}[we.left,we.right].includes(f)&&(c.preventDefault(),l.click());const A=l.querySelector('[type="checkbox"]');[we.enter,we.space].includes(f)&&A&&(c.preventDefault(),A.click())},i=()=>{var l;o.value=Array.from(e.value.querySelectorAll(`.${s.is("focusable")}[role=treeitem]`)),n.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"));const c=e.value.querySelectorAll(`.${s.is("checked")}[role=treeitem]`);if(c.length){c[0].setAttribute("tabindex","0");return}(l=o.value[0])==null||l.setAttribute("tabindex","0")}}const Ac=q({name:"AcTree",components:{AcTreeNode:vc},props:{data:{type:Array,default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:[String,Object]},emits:["check-change","current-change","node-click","node-contextmenu","node-collapse","node-expand","check","node-drag-start","node-drag-end","node-drop","node-drag-leave","node-drag-enter","node-drag-over"],setup(e,t){const s=Qe("tree"),o=I(new uc({key:e.nodeKey,data:e.data,lazy:e.lazy,props:e.props,load:e.load,currentNodeKey:e.currentNodeKey,checkStrictly:e.checkStrictly,checkDescendants:e.checkDescendants,defaultCheckedKeys:e.defaultCheckedKeys,defaultExpandedKeys:e.defaultExpandedKeys,autoExpandParent:e.autoExpandParent,defaultExpandAll:e.defaultExpandAll,filterNodeMethod:e.filterNodeMethod}));o.value.initialize();const n=I(o.value.root),r=I(null),i=I(null),c=I(null),{broadcastExpanded:l}=zo(e),{dragState:f}=pc({props:e,ctx:t,el$:i,dropIndicator$:c,store:o});yc({el$:i},o);const y=Re(()=>{const{childNodes:w}=n.value;return!w||w.length===0||w.every(({visible:R})=>!R)});re(()=>e.defaultCheckedKeys,w=>{o.value.setDefaultCheckedKey(w)}),re(()=>e.defaultExpandedKeys,w=>{o.value.setDefaultExpandedKeys(w)}),re(()=>e.data,w=>{o.value.setData(w)},{deep:!0}),re(()=>e.checkStrictly,w=>{o.value.checkStrictly=w});const p=w=>{if(!e.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");o.value.filter(w)},A=w=>Gt(e.nodeKey,w.data),C=w=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const R=o.value.getNode(w);if(!R)return[];const ge=[R.data];let ke=R.parent;for(;ke&&ke!==n.value;)ge.push(ke.data),ke=ke.parent;return ge.reverse()},u=(w,R)=>o.value.getCheckedNodes(w,R),_=w=>o.value.getCheckedKeys(w),v=()=>{const w=o.value.getCurrentNode();return w?w.data:null},N=()=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const w=v();return w?w[e.nodeKey]:null},P=(w,R)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");o.value.setCheckedNodes(w,R)},B=(w,R)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");o.value.setCheckedKeys(w,R)},F=(w,R,ge)=>{o.value.setChecked(w,R,ge)},$=()=>o.value.getHalfCheckedNodes(),Q=()=>o.value.getHalfCheckedKeys(),me=(w,R=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");o.value.setUserCurrentNode(w,R)},Z=(w,R=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");o.value.setCurrentNodeKey(w,R)},b=w=>o.value.getNode(w),K=w=>{o.value.remove(w)},J=(w,R)=>{o.value.append(w,R)},Ve=(w,R)=>{o.value.insertBefore(w,R)},pt=(w,R)=>{o.value.insertAfter(w,R)},ft=(w,R,ge)=>{l(R),t.emit("node-expand",w,R,ge)},_t=(w,R)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");o.value.updateChildren(w,R)};return ne("RootTree",{ctx:t,props:e,store:o,root:n,currentNode:r,instance:ho()}),{ns:s,store:o,root:n,currentNode:r,dragState:f,el$:i,dropIndicator$:c,isEmpty:y,filter:p,getNodeKey:A,getNodePath:C,getCheckedNodes:u,getCheckedKeys:_,getCurrentNode:v,getCurrentKey:N,setCheckedNodes:P,setCheckedKeys:B,setChecked:F,getHalfCheckedNodes:$,getHalfCheckedKeys:Q,setCurrentNode:me,setCurrentKey:Z,getNode:b,remove:K,append:J,insertBefore:Ve,insertAfter:pt,handleNodeExpand:ft,updateKeyChildren:_t}}});function Cc(e,t,s,o,n,r){var c;const i=Y("ac-tree-node");return d(),g("div",{ref:"el$",class:L([e.ns.b(),e.ns.is("dragging",!!e.dragState.draggingNode),e.ns.is("drop-not-allow",!e.dragState.allowDrop),e.ns.is("drop-inner",e.dragState.dropType==="inner"),{[e.ns.m("highlight-current")]:e.highlightCurrent}]),role:"tree"},[(d(!0),g(G,null,oe(e.root.childNodes,l=>(d(),O(i,{key:e.getNodeKey(l),node:l,props:e.props,accordion:e.accordion,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent,onNodeExpand:e.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),e.isEmpty?(d(),g("div",{key:0,class:L(e.ns.e("empty-block"))},[a("span",{class:L(e.ns.e("empty-text"))},M((c=e.emptyText)!=null?c:"\u6682\u65E0\u6570\u636E"),3)],2)):j("",!0),X(a("div",{ref:"dropIndicator$",class:L(e.ns.e("drop-indicator"))},null,2),[[ie,e.dragState.showDropIndicator]])],2)}var Ec=H(Ac,[["render",Cc]]);const kc={props:{status:{type:String,default:()=>"success",validate(e){return["success","error"].indexOf(e)!==-1}},title:{type:String,default:()=>""},subTitle:{type:String,default:()=>""},styles:{type:Object,default:()=>({})}}},wc={class:"result"},Nc={class:"result-title"},Ic={class:"mt-1 result-subtitle"};function bc(e,t,s,o,n,r){return d(),g("div",wc,[a("div",{class:"result-icon",style:po(s.styles)},[st(e.$slots,"icon",{},void 0,!0)],4),st(e.$slots,"title",{},()=>[a("p",Nc,M(s.title),1)],!0),a("p",Ic,[st(e.$slots,"subTitle",{},()=>[U(M(s.subTitle),1)],!0)])])}var Dc=H(kc,[["render",bc],["__scopeId","data-v-a27469de"]]),Wo="/assets/icon-no-result.4a7ec4ce.png";const qo=e=>(at("data-v-23a918b8"),e=e(),ct(),e),Pc={class:"search-result scroll-content text-left"},Sc=["onClick"],jc={class:"truncate px-2 hover:bg-gray-100"},Rc=qo(()=>a("img",{src:Wo},null,-1)),xc=qo(()=>a("span",null,"\u672A\u627E\u5230\u641C\u7D22\u7ED3\u679C\uFF01",-1)),Tc=q({setup(e,{expose:t}){const{params:s}=fo(),{push:o}=xe(),{apiDocTree:n}=ue(Ho()),r=I(!1),i=I(!1),c=I(!1),l=I(""),f=I([]),y=I(),p=I(),A=I(),C=I();co(y,()=>{r.value=!1,_()},{ignore:[C]});const u=xt(()=>{const P=k(l);P.length<2||(i.value=!0,c.value=!0,xi(s.project_id,P).then(B=>{f.value=B.data||[]}).catch(B=>{}).finally(()=>{c.value=!1}))},200),_=()=>{f.value=[],l.value="",i.value=!1},v=P=>{let B=null;Ie($=>{if($.id===parseInt(P.node_id,10))return B=$,!1},n.value||[],{subKey:"sub_nodes"});const F=ul({project_id:s.project_id,node_id:P.node_id});B?o({path:F}):location.href=F};return t({show:P=>{C.value=P,r.value=!0,A.value.focus()}}),(P,B)=>{const F=ut,$=Dc,Q=Mt,me=ht;return d(),O(Q,{visible:r.value,"onUpdate:visible":B[1]||(B[1]=Z=>r.value=Z),ref_key:"popoverRef",ref:p,placement:"bottom-end","virtual-ref":C.value,"virtual-triggering":"",width:"auto"},{default:m(()=>[a("div",{ref_key:"searchDomRef",ref:y,class:"search-poptip"},[h(F,{ref_key:"searchInput",ref:A,"suffix-icon":k(ko),placeholder:"\u5173\u952E\u5B57 \u56DE\u8F66\u641C\u7D22",modelValue:l.value,"onUpdate:modelValue":B[0]||(B[0]=Z=>l.value=Z),onChange:k(u),clearable:""},null,8,["suffix-icon","modelValue","onChange"]),X((d(),g("div",Pc,[(d(!0),g(G,null,oe(f.value,(Z,b)=>(d(),g("span",{class:"cursor-pointer",key:Z.doc_id+"_"+b,onClick:K=>v(Z)},[a("h4",jc,M(Z.title),1)],8,Sc))),128)),X(h($,null,{icon:m(()=>[Rc]),title:m(()=>[xc]),_:1},512),[[ie,i.value&&!c.value&&!f.value.length]])])),[[ie,i.value],[me,c.value]])],512)]),_:1},8,["visible","virtual-ref"])}}});var Lc=H(Tc,[["__scopeId","data-v-23a918b8"]]),Oc=q({components:{AcTree:Ec,Plus:Gs,Search:ko,MoreFilled:vo,SearchDocumentPopover:Lc},setup(){const e=le("documentShareModal"),t=le("documentImportModal"),s=le("projectExportModal"),o=fo(),n=xe(),{currentRoute:r}=n,{params:i}=o,{project_id:c}=i,l=Ho(),{apiDocTree:f}=ue(l),y=_e(),{isManager:p,isDeveloper:A}=ue(y),C=Yo,u=I(null),_=I(null),v=I(null),N=I(null),P=I(null);let B=1;const F=null,$=Re(()=>r.value.name===Se);re(()=>o.params.node_id,()=>R());const Q=(x,S,ee)=>{if(ee.target.tagName!=="INPUT"){if(S.isLeaf){me(S);return}x.expanded=!x.expanded}},me=x=>{const{node_id:S}=r.value.params;$.value&&x.id===parseInt(S,10)||(R(x.id),n.push({name:Se,params:ve(V({},i),{node_id:x.id})}))},Z=(x,S,ee,te)=>{x.stopPropagation(),u.value=ee.id,wt.show(te,x.target,{node:S,source:ee,isDetailPage:$.value},P.value)},b=x=>{var S;Z(x,(S=v.value)==null?void 0:S.root,f.value,"DIR_NEW_TYPE")},K=Es(function(x){let S=0;return Ie(ee=>{ee.isLeaf||S++},[x],{subKey:"sub_nodes"}),S}),J=(x,S,ee)=>{const{data:te}=S,{data:he}=x;return te.isLeaf&&ee==="inner"?!1:!he.isLeaf&&!te.isLeaf?K(he)+S.level<=5:!0},Ve=x=>x.isLeaf?"is-doc":"is-dir",pt=x=>x.type===be.DOC,ft=async()=>{var x;await rt(),_.value&&(Zt(_.value,{scrollMode:"if-needed"}),_.value.focus(),_.value.setSelectionRange(0,(x=_.value)==null?void 0:x.value.length))},_t=x=>{x.target&&x.target.blur()},w=xt(function(x,S){if(S.isEditable=!1,!x.target.value&&S._oldName){S.title=S._oldName;return}const ee=S.type===be.DIR,te=ee?sc:Mi,he={project_id:c,title:S.title};he[ee?"node_id":"doc_id"]=S.id,te(he).then(()=>{delete S._oldName}).catch(()=>{S._oldName&&(S.title=S._oldName)})},200),R=x=>{var zt,Jt;Ie(Wt=>{if(Wt.isCurrent)return Wt.isCurrent=!1,!1},f.value,{subKey:"sub_nodes"});const{node_id:S}=r.value.params,te=parseInt(x||S,10),he=(zt=v.value)==null?void 0:zt.getNode(te);he&&(he.data.isCurrent=!0,(Jt=v.value)==null||Jt.setCurrentKey(te));const Le=document.querySelector("#tree_node_"+te);Le&&Zt(Le,{scrollMode:"if-needed"})},ge=()=>{if(!v.value)return;let x=!1;if(Ie(S=>{if(S.isCurrent)return x=!0,!1},f.value,{subKey:"sub_nodes"}),!x){let S=null;Ie(he=>{let Le=v.value.getNode(he.id);if(Le&&Le.data.isLeaf)return S=Le,!1},f.value,{subKey:"sub_nodes"});let ee={project_id:c};S&&(ee.node_id=S.key,R(S.key));const te=P.value;te==null||te.scrollTo(0,0),n.replace({name:Se,params:ee})}},ke=async()=>{await l.getApiDocTree(c)},Qo=x=>{var S;(S=N.value)==null||S.show(x.currentTarget)};return dt(async()=>{await ke(),r.value.params.node_id?R():ge()}),{isManager:p,isDeveloper:A,router:n,index:B,oldDraggingNodeInfo:F,project_id:c,apiDocTree:f,renameInput:_,dir:P,activeMoreNodeId:u,treeIns:v,newMenus:C,documentShareModal:e,createDocIcon:Go,handleTreeNodeClick:Q,onRootMoreIconClick:b,onMoreIconClick:Z,onSearchIconClick:Qo,allowDrop:J,customNodeClass:Ve,customNodeLeaf:pt,onEnterKeyUp:_t,setUnEditable:w,inputFocus:ft,activeNode:R,reactiveNode:ge,documentImportModal:t,projectExportModal:s,searchDocumentPopoverRef:N}},mounted(){wt.onPopperItemClick=({menu:e,node:t,source:s})=>this.onPopperItemClick(e,t,s),wt.onPopperHide=()=>{this.activeMoreNodeId=null}},methods:{onPopperItemClick(e,t,s){const o=this[e.onClick];o&&o(t||this.treeIns.root,s||{sub_nodes:this.apiDocTree,id:0},e)},onRenameBtnClick(e,t){t._oldName=t.title,t.isEditable=!0,this.inputFocus()},onDeleteBtnClick(e,t){let s=!t.isLeaf;Mo({title:"\u5220\u9664\u63D0\u793A",content:h("div",{class:"break-all"},[U("\u786E\u5B9A\u5220\u9664\u300C"),t.title,U("\u300D"),s?"\u5206\u7C7B":"\u6587\u4EF6",U("\u5417\uFF1F")]),onOk:()=>{const o=t.type===be.DIR,n=o?oc:Bi;let r={project_id:this.project_id};return r[o?"node_id":"doc_id"]=t.id,n(r).then(i=>{pe.success(i.msg||"\u5220\u9664\u6210\u529F\uFF01"),this.treeIns.remove(e),this.reactiveNode()})}})},onCreateDirBtnClick(e,t){let s={project_id:this.project_id,name:"\u65B0\u5EFA\u5206\u7C7B"+this.index++};t.id&&(s.parent_id=t.id,s.pid=t.id),Ae.start(),tc(s).then(o=>{const n=et(o.data,be.DIR);!e.parent&&e.level===0?t.unshift(n):!t.sub_nodes||!t.sub_nodes.length?this.treeIns.append(n,e):this.treeIns.insertBefore(n,t.sub_nodes[0]),this.$nextTick(()=>{const r=this.treeIns.getNode(t);r&&(r.expanded=!0);const i=this.treeIns.getNode(o.data);i.data.isEditable=!0,setTimeout(()=>this.inputFocus(),100)})}).finally(()=>{Ae.done()})},createDoc(e,t){let s={project_id:this.project_id,parent_id:e.key,pid:e.key};Ae.start(),Ti(s).then(({data:o})=>{this.treeIns.append(et(o),e),this.$nextTick(()=>{this.treeIns.setCurrentKey(o.id);const n=this.treeIns.getNode(t);n&&(n.expanded=!0),this.router.push({name:Pe,params:{project_id:this.project_id,node_id:o.id},query:{isNew:!0}}),this.activeNode(o.id)})}).finally(()=>{Ae.done()})},onMoveNodeStart(e){const t=e.parent;this.oldDraggingNodeInfo={oldPid:t.id===0?null:t.key,oldChildIds:t.childNodes.filter(s=>s.id!==e.id).map(s=>s.key)}},onMoveNode(e,t,s){if(!this.oldDraggingNodeInfo)return;const{oldPid:o,oldChildIds:n}=this.oldDraggingNodeInfo;let r=o===t.parent.id&&s!=="inner";const i=this.treeIns.getNode(e.data).parent,c=i.id===0?null:i.key,l=i.childNodes.map(y=>y.key),f={oldPid:r?c:o,oldChildIds:r?l:n,newPid:c,newChildIds:l};this.oldDraggingNodeInfo=null,nc({new_pid:f.newPid||0,new_node_ids:f.newChildIds,old_pid:f.oldPid||0,old_node_ids:f.oldChildIds,project_id:this.project_id})},onCopyBtnClick(e,t){Ae.start(),Oi({project_id:this.project_id,doc_id:t.id}).then(({data:s})=>{this.treeIns.insertAfter(et(s),e),this.router.push({name:Pe,params:{project_id:this.project_id,node_id:s.id}})}).finally(()=>{Ae.done()})},onShareBtnClick(e,t){this.documentShareModal.show({docId:t.id,nodeId:t.id})},onImportBtnClick(e,t){this.documentImportModal.show({project_id:this.project_id,parent_id:t.id?t.id:0},Vi)},onExportBtnClick(e,t){this.projectExportModal.title="\u5BFC\u51FA\u6587\u6863",this.projectExportModal.show({project_id:this.project_id,doc_id:t.id},Uo)},updateTreeNode(e,t={title:""}){let s=this.treeIns.getNode(e);s&&s.data.title&&(s.data.title=t.title||s.title)},createHttpDoc(e,t){let s={project_id:this.project_id,parent_id:e.key,pid:e.key};Ae.start(),Li(s).then(({data:o})=>{this.treeIns.append(et(o),e),this.$nextTick(()=>{const n=this.treeIns.getNode(t);n&&(n.expanded=!0),this.router.push({name:Pe,params:{project_id:this.project_id,node_id:o.id},query:{isNew:!0}})})}).finally(()=>{Ae.done()})}}});const Mc={class:"h-full flex flex-col"},Bc={class:"ac-doc-catalog"},$c=a("h3",{class:"text-base font-medium"},"\u76EE\u5F55",-1),Fc={class:"overflow-x-scroll scroll-content flex-auto",ref:"dir"},Kc=a("div",{class:"el-tree-node__bg"},null,-1),Vc=["onClick"],Uc=["id"],Gc=["src"],Yc=["title"],Hc=["id","onUpdate:modelValue","maxlength","onBlur"],zc=a("span",{class:"mx-1"},null,-1);function Jc(e,t,s,o,n,r){const i=Y("Search"),c=Te,l=Y("Plus"),f=Y("plus"),y=Y("more-filled"),p=Y("ac-tree"),A=Y("SearchDocumentPopover");return d(),g(G,null,[a("div",Mc,[a("div",Bc,[$c,a("div",null,[h(c,{class:L(["cursor-pointer text-zinc-500",{"mr-5":e.isManager||e.isDeveloper}]),onClick:e.onSearchIconClick},{default:m(()=>[h(i)]),_:1},8,["class","onClick"]),e.isManager||e.isDeveloper?(d(),O(c,{key:0,class:"cursor-pointer text-zinc-500",onClick:e.onRootMoreIconClick},{default:m(()=>[h(l)]),_:1},8,["onClick"])):j("",!0)])]),a("div",Fc,[h(p,{data:e.apiDocTree,class:"bg-transparent","node-key":"id","empty-text":"",draggable:e.isManager||e.isDeveloper,ref:"treeIns","expand-on-click-node":!1,props:{children:"sub_nodes",label:"title",class:e.customNodeClass,isLeaf:e.customNodeLeaf},"allow-drop":e.allowDrop,onNodeDragStart:e.onMoveNodeStart,onNodeDrop:e.onMoveNode},{default:m(({node:C,data:u})=>[Kc,a("div",{class:L(["flex justify-between ac-tree-node",{"is-editable":u.isEditable}])},[a("div",{class:"ac-tree-node__main",onClick:_=>e.handleTreeNodeClick(C,u,_)},[a("div",{class:L(["ac-doc-node",{"is-active":u.isCurrent}]),id:"tree_node_"+u.id},[u.isLeaf?(d(),g("img",{key:0,class:"ac-doc-node__icon",src:e.createDocIcon},null,8,Gc)):j("",!0),X(a("span",{class:"ac-doc-node__label",title:u.title},M(u.title),9,Yc),[[ie,!u.isEditable]]),u.isEditable?X((d(),g("input",{key:1,type:"text",ref:"renameInput",class:"ac-doc-node__input el-input el-input__inner",id:"tree_input_"+u.id,"onUpdate:modelValue":_=>u.title=_,onKeyup:t[0]||(t[0]=mo((..._)=>e.onEnterKeyUp&&e.onEnterKeyUp(..._),["enter"])),maxlength:u.isLeaf?255:50,onBlur:_=>e.setUnEditable(_,u)},null,40,Hc)),[[_o,u.title]]):j("",!0)],10,Uc)],8,Vc),e.isManager||e.isDeveloper?(d(),g("div",{key:0,class:L(["ac-tree-node__more",{active:u.id===e.activeMoreNodeId}])},[X(h(c,{onClick:_=>e.onMoreIconClick(_,C,u,"DIR_NEW_TYPE")},{default:m(()=>[h(f)]),_:2},1032,["onClick"]),[[ie,!u.isLeaf]]),zc,X(h(c,{onClick:_=>e.onMoreIconClick(_,C,u,"DIR_OPERATE_TYPE")},{default:m(()=>[h(y)]),_:2},1032,["onClick"]),[[ie,!u.isLeaf]]),X(h(c,{onClick:_=>e.onMoreIconClick(_,C,u,"DOC_OPERATE_TYPE")},{default:m(()=>[h(y)]),_:2},1032,["onClick"]),[[ie,u.isLeaf]])],2)):j("",!0)],2)]),_:1},8,["data","draggable","props","allow-drop","onNodeDragStart","onNodeDrop"])],512)]),h(A,{ref:"searchDocumentPopoverRef"},null,512)],64)}var Wc=H(Oc,[["render",Jc]]);const qc=(e={})=>Dt.post("/upload_path",e),Nt={},jd=e=>new Promise((t,s)=>{const o={complete:!1,width:0,height:0,src:e};if(!e){s(o);return}if(Nt[e]){t(V({},Nt[e]));return}const n=new Image;n.onload=()=>{o.width=n.width,o.height=n.height,o.complete=!0,Nt[e]=V({},o),t(o)},n.onerror=()=>{s(o)},n.src=e});function ce(){this.chunkSize=1024*1024,this.threadsQuantity=2,this.timeout=1e3*10,this.file=null,this.aborted=!1,this.uploadedSize=0,this.progressCache={},this.activeConnections={},this.taskConfig={}}ce.prototype.setOptions=function(e={}){this.chunkSize=e.chunkSize||this.chunkSize,this.threadsQuantity=e.threadsQuantity||this.threadsQuantity};ce.prototype.setupFile=function(e){!e||(this.file=e)};ce.prototype.start=function(){if(!this.file)throw new Error("Can't start uploading: file have not chosen");const e=Math.ceil(this.file.size/this.chunkSize);this.chunksQueue=new Array(e).fill().map((o,n)=>n).reverse();const t=new XMLHttpRequest;t.timeout=this.timeout,t.open("post","/api/upload_init"),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.setRequestHeader("Accept","application/json, text/plain, */*");let s=D.get(D.KEYS.TOKEN)||"";s&&t.setRequestHeader("Authorization",s),t.withCredentials=!0,t.onreadystatechange=()=>{if(t.readyState===XMLHttpRequest.DONE&&t.status===200){const{status:o,msg:n,data:r}=JSON.parse(t.responseText);if(o!==0){this.complete(new Error(n||"\u4E0A\u4F20\u521D\u59CB\u5316\u5931\u8D25\uFF01"));return}this.fileId=r.file_id,this.sendNext()}},t.onerror=o=>{this.complete(o)},t.ontimeout=o=>{this.complete(o)},t.send(JSON.stringify({name:this.file.name,chunks:e,fileSize:Math.ceil(this.file.size/1024)}))};ce.prototype.sendNext=function(){const e=Object.keys(this.activeConnections).length;let t=!1;if(Object.keys(this.taskConfig).forEach(r=>{this.taskConfig[r].retryCount>=3&&(t=!0)}),t){this.complete(new Error("\u4E0A\u4F20\u5931\u8D25\uFF01"));return}if(e>=this.threadsQuantity)return;if(!this.chunksQueue.length){e||this.getResult();return}const s=this.chunksQueue.pop(),o=s*this.chunkSize,n=this.file.slice(o,o+this.chunkSize);this.sendChunk(n,s).then(()=>this.sendNext()).catch(r=>{this.chunksQueue.push(s);let i=this.taskConfig[s];i&&i.retryCount<=3?this.sendNext():this.complete(r)}),this.sendNext()};ce.prototype.complete=function(e){const t=e&&e.message||e;if(e&&!this.aborted){this.end(t);return}this.end(t)};ce.prototype.sendChunk=function(e,t){return this.upload(t,e)};ce.prototype.handleProgress=function(e,t){(t.type==="progress"||t.type==="error"||t.type==="abort")&&(this.progressCache[e]=t.loaded),t.type==="loadend"&&(this.uploadedSize+=this.progressCache[e]||0,delete this.progressCache[e]);const s=Object.keys(this.progressCache).reduce((n,r)=>n+=this.progressCache[r],0),o=Math.min(this.uploadedSize+s,this.file.size);this.onProgress&&this.onProgress({loaded:o,total:this.file.size})};ce.prototype.upload=function(e,t){return new Promise((s,o)=>{let n=this.taskConfig[e]=this.taskConfig[e]||{retryCount:0};const r=this.activeConnections[e]=new XMLHttpRequest;r.timeout=this.timeout;const i=this.handleProgress.bind(this,e);r.upload.addEventListener("progress",i),r.addEventListener("error",i),r.addEventListener("abort",i),r.addEventListener("loadend",i),r.open("post","/api/upload_save"),r.setRequestHeader("Accept","application/json, text/plain, */*");let c=D.get(D.KEYS.TOKEN)||"";c&&r.setRequestHeader("Authorization",c),r.onreadystatechange=()=>{if(delete this.activeConnections[e],r.readyState===XMLHttpRequest.DONE&&r.status===200){const f=JSON.parse(r.responseText);if(f.status!==0){o(new Error(f.msg||"\u4E0A\u4F20\u5931\u8D25\uFF01")),n.retryCount++;return}f.status===0&&s(f)}r.readyState===XMLHttpRequest.DONE&&r.status!==200&&(o(new Error("\u4E0A\u4F20\u5931\u8D25\uFF01")),n.retryCount++)},r.onerror=f=>{o(f),delete this.activeConnections[e]},r.onabort=()=>{o(new Error("\u53D6\u6D88\u4E0A\u4F20\uFF01")),delete this.activeConnections[e]},r.ontimeout=f=>{o(f),delete this.activeConnections[e]};let l=new FormData;l.append("file_id",this.fileId),l.append("chunk_id",e),l.append("file",t),r.send(l)})};ce.prototype.on=function(e,t){typeof t!="function"&&(t=Ye),this[e]=t};ce.prototype.abort=function(){Object.keys(this.activeConnections).forEach(e=>{this.activeConnections[e].abort()}),this.aborted=!0};ce.prototype.getResult=function(){qc({file_id:this.fileId}).then(e=>this.end(null,e)).catch(e=>this.complete(e))};const Qc=function(){const e=new ce;return{options:function(t){return e.setOptions(t),this},send:function(t){return e.setupFile(t),this},continue:function(){e.sendNext()},onProgress:function(t){return e.on("onProgress",t||Ye),this},end:function(t){return e.on("end",t||Ye),e.start(),this},abort:function(){e.abort()}}};const Zc={props:{maxSize:{type:Number,default:1},multiple:{type:Boolean,default:!1}},data(){return{isShow:!1,isLoading:!1,isPoll:!1,title:"\u5BFC\u5165\u6587\u6863",params:{},jobParams:{id:null},importList:[],currentConfig:null,timer:null}},methods:{projectItemClass(e){return["ac-project-export-item","ac-project-export-file",{disabled:e.disabled}]},hide(){this.isShow=!1},show(e,t){this.clearTimer(),this.isShow=!0,this.importList=t||[],this.params=e||{}},onFileChange(e,t){this.currentConfig=t||{},this.validFile(e)&&this.upload()},validFile(e){const t=e.target.files;if(!t)return!1;let s=Array.prototype.slice.call(t);if(this.multiple||(s=s.slice(0,1)),s.length===0)return!1;let o=s[0];e.target.value=null;let{maxSize:n}=this.currentConfig;return n=n||this.maxSize,o.size>n*1024*1024?(this.$Message.error(`\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7${n}MB`),!1):(this.currentConfig.file=o,!0)},upload(){if(!this.currentConfig||!this.currentConfig.file)return this.$Message.error("\u672A\u9009\u62E9\u6587\u4EF6\uFF01");this.isLoading=!0,Qc().options().send(this.currentConfig.file).end((e,t)=>{if(e){this.isLoading=!1,this.$Message.error(e instanceof Error?e.message:e);return}this.currentConfig.fileUrl=t.data,this.getImportJobId(this.buildParams())})},getImportJobId(e){if(!this.currentConfig||!this.currentConfig.action)return this.isLoading=!1,Promise.resolve();this.currentConfig.action(e).then(t=>{this.jobParams.id=t.data||null,this.isPoll=!0,this.getExecResult()}).catch(()=>{this.isLoading=!1})},clearTimer(){this.currentConfig=null,this.isLoading=!1,this.isPoll=!1},async exec(){if(!this.currentConfig||!this.currentConfig.getJobResult||!this.jobParams.id)return this.clearTimer(),Promise.resolve();try{const{data:e,msg:t}=await this.currentConfig.getJobResult(this.params.project_id,this.jobParams.id);if(e.result===Me.FAIL){this.$Message.error(t||"\u5BFC\u5165\u5931\u8D25\uFF01"),this.clearTimer();return}if(e.result===Me.WAIT)return;e.result===Me.FINISH&&(this.$Message.success(t||"\u5BFC\u5165\u5B8C\u6210\uFF01"),this.clearTimer(),this.hide(),location.reload())}catch{this.clearTimer()}},async getExecResult(){for(;this.isPoll;)await this.exec(),await lo(2e3)},buildParams(){return this.currentConfig?ve(V({},this.params),{filename:this.currentConfig.file?this.currentConfig.file.name:"\u672A\u547D\u540D",file:this.currentConfig.fileUrl,type:this.currentConfig.type}):{}}}},Xc={class:"ac-project-export","element-loading-text":"\u5BFC\u5165\u4E2D\uFF0C\u8BF7\u52FF\u5173\u95ED\u7A97\u53E3\uFF01"},el={class:"ac-project-export-inner"},tl=["src","alt"],ol={class:"mt-1.5"},sl=["onChange","accept"];function nl(e,t,s,o,n,r){const i=We,c=ht;return d(),O(i,{modelValue:n.isShow,"onUpdate:modelValue":t[0]||(t[0]=l=>n.isShow=l),width:"fit-content","custom-class":"vertical-center-modal","close-on-click-modal":!1,title:n.title,"append-to-body":""},{default:m(()=>[X((d(),g("div",Xc,[(d(!0),g(G,null,oe(n.importList,l=>(d(),g("div",{class:L(r.projectItemClass(l)),key:l.type},[a("div",el,[a("img",{src:l.icon,alt:l.text},null,8,tl),a("p",ol,M(l.text),1),a("input",{type:"file",onChange:f=>r.onFileChange(f,l),accept:l.accept},null,40,sl)])],2))),128))])),[[c,n.isLoading]])]),_:1},8,["modelValue","title"])}var rl=H(Zc,[["render",nl],["__scopeId","data-v-786673b5"]]);const il={class:"ac-doc-layout__left"},al={class:"ac-doc-layout__right scroll-content"},cl=q({setup(e){const{currentRoute:t}=xe(),s=_e(),{isGuest:o,isReader:n,isManager:r,isDeveloper:i,projectInfo:c}=ue(s),l=I(),f=I(),y=I(),p=I(),A=I(""),C=Re(()=>["ac-doc-layout",{readonly:o.value||n.value}]),u=Re(()=>!isNaN(parseInt(t.value.params.node_id,10)));return ne("documentShareModal",y),ne("projectExportModal",l),ne("documentImportModal",f),ne("updateTreeNode",(_,v)=>p.value&&p.value.updateTreeNode(_,v)),ne("setDocumentTitle",_=>{A.value=_}),(_,v)=>{const N=Y("router-view"),P=ji;return d(),g(G,null,[k(c)?(d(),g("main",{key:0,class:L(k(C))},[k(o)?(d(),O(Ca,{key:0})):(d(),O(_a,{key:1})),k(u)?(d(),g(G,{key:2},[k(r)||k(i)?(d(),O(Sa,{key:0,title:A.value},null,8,["title"])):j("",!0)],64)):j("",!0),a("div",il,[h(Wc,{ref_key:"directoryTree",ref:p},null,512)]),a("div",al,[h(N)])],2)):j("",!0),h(P,{ref_key:"projectExportModal",ref:l},null,512),h(rl,{ref_key:"documentImportModal",ref:f},null,512),h(Zi,{ref_key:"documentShareModal",ref:y},null,512)],64)}}}),ll=()=>z(()=>import("./DocumentDetail.84410c52.js"),["assets/DocumentDetail.84410c52.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js","assets/useHighlight.30d88e48.js"]),dl=()=>z(()=>import("./DocumentEditor.0be0564a.js"),["assets/DocumentEditor.0be0564a.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js","assets/params.5bd71d6d.js"]),ul=fe(Ut);fe(So);var hl={path:nn,name:Ft,component:cl,redirect:{name:Se},children:[{path:Ut,name:Se,meta:{ignoreAuth:!0},component:ll},{path:So,name:Pe,component:dl}]};const pl=q({setup(e){return(t,s)=>{const o=Te,n=Ys;return d(),O(n,ks(t.$attrs,{class:"ac-backtop"}),{default:m(()=>[h(o,null,{default:m(()=>[h(k(Hs))]),_:1})]),_:1},16)}}});var fl=H(pl,[["__scopeId","data-v-de5b7756"]]);const Rd=e=>E.post("/api_doc/secretkey_check",e),_l=e=>E.get("/api_doc/has_shared",{params:{doc_id:e}}),ml=(e,t)=>E.get("/api_doc",{params:{doc_id:e,token:t,format:"html"}}),xd=(e,t)=>E.get("/api_doc",{params:{project_id:e,doc_id:t,deleted:1,format:"html"}}),gl=e=>E.get("/preview/project",{params:{project_id:e}}),Td=e=>E.post("/project/secretkey_check",e),vl=(e,t,s)=>E.get("/preview/search",{params:{project_id:t,keywords:s,token:e}}),yl={name:"ProjectSearch",data(){return{data:[],isLoading:!1,isNoData:!1,isShowSearchResult:!1,form:{token:D.get(D.KEYS.SECRET_PROJECT_TOKEN+this.$route.params.project_id||"",!0),project_id:this.$route.params.project_id,keywords:""}}},methods:{onClickSearchResult(e){let t=!1;Ie(s=>{if(s.id===(e.node_id||e.doc_id))return t=!0,!1},[]),t?this.$router.push(e.link):location.href=e.href},onStop(e){e.stopPropagation()},onSearchDocument:xt(function(){!ws(go(this.form.keywords))&&this.form.keywords.length>=2&&(this.isLoading=!0,this.data=[],this.isShowSearchResult=!0,vl(this.form.token,this.form.project_id,this.form.keywords).then(e=>{this.data=(e.data||[]).map(t=>(t.link={name:"preview.project.document",params:{project_id:this.form.project_id,node_id:t.node_id||t.doc_id}},t.href=`/app/${this.form.project_id}/${t.node_id||t.doc_id}`,t)),this.isNoData=!this.data.length}).finally(()=>{this.isLoading=!1}))},300)},created(){document.body.addEventListener("click",e=>{this.data=[],this.form.keywords="",this.isShowSearchResult=!1})}},Al={class:"search-popper-input"},Cl=a("i",{class:"icon iconfont iconsousuo"},null,-1),El={style:{padding:"10px","text-align":"center"}},kl={key:0},wl=["onClick","title"],Nl={key:1,class:"result p-2"},Il=a("div",{class:"result-icon"},[a("img",{src:Wo,alt:""})],-1),bl=a("span",null,"\u672A\u627E\u5230\u641C\u7D22\u7ED3\u679C\uFF01",-1),Dl=[Il,bl];function Pl(e,t,s,o,n,r){return d(),g("div",{class:"search-popper",onClick:t[3]||(t[3]=(...i)=>r.onStop&&r.onStop(...i))},[a("div",Al,[X(a("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>n.form.keywords=i),placeholder:"\u641C\u7D22",maxlength:"255",onKeyup:t[1]||(t[1]=mo((...i)=>r.onSearchDocument&&r.onSearchDocument(...i),["enter"]))},null,544),[[_o,n.form.keywords]]),Cl]),X(a("div",{class:"search-popper-result scroll-content",onClick:t[2]||(t[2]=(...i)=>r.onStop&&r.onStop(...i))},[X(a("div",El,"\u641C\u7D22\u4E2D...",512),[[ie,n.isLoading]]),n.data.length?(d(),g("ul",kl,[(d(!0),g(G,null,oe(n.data,i=>(d(),g("li",{key:i.node_id},[a("a",{href:"javascript:void(0);",onClick:c=>r.onClickSearchResult(i),title:i.title},M(i.title),9,wl)]))),128))])):j("",!0),n.isNoData?(d(),g("div",Nl,Dl)):j("",!0)],512),[[ie,n.isShowSearchResult]])])}var Sl=H(yl,[["render",Pl]]);const jl={name:"PreviewHeader",props:{isShowSearch:{type:Boolean,default:!0}},components:{ProjectSearch:Sl}},Rl={class:"header header-fixed"},xl=Ns('<a class="logo" href="/"><img src="'+qe+'" alt="ApiCat"><span class="logo"><span class="logo-text logo-apicat">ApiCat</span></span></a><ul class="header-nav"></ul>',2);function Tl(e,t,s,o,n,r){const i=Y("project-search");return d(),g("header",Rl,[xl,s.isShowSearch?(d(),O(i,{key:0})):j("",!0)])}var Ll=H(jl,[["render",Tl]]);const Yt=q({setup(e){const t=I(!0),s=I(!0),o=r=>{t.value=r},n=r=>{s.value=r};return ne("showSearchInput",o),ne("showHeader",n),(r,i)=>{const c=Y("router-view"),l=fl;return d(),g(G,null,[s.value?(d(),O(Ll,{key:0,"is-show-search":t.value},null,8,["is-show-search"])):j("",!0),h(c),h(l,{bottom:100,right:100})],64)}}}),Ol=()=>z(()=>import("./ProjectVerification.ed2887c4.js"),["assets/ProjectVerification.ed2887c4.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js","assets/img_join.8db8ddd5.js"]),Ml=()=>z(()=>import("./DocumentPreview.044e314c.js"),["assets/DocumentPreview.044e314c.js","assets/AcEditorDocument.94228334.js","assets/vendor.be35f7a8.js","assets/useHighlight.30d88e48.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css"]),Bl=()=>z(()=>import("./DocumentVerification.4e0ffbd9.js"),["assets/DocumentVerification.4e0ffbd9.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js","assets/img_join.8db8ddd5.js"]),$l=()=>z(()=>import("./TrashDocumentPreview.d4649fcb.js"),["assets/TrashDocumentPreview.d4649fcb.js","assets/element-plus.071360b2.js","assets/element-plus.7d952092.css","assets/vendor.be35f7a8.js","assets/AcEditorDocument.94228334.js","assets/useHighlight.30d88e48.js"]);fe("/app/:project_id");const Ld=fe("/doc/:project_id/trash_api_preview/:doc_id"),Fl={path:"/doc",name:ze,component:Yt,meta:{ignoreAuth:!0},children:[{path:"/doc/:doc_id",name:`${ze}.detail`,component:Ml,meta:{ignoreAuth:!0}},{path:"/doc/:doc_id/verification",name:it,component:Bl,meta:{ignoreAuth:!0}}]},Kl={path:"/app",name:Kt,component:Yt,meta:{ignoreAuth:!0},children:[{path:"/app/:project_id/verification",name:Vt,component:Ol,meta:{ignoreAuth:!0}}]},Vl={path:"/doc/:project_id/trash_api_preview/:doc_id",name:"preview.trash",component:Yt,children:[{path:"",name:"preview.trash.document",component:$l}]};function Ul(e){e.beforeEach(async(t,s,o)=>{const r=De().isLogin;if(t.meta.ignoreAuth){if(r&&(t.path===He||t.path===Bt)){o($t);return}o();return}if(!r){o({path:He,replace:!0});return}o()})}let Ge=null;const Ht=()=>{Ge&&Ge.visible.value||(Ge=wo.service({lock:!0,background:"rgba(255, 255, 255, 1)"}))},ae=()=>{Ge&&Ge.close()},Gl=e=>{e.beforeEach(async(t,s,o)=>{const n=_e();if(!t.matched.find(i=>i.name===Ft))return o();const r=parseInt(t.params.project_id,10);if(n.projectAuthInfo&&n.projectAuthInfo.id===r)return o();try{Ht();const i=await n.getProjectAuth(r);if(!i||!i.id)return ae(),o(de)}catch{return ae(),o(de)}return o()})},Yl=e=>{e.beforeEach(async(t,s,o)=>{const n=_e();if(!t.matched.find(i=>i.name===Ft))return o();const r=parseInt(t.params.project_id,10);if(n.projectInfo&&n.projectInfo.id===r)return o();try{await n.getProjectDetail(r)}catch{return ae(),o(de)}return o()})};function Hl(e){e.beforeEach(async(t,s,o)=>t.name===Pe&&_e().isReader?(ae(),o(de)):o())}function zl(e){e.beforeEach(async(t,s,o)=>{const{name:n,params:r}=t;if(n===Se){const i=_e(),{isLogin:c}=De(),l=!!D.get(D.KEYS.SECRET_PROJECT_TOKEN+r.project_id,!0),{projectAuthInfo:f,isPrivate:y}=ue(i),{has_shared:p,in_this:A}=k(f),C=k(y);if(!C){o();return}if(c&&A){o();return}if(!c&&C&&!p){ae(),o(de);return}if(C&&!p&&c&&!A){ae(),o(de);return}if(C&&!p&&c&&A){o();return}if(C&&p&&!l){ae(),o({name:Vt,params:{project_id:r.project_id}});return}if(C&&p&&l){o();return}return ae(),o(de)}return o()})}function Jl(e){e.beforeEach(async(t,s,o)=>{const n=_e();if(!ro.some(i=>i.name===t.name)||n.projectInfo&&t.params.project_id===String(n.projectInfo.id))return o();let r=null;Ht();try{const i=parseInt(t.params.project_id),c=await n.getProjectDetail(i);ro.filter(y=>y.meta.role.indexOf(c.authority)!==-1).some(y=>y.name===t.name)||(r=de),await n.getProjectAuth(i)}catch{r=de}finally{ae()}return r?o(r):o()})}function Wl(e){e.beforeEach(async(t,s,o)=>{const{name:n,params:r}=t,i=!!D.get(D.KEYS.SECRET_DOCUMENT_TOKEN+r.doc_id,!0);if(String(n).startsWith(ze)){if(!Is(r.doc_id))return o(de);Ht();const{data:c}=await _l(r.doc_id);return c?n===it?(ae(),o()):i?o():(ae(),o({name:it,params:{doc_id:r.doc_id}})):(ae(),o(de))}o()})}const ql=e=>{Ul(e),Gl(e),Hl(e),zl(e),Jl(e),Yl(e),Wl(e)},Ee=bs({history:Ds("/"),routes:[Er,kr,wr,hl,{path:$t,name:"main",component:$n,redirect:{name:"projects"},children:[vi,Or,Br,wi]},Kl,Fl,Vl,Nr]});var Ql=e=>{e.use(pe),e.use(Ot),e.use(ni),e.use(wo),e.config.globalProperties.$Message=pe};const Zl=function(e){e.mixin({mounted:function(){e.__clipboard__&&e.__clipboard__.destroy(),e.__clipboard__=new Ps(".copy_text",{text:function(t){return go(t.getAttribute("data-text")||t.innerText||"")}}),e.__clipboard__.on("success",()=>{pe.closeAll(),pe.success("\u590D\u5236\u6210\u529F")})}})};var Xl={install:Zl};class ed{constructor(){this._pendingMap=new Map}gatherKey(t){return[t.url,t.method,JSON.stringify(t.params)].join("_")}add(t){this.remove(t);const s=lt.CancelToken.source();t.cancelToken=t.cancelToken||s.token;const o=this.gatherKey(t);this._pendingMap.set(o,s.cancel)}remove(t){const s=this.gatherKey(t);if(this._pendingMap.has(s)){const o=this._pendingMap.get(s);o&&Xt(o)&&o(),this._pendingMap.delete(s)}}removeAll(){this._pendingMap.forEach(t=>t&&Xt(t)&&t()),this.clear()}clear(){this._pendingMap.clear()}}const td=Fe({id:"preview",state:()=>({projectInfo:null,documentInfo:null}),getters:{},actions:{async getProjectInfo(e){const{data:t}=await gl(e);return this.projectInfo=t||null,this.projectInfo},async getDocumentInfo(e){const t=D.get(D.KEYS.SECRET_DOCUMENT_TOKEN+e,!0)||"",{data:s}=await ml(e,t);return this.documentInfo=s||null,this.documentInfo},goVerificationPage(){const e=Ee.currentRoute.value.params.project_id||"",t=Ee.currentRoute.value.params.doc_id||"",s=Ee.currentRoute.value.name||"";if(s.includes(Kt)){D.remove(D.KEYS.SECRET_PROJECT_TOKEN+e,!0),Ee.push({name:Vt,params:{project_id:e}});return}s.includes(ze)&&(D.remove(D.KEYS.SECRET_DOCUMENT_TOKEN+t,!0),Ee.push({name:it,params:{document_id:t}}))}}}),ot=new ed,od=()=>{E.interceptors.request.use(e=>{ot.add(e);const t=De().token;return t&&(e.headers=ve(V({},e.headers),{Authorization:t})),e}),E.interceptors.response.use(e=>{ot.remove(e.config);let t="";!e.data&&(e.data={});const s=e.data.status;switch(e.headers.authorization&&De().updateToken(e.headers.authorization),s){case Oe.NO_LOGIN:t="\u767B\u5F55\u72B6\u6001\u5DF2\u5931\u6548\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55",ot.removeAll(),De().logout();break;case Oe.INVALID_PREVIEW_SECRET:t=e.data.msg||"\u8BBF\u95EE\u79D8\u94A5\u5DF2\u5931\u6548\u3002",ot.removeAll(),td().goVerificationPage();break;case Oe.OK:case Oe.NO_PARENT_DIR:case Oe.NOT_FOUND:break;default:t=e.data.msg||"\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01";break}return t?Promise.reject({message:t}):e.data}),E.interceptors.response.use(void 0,e=>{var r,i;let t="";const{code:s,message:o}=e||{},n=(i=(r=e==null?void 0:e.toString)==null?void 0:r.call(e))!=null?i:"";return t=o,s==="ECONNABORTED"&&t.indexOf("timeout")!==-1&&(t="\u8BF7\u6C42\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5"),n!=null&&n.includes("Network Error")&&(t="\u7F51\u7EDC\u5F02\u5E38\uFF0C\u8BF7\u91CD\u8BD5"),pe.closeAll(),t&&pe.error(t),Promise.reject(e)}),Dt.interceptors.request.use(e=>{const t=De().token;return t&&(e.headers=ve(V({},e.headers),{Authorization:t})),e}),Dt.interceptors.response.use(e=>{let t;switch(!e.data&&(e.data={}),e.data.status){case 0:break;default:t=e.data.msg||"\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01";break}return t?Promise.reject(t):e.data},e=>(e.message.indexOf("timeout")!==-1&&pe.error("\u8BF7\u6C42\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5\uFF01"),Promise.reject(e)))};od();const Ze=Ss(on);Ze.use(js());Ze.use(Ee);Ze.use(Xl);ql(Ee);Ql(Ze);Ze.mount("#app");export{Ea as $,E as A,ro as B,gd as C,be as D,cd as E,yd as F,vd as G,Ad as H,md as I,Nd as J,Cd as K,He as L,Ui as M,Sd as N,Oe as O,id as P,wd as Q,Bt as R,xo as S,dn as T,Ld as U,Pe as V,Vi as W,ae as X,Dd as Y,Xe as Z,qe as _,De as a,Dc as a0,fl as a1,z as a2,Qc as a3,jd as a4,Id as a5,bd as a6,Pd as a7,Se as a8,ka as a9,wa as aa,Na as ab,Mi as ac,Td as ad,so as ae,td as af,Ht as ag,Rd as ah,xd as ai,H as b,Be as c,Mo as d,ld as e,ad as f,Lo as g,pd as h,hd as i,kd as j,W as k,ji as l,ud as m,ia as n,qr as o,Wr as p,ln as q,Ce as r,dd as s,fd as t,rn as u,_d as v,Vo as w,Ed as x,ul as y,_e as z};
