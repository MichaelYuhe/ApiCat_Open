var re=Object.defineProperty;var q=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var H=(e,o,n)=>o in e?re(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,D=(e,o)=>{for(var n in o||(o={}))ae.call(o,n)&&H(e,n,o[n]);if(q)for(var n of q(o))ie.call(o,n)&&H(e,n,o[n]);return e};import{u as ce,N as ue,O as de,a as pe,e as W,f as X,g as Z,j as _e,P as me,Q as fe,h as K,i as ee,I as he,J as Ee,l as ve,E as J,R as ge,C as Pe,H as je,v as we}from"./element-plus.85f938a9.js";import{_ as ke,a as Ce}from"./ImagePreview.143296e3.js";import{a3 as be,aa as Se,br as Ae,b5 as Re,ac as B,o as j,W as N,X as s,Z as t,_ as oe,ai as y,aT as te,h as g,f as R,an as G,U as V,G as se,aZ as ye,r as P,b0 as Ie,t as ne,aq as Oe,v as Fe,R as Le,u as M,$ as z,aR as De,aS as Ve}from"./vendor.b27f3889.js";import{e as U,D as Me,f as Y,g as $,h as Be,i as Ne,b as x,j as Te,k as r,l as Ue,n as Ge,o as $e,p as xe,d as Q,q as qe,r as He,t as Je,u as ze,v as Ye,w as Qe}from"./index.a22b0d3c.js";const We={setup(){const e=be({isShow:!1,PROJECT_DEFAULT_ICON:U,isLoading:!1,imgUrl:null,file:null,disableType:!1,docTypes:Me,form:{icon_link:U,name:"",type:Y.API.value,visibility:0,description:""},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\u79F0",trigger:"blur"},{min:2,message:"\u9879\u76EE\u540D\u79F0\u4E0D\u80FD\u5C11\u4E8E\u4E24\u4E2A\u5B57",trigger:"blur"}]}});return D({},Se(e))},computed:D({},Ae($,["activeGroup"])),components:{Lock:ce,View:ue,Upload:de},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{handleUpload(e){return e.append("icon",this.file),Be(e)},show(){this.isShow=!0},hide(){this.isShow=!1},reset(){this.$refs.projectForm.resetFields(),this.form={icon_link:U,name:"",type:Y.API.value,visibility:0,description:""}},onCloseBtnClick(){this.isShow=!1,this.reset()},onImageUpload(e,o){this.imgUrl=e,this.file=o},onProjectIconUploadSuccess(e){this.form.icon_link=e},handleSubmit(e){this.$refs[e].validate(o=>{o&&(this.isLoading=!0,this.form.group_id=this.activeGroup.id,Ne(this.form).then(n=>{this.$message.success(n.msg||"\u9879\u76EE\u521B\u5EFA\u6210\u529F\uFF01"),Re(this,"on-ok",n.data||{})}).catch(n=>{}).finally(()=>{this.isLoading=!1,this.hide()}))})}},emits:["on-ok"]},Xe=y("\u4E0A\u4F20\u65B0\u56FE\u6807 "),Ze=y("\u79C1\u6709 "),Ke=y("\u516C\u5F00 "),eo=y(" \u53D6\u6D88 "),oo=y(" \u786E \u5B9A ");function to(e,o,n,O,_,i){const E=pe,c=B("Upload"),m=W,w=X,b=ke,v=Z,u=_e,k=B("Lock"),f=me,C=B("View"),F=fe,I=Ce,L=K,A=ee;return j(),N(A,{modelValue:e.isShow,"onUpdate:modelValue":o[6]||(o[6]=a=>e.isShow=a),width:440,"close-on-click-modal":!1,title:"\u65B0\u5EFA\u9879\u76EE","append-to-body":"","custom-class":"show-footer-line"},{footer:s(()=>[t(w,{onClick:o[4]||(o[4]=a=>i.onCloseBtnClick())},{default:s(()=>[eo]),_:1}),t(w,{loading:e.isLoading,type:"primary",onClick:o[5]||(o[5]=a=>i.handleSubmit("projectForm"))},{default:s(()=>[oo]),_:1},8,["loading"])]),default:s(()=>[t(L,{ref:"projectForm",model:e.form,rules:e.rules,"label-position":"top",style:{width:"400px"},class:"py-2 pl-2",onSubmit:o[3]||(o[3]=oe(a=>i.handleSubmit("projectForm"),["prevent"]))},{default:s(()=>[t(v,{label:""},{default:s(()=>[t(E,{class:"mr-7",shape:"square",size:60,src:e.form.icon_link?e.form.icon_link:e.PROJECT_DEFAULT_ICON},null,8,["src"]),t(b,{onDone:i.onImageUpload},{default:s(()=>[t(w,null,{default:s(()=>[t(m,null,{default:s(()=>[t(c)]),_:1}),Xe]),_:1})]),_:1},8,["onDone"])]),_:1}),t(v,{label:"\u9879\u76EE\u540D\u79F0",prop:"name",class:"hide_required"},{default:s(()=>[t(u,{modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=a=>e.form.name=a),placeholder:"\u9879\u76EE\u540D\u79F0",maxlength:"255"},null,8,["modelValue"])]),_:1}),t(v,{label:"\u6743\u9650"},{default:s(()=>[t(F,{modelValue:e.form.visibility,"onUpdate:modelValue":o[1]||(o[1]=a=>e.form.visibility=a)},{default:s(()=>[t(f,{label:0},{default:s(()=>[t(m,{class:"mr-1"},{default:s(()=>[t(k)]),_:1}),Ze]),_:1}),t(f,{label:1},{default:s(()=>[t(m,{class:"mr-1"},{default:s(()=>[t(C)]),_:1}),Ke]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"\u9879\u76EE\u63CF\u8FF0"},{default:s(()=>[t(u,{modelValue:e.form.description,"onUpdate:modelValue":o[2]||(o[2]=a=>e.form.description=a),type:"textarea",autosize:{minRows:4,maxRows:4},maxlength:"255"},null,8,["modelValue"])]),_:1}),t(I,{"img-url":e.imgUrl,file:e.file,onOnOk:i.onProjectIconUploadSuccess,"handle-upload":i.handleUpload},null,8,["img-url","file","onOnOk","handle-upload"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var so=x(We,[["render",to]]);const no={emits:["on-ok"],data(){return{isShow:!1,isLoading:!1,form:{new_group_id:"",project_id:"",old_group_id:""},rules:{new_group_id:{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE\u5206\u7EC4",type:"number",trigger:"blur"}}}},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{show(e){this.form.project_id=e.id;let o=e.group_id||parseInt(this.$route.params.cid||0,10);this.form.old_group_id=isNaN(o)?0:o,this.form.new_group_id=isNaN(o)?0:o,this.isShow=!0},hide(){this.isShow=!1},onCloseBtnClick(){this.isShow=!1,this.reset()},reset(){this.form.project_id="",this.form.old_group_id="",this.form.new_group_id=""},handleSubmit(e){this.$refs[e].validate(o=>o&&this.submit())},submit(){this.isLoading=!0,Te(this.form).then(e=>{this.$Message.success(e.msg||"\u66F4\u6362\u5206\u7EC4\u6210\u529F!"),this.onCloseBtnClick(),this.$emit("on-ok")}).finally(()=>{this.isLoading=!1}).catch(e=>{})}},setup(){const e=$();return D({},te(e))}},lo=y("\u53D6\u6D88"),ro=y("\u786E\u5B9A");function ao(e,o,n,O,_,i){const E=he,c=Ee,m=Z,w=K,b=X,v=ee;return j(),N(v,{modelValue:_.isShow,"onUpdate:modelValue":o[4]||(o[4]=u=>_.isShow=u),width:340,"close-on-click-modal":!1,title:"\u79FB\u52A8\u9879\u76EE\u5206\u7EC4","append-to-body":"","custom-class":"show-footer-line"},{footer:s(()=>[g("div",null,[t(b,{onClick:o[2]||(o[2]=u=>i.onCloseBtnClick())},{default:s(()=>[lo]),_:1}),t(b,{loading:_.isLoading,type:"primary",onClick:o[3]||(o[3]=u=>i.handleSubmit("teamForm"))},{default:s(()=>[ro]),_:1},8,["loading"])])]),default:s(()=>[t(w,{onSubmit:o[1]||(o[1]=oe(u=>i.handleSubmit("teamForm"),["prevent"])),ref:"teamForm",model:_.form,rules:_.rules,"label-position":"top",style:{"margin-bottom":"-19px"}},{default:s(()=>[t(m,{label:"\u9009\u62E9\u9879\u76EE\u5206\u7EC4",prop:"new_group_id",class:"hide_required"},{default:s(()=>[t(c,{class:"w-full",modelValue:_.form.new_group_id,"onUpdate:modelValue":o[0]||(o[0]=u=>_.form.new_group_id=u),"not-data-text":"\u6682\u65E0\u9879\u76EE\u5206\u7EC4","no-match-text":"\u672A\u67E5\u627E\u5230\u5206\u7EC4",placeholder:"\u9009\u62E9\u88AB\u79FB\u52A8\u7684\u9879\u76EE\u5206\u7EC4",teleported:!1,"popper-class":"w-full overflow-hidden"},{default:s(()=>[t(E,{value:0,label:"\u4E0D\u5206\u7EC4"}),(j(!0),R(V,null,G(e.projectGroupList,u=>(j(),N(E,{value:u.id,key:u.id,label:u.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var io=x(no,[["render",ao]]);const co=["onClick","innerHTML"],uo=se({props:{ignoreEle:{default:[]}},emits:["changeGroup","quitProject","deleteProject"],setup(e,{expose:o,emit:n}){const O=e,_=ye(),i=P(!1),E=P(null),c=P({}),m=P(),w=P(),b=P(),v=P([]);Ie(E,l=>{const p=l.composedPath(),h=O.ignoreEle;h&&h.length>0&&h.some(d=>d&&(l.target===d||p.includes(d)))||(i.value=!1)});const u=()=>{b.value.show(c.value)},k=()=>{n("changeGroup")},f=()=>{Q({title:"\u5220\u9664\u63D0\u793A",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u76EE\u5417\uFF1F",onOk:l=>qe(c.value.id).then(p=>{J.success(p.msg||"\u5220\u9664\u6210\u529F\uFF01"),n("deleteProject")}).catch(()=>{l(),n("quitProject")})})},C=()=>{Q({title:"\u9000\u51FA\u63D0\u793A",content:"\u786E\u5B9A\u9000\u51FA\u8BE5\u9879\u76EE\u5417\uFF1F",onOk:l=>He(c.value.id).then(p=>{J.success(p.msg||"\u5220\u9664\u6210\u529F\uFF01"),n("quitProject")}).catch(()=>{l(),n("quitProject")})})},F=()=>{w.value.show(c.value)},I=()=>{m.value.show({project_id:c.value.id},Je)},L=[{text:"\u9884\u89C8\u9879\u76EE",selector:"project_preview",isNewOpen:!0,href:"{id}",field:"preview_link",icon:"iconIconPopoverPlay",roles:[r.MANAGER,r.DEVELOPER]},{text:"\u9879\u76EE\u6210\u5458",selector:"project_members",href:"/project/{id}/members",icon:"iconIconPopoverUser",route:{name:"project.members"},roles:[r.MANAGER,r.DEVELOPER,r.READER]},{text:"\u5206\u4EAB\u9879\u76EE",selector:"project_share",clickFn:F,icon:"iconshare",roles:[r.MANAGER,r.DEVELOPER,r.READER]},{text:"\u5BFC\u51FA\u9879\u76EE",selector:"project_export",clickFn:I,icon:"iconIconPopoverUpload",roles:[r.MANAGER,r.DEVELOPER]},{text:"\u9879\u76EE\u8BBE\u7F6E",selector:"project_edit",href:"/project/{id}/setting",icon:"iconIconPopoverSetting",route:{name:"project.setting"},roles:[r.MANAGER]},{text:"\u9879\u76EE\u5206\u7EC4",selector:"project_group",clickFn:u,icon:"iconfenzu",roles:[r.MANAGER,r.DEVELOPER,r.READER]},{text:"\u5220\u9664\u9879\u76EE",selector:"project_delete",clickFn:f,icon:"iconIconPopoverAlert",roles:[r.MANAGER]},{text:"\u9000\u51FA\u9879\u76EE",selector:"project_quit",clickFn:C,icon:"iconIconPopoverExit",roles:[r.DEVELOPER,r.READER]}],A={};[r.MANAGER,r.DEVELOPER,r.READER].forEach(l=>{const p=A[l]=A[l]||[];L.forEach(h=>{h.roles.join(",").indexOf(l)!==-1&&p.push(h)})});const a=()=>{let p=($e.find(d=>d.key===c.value.authority)||{}).key,h=A[p]||[];p===r.READER&&c.value.visibility===xe.PRIVATE&&(h=h.filter(d=>d.selector!=="project_share")),v.value=h.map(d=>{let S=D({},d);return S.href&&(S.href=S.href.replace("{id}",c.value[d.field||"id"])),S.menuHtml=`<i class="icon iconfont mr-1 ${S.icon||""}"></i>${S.text}`,S})},T=l=>{if(l.clickFn){l.clickFn();return}if(l.isNewOpen){window.open(l.href);return}l.href&&!l.isNewOpen&&(l.route.params={project_id:c.value[l.field||"id"]},_.push(l.route))},le=(l,p)=>{E.value=l,c.value=p,i.value=!0};return ne(c,()=>{a()}),o({show:le}),(l,p)=>{const h=ve;return j(),R(V,null,[t(h,{visible:i.value,"onUpdate:visible":p[0]||(p[0]=d=>i.value=d),ref:"popoverRef","popper-class":"ac-popper-menu","virtual-ref":E.value,"virtual-triggering":"",width:"auto"},{default:s(()=>[g("ul",null,[(j(!0),R(V,null,G(v.value,d=>(j(),R("li",{class:"ac-popper-menu__item",key:d.selector,onClick:S=>T(d),innerHTML:d.menuHtml},null,8,co))),128))])]),_:1},8,["visible","virtual-ref"]),t(Ue,{ref_key:"projectExportModal",ref:m},null,512),t(Ge,{ref_key:"projectShareModal",ref:w},null,512),t(io,{ref_key:"changeProjectGroupModal",ref:b,onOnOk:k},null,512)],64)}}});const po=e=>(De("data-v-32803c8e"),e=e(),Ve(),e),_o={class:"truncate"},mo={class:"ac-project"},fo={class:"ac-project-thumb"},ho=["src"],Eo=["onClick"],vo=["title"],go={class:"ac-project-thumb"},Po=po(()=>g("p",null,"\u65B0\u5EFA\u9879\u76EE",-1)),jo=se({setup(e){const[o,n]=ze(Ye,{isShowMessage:!1}),O=$(),{activeGroup:_}=te(O),i=P([]),E=P(),c=P(),m=P([]),w=f=>{m.value.push(f)},b=(f,C)=>{c.value.show(f.currentTarget,C)},v=()=>{E.value.show()},u=async()=>{await k()},k=async()=>{const{data:f}=await n(_.value.id);f&&(i.value=(f.projects||[]).map(C=>(C.publicHref=Qe({project_id:C.id}),C)))};return ne(()=>_.value,async()=>await k()),Oe(()=>{m.value=[]}),Fe(async()=>{await k()}),(f,C)=>{const F=B("router-link"),I=W,L=je,A=we;return j(),R(V,null,[Le((j(),N(L,{shadow:"never"},{header:s(()=>[g("div",_o,z(M(_).name),1)]),default:s(()=>[g("div",mo,[(j(!0),R(V,null,G(i.value,a=>(j(),R("div",{class:"ac-project-item",key:a.id},[g("div",fo,[t(F,{title:a.publicHref,to:{path:a.publicHref}},{default:s(()=>[g("img",{src:a.icon},null,8,ho)]),_:2},1032,["title","to"]),g("span",{class:"ac-project-action",ref_for:!0,ref:w,onClick:T=>b(T,a)},[t(I,null,{default:s(()=>[t(M(ge))]),_:1})],8,Eo)]),g("p",{title:a.name,class:"ac-project-title truncate"},z(a.name),9,vo)]))),128)),g("div",{class:"ac-project-item ac-project-new",onClick:v},[g("div",go,[t(I,{size:26},{default:s(()=>[t(M(Pe))]),_:1})]),Po])])]),_:1})),[[A,M(o)]]),t(so,{ref_key:"newProjectModal",ref:E,onOnOk:u},null,512),t(uo,{ref_key:"projectDropmenu",ref:c,onChangeGroup:k,onDeleteProject:k,onQuitProject:k,"ignore-ele":m.value},null,8,["ignore-ele"])],64)}}});var Ao=x(jo,[["__scopeId","data-v-32803c8e"]]);export{Ao as default};
