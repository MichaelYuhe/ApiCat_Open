var re=Object.defineProperty,ae=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var q=(e,o,n)=>o in e?re(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,D=(e,o)=>{for(var n in o||(o={}))ce.call(o,n)&&q(e,n,o[n]);if(x)for(var n of x(o))ue.call(o,n)&&q(e,n,o[n]);return e},H=(e,o)=>ae(e,ie(o));import{u as de,N as pe,O as _e,n as me,g as K,e as W,a as Z,d as fe,P as he,Q as Ee,b as X,c as ee,I as ge,J as ve,h as Pe,E as J,R as je,C as we,H as ke,v as Ce}from"./element-plus.aa12b6bd.js";import{_ as be,a as Se}from"./ImagePreview.e3b8fddd.js";import{a5 as Ae,r as g,ap as Re,bz as ye,be as Ie,as as N,o as P,Y as B,Z as s,$ as t,a0 as oe,ak as F,a$ as te,j as E,h as I,at as U,W as M,K as se,b8 as Fe,b7 as Oe,x as ne,au as Le,y as De,T as Me,v as V,a1 as z,aZ as Ve,a_ as Be}from"./vendor.b7ec7f69.js";import{f as T,D as Ne,g as Y,h as $,i as Te,j as Ue,c as G,k as $e,l as r,n as Ge,o as xe,p as qe,q as He,r as Je,t as ze,e as Q,v as Ye,w as Qe,x as Ke,u as We,y as Ze,z as Xe}from"./index.6e925652.js";const eo={setup(){const e=Ae({isShow:!1,PROJECT_DEFAULT_ICON:T,isLoading:!1,imgUrl:null,file:null,disableType:!1,docTypes:Ne,form:{icon_link:T,name:"",type:Y.API.value,visibility:0,description:""},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\u79F0",trigger:"blur"},{min:2,message:"\u9879\u76EE\u540D\u79F0\u4E0D\u80FD\u5C11\u4E8E\u4E24\u4E2A\u5B57",trigger:"blur"}]}}),o=g(),n=()=>{e.isShow=!0,setTimeout(()=>{var A;return(A=o.value)==null?void 0:A.focus()},0)};return H(D({},Re(e)),{projectNameInputRef:o,show:n})},computed:D({},ye($,["activeGroup"])),components:{Lock:de,View:pe,Upload:_e},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{handleUpload(e){return e.append("icon",this.file),Te(e)},hide(){this.isShow=!1},reset(){this.$refs.projectForm.resetFields(),this.form={icon_link:T,name:"",type:Y.API.value,visibility:0,description:""}},onCloseBtnClick(){this.isShow=!1,this.reset()},onImageUpload(e,o){this.imgUrl=e,this.file=o},onProjectIconUploadSuccess(e){this.form.icon_link=e},handleSubmit(e){this.$refs[e].validate(o=>{o&&(this.isLoading=!0,this.form.group_id=this.activeGroup.id,Ue(this.form).then(n=>{this.$message.success(n.msg||"\u9879\u76EE\u521B\u5EFA\u6210\u529F\uFF01"),Ie(this,"on-ok",n.data||{})}).catch(n=>{}).finally(()=>{this.isLoading=!1,this.hide()}))})}},emits:["on-ok"]},oo=F("\u4E0A\u4F20\u65B0\u56FE\u6807 "),to=F("\u79C1\u6709 "),so=F("\u516C\u5F00 "),no=F(" \u53D6\u6D88 "),lo=F(" \u786E \u5B9A ");function ro(e,o,n,A,i,c){const a=me,b=N("Upload"),m=K,j=W,S=be,w=Z,u=fe,k=N("Lock"),f=he,C=N("View"),O=Ee,L=Se,y=X,v=ee;return P(),B(v,{modelValue:e.isShow,"onUpdate:modelValue":o[6]||(o[6]=_=>e.isShow=_),width:440,"close-on-click-modal":!1,title:"\u65B0\u5EFA\u9879\u76EE","append-to-body":"",class:"show-footer-line"},{footer:s(()=>[t(j,{onClick:o[4]||(o[4]=_=>c.onCloseBtnClick())},{default:s(()=>[no]),_:1}),t(j,{loading:e.isLoading,type:"primary",onClick:o[5]||(o[5]=_=>c.handleSubmit("projectForm"))},{default:s(()=>[lo]),_:1},8,["loading"])]),default:s(()=>[t(y,{ref:"projectForm",model:e.form,rules:e.rules,"label-position":"top",style:{width:"400px"},class:"py-2 pl-2",onSubmit:o[3]||(o[3]=oe(_=>c.handleSubmit("projectForm"),["prevent"]))},{default:s(()=>[t(w,{label:""},{default:s(()=>[t(a,{class:"mr-7",shape:"square",size:60,src:e.form.icon_link?e.form.icon_link:e.PROJECT_DEFAULT_ICON},null,8,["src"]),t(S,{onDone:c.onImageUpload},{default:s(()=>[t(j,null,{default:s(()=>[t(m,null,{default:s(()=>[t(b)]),_:1}),oo]),_:1})]),_:1},8,["onDone"])]),_:1}),t(w,{label:"\u9879\u76EE\u540D\u79F0",prop:"name",class:"hide_required"},{default:s(()=>[t(u,{ref:"projectNameInputRef",modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=_=>e.form.name=_),placeholder:"\u9879\u76EE\u540D\u79F0",maxlength:"255"},null,8,["modelValue"])]),_:1}),t(w,{label:"\u6743\u9650"},{default:s(()=>[t(O,{modelValue:e.form.visibility,"onUpdate:modelValue":o[1]||(o[1]=_=>e.form.visibility=_)},{default:s(()=>[t(f,{label:0},{default:s(()=>[t(m,{class:"mr-1"},{default:s(()=>[t(k)]),_:1}),to]),_:1}),t(f,{label:1},{default:s(()=>[t(m,{class:"mr-1"},{default:s(()=>[t(C)]),_:1}),so]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"\u9879\u76EE\u63CF\u8FF0"},{default:s(()=>[t(u,{modelValue:e.form.description,"onUpdate:modelValue":o[2]||(o[2]=_=>e.form.description=_),type:"textarea",autosize:{minRows:4,maxRows:4},maxlength:"255"},null,8,["modelValue"])]),_:1}),t(L,{"img-url":e.imgUrl,file:e.file,onOnOk:c.onProjectIconUploadSuccess,"handle-upload":c.handleUpload},null,8,["img-url","file","onOnOk","handle-upload"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var ao=G(eo,[["render",ro]]);const io={emits:["on-ok"],data(){return{isShow:!1,isLoading:!1,form:{new_group_id:"",project_id:"",old_group_id:""},rules:{new_group_id:{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE\u5206\u7EC4",type:"number",trigger:"blur"}}}},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{show(e){this.form.project_id=e.id;let o=e.group_id||parseInt(this.$route.params.cid||0,10);this.form.old_group_id=isNaN(o)?0:o,this.form.new_group_id=isNaN(o)?0:o,this.isShow=!0},hide(){this.isShow=!1},onCloseBtnClick(){this.isShow=!1,this.reset()},reset(){this.form.project_id="",this.form.old_group_id="",this.form.new_group_id=""},handleSubmit(e){this.$refs[e].validate(o=>o&&this.submit())},submit(){this.isLoading=!0,$e(this.form).then(e=>{this.$Message.success(e.msg||"\u66F4\u6362\u5206\u7EC4\u6210\u529F!"),this.onCloseBtnClick(),this.$emit("on-ok")}).finally(()=>{this.isLoading=!1}).catch(e=>{})}},setup(){const e=$();return D({},te(e))}},co=F("\u53D6\u6D88"),uo=F("\u786E\u5B9A");function po(e,o,n,A,i,c){const a=ge,b=ve,m=Z,j=X,S=W,w=ee;return P(),B(w,{modelValue:i.isShow,"onUpdate:modelValue":o[4]||(o[4]=u=>i.isShow=u),width:340,"close-on-click-modal":!1,title:"\u79FB\u52A8\u9879\u76EE\u5206\u7EC4","append-to-body":"",class:"show-footer-line"},{footer:s(()=>[E("div",null,[t(S,{onClick:o[2]||(o[2]=u=>c.onCloseBtnClick())},{default:s(()=>[co]),_:1}),t(S,{loading:i.isLoading,type:"primary",onClick:o[3]||(o[3]=u=>c.handleSubmit("teamForm"))},{default:s(()=>[uo]),_:1},8,["loading"])])]),default:s(()=>[t(j,{onSubmit:o[1]||(o[1]=oe(u=>c.handleSubmit("teamForm"),["prevent"])),ref:"teamForm",model:i.form,rules:i.rules,"label-position":"top",style:{"margin-bottom":"-19px"}},{default:s(()=>[t(m,{label:"\u9009\u62E9\u9879\u76EE\u5206\u7EC4",prop:"new_group_id",class:"hide_required"},{default:s(()=>[t(b,{class:"w-full",modelValue:i.form.new_group_id,"onUpdate:modelValue":o[0]||(o[0]=u=>i.form.new_group_id=u),"not-data-text":"\u6682\u65E0\u9879\u76EE\u5206\u7EC4","no-match-text":"\u672A\u67E5\u627E\u5230\u5206\u7EC4",placeholder:"\u9009\u62E9\u88AB\u79FB\u52A8\u7684\u9879\u76EE\u5206\u7EC4",teleported:!1,"popper-class":"w-full overflow-hidden"},{default:s(()=>[t(a,{value:0,label:"\u4E0D\u5206\u7EC4"}),(P(!0),I(M,null,U(e.projectGroupList,u=>(P(),B(a,{value:u.id,key:u.id,label:u.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var _o=G(io,[["render",po]]);const mo=["onClick","innerHTML"],fo=se({props:{ignoreEle:{default:[]}},emits:["changeGroup","quitProject","deleteProject"],setup(e,{expose:o,emit:n}){const A=e;Fe();const i=g(!1),c=g(null),a=g({}),b=g(),m=g(),j=g(),S=g([]);Oe(c,l=>{const p=l.composedPath(),h=A.ignoreEle;h&&h.length>0&&h.some(d=>d&&(l.target===d||p.includes(d)))||(i.value=!1)});const w=()=>{j.value.show(a.value)},u=()=>{n("changeGroup")},k=()=>{Q({title:"\u5220\u9664\u63D0\u793A",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u76EE\u5417\uFF1F",onOk:l=>Ye(a.value.id).then(p=>{J.success(p.msg||"\u5220\u9664\u6210\u529F\uFF01"),n("deleteProject")}).catch(()=>{l(),n("quitProject")})})},f=()=>{Q({title:"\u9000\u51FA\u63D0\u793A",content:"\u786E\u5B9A\u9000\u51FA\u8BE5\u9879\u76EE\u5417\uFF1F",onOk:l=>Qe(a.value.id).then(p=>{J.success(p.msg||"\u5220\u9664\u6210\u529F\uFF01"),n("quitProject")}).catch(()=>{l(),n("quitProject")})})},C=()=>{m.value.show(a.value)},O=()=>{b.value.show({project_id:a.value.id},Ke)},L=[{text:"\u9879\u76EE\u6210\u5458",selector:"project_members",hrefFn:qe,icon:"iconIconPopoverUser",route:{name:"project.members"},roles:[r.MANAGER,r.DEVELOPER,r.READER]},{text:"\u5206\u4EAB\u9879\u76EE",selector:"project_share",clickFn:C,icon:"iconshare",roles:[r.MANAGER,r.DEVELOPER,r.READER]},{text:"\u5BFC\u51FA\u9879\u76EE",selector:"project_export",clickFn:O,icon:"iconIconPopoverUpload",roles:[r.MANAGER,r.DEVELOPER]},{text:"\u9879\u76EE\u8BBE\u7F6E",selector:"project_edit",hrefFn:He,icon:"iconIconPopoverSetting",route:{name:"project.setting"},roles:[r.MANAGER]},{text:"\u9879\u76EE\u5206\u7EC4",selector:"project_group",clickFn:w,icon:"iconfenzu",roles:[r.MANAGER,r.DEVELOPER,r.READER]},{text:"\u5220\u9664\u9879\u76EE",selector:"project_delete",clickFn:k,icon:"iconIconPopoverAlert",roles:[r.MANAGER]},{text:"\u9000\u51FA\u9879\u76EE",selector:"project_quit",clickFn:f,icon:"iconIconPopoverExit",roles:[r.DEVELOPER,r.READER]}],y={};[r.MANAGER,r.DEVELOPER,r.READER].forEach(l=>{const p=y[l]=y[l]||[];L.forEach(h=>{h.roles.join(",").indexOf(l)!==-1&&p.push(h)})});const v=()=>{let p=(Je.find(d=>d.key===a.value.authority)||{}).key,h=y[p]||[];p===r.READER&&a.value.visibility===ze.PRIVATE&&(h=h.filter(d=>d.selector!=="project_share")),S.value=h.map(d=>{let R=D({},d);return R.hrefFn&&(R.href=R.hrefFn(a.value.id)),R.menuHtml=`<i class="icon iconfont mr-1 ${R.icon||""}"></i>${R.text}`,R})},_=l=>{if(l.clickFn){l.clickFn();return}if(l.isNewOpen){window.open(l.href);return}l.href&&!l.isNewOpen&&(location.href=l.href)},le=(l,p)=>{c.value=l,a.value=p,i.value=!0};return ne(a,()=>{v()}),o({show:le}),(l,p)=>{const h=Pe;return P(),I(M,null,[t(h,{visible:i.value,"onUpdate:visible":p[0]||(p[0]=d=>i.value=d),ref:"popoverRef","popper-class":"ac-popper-menu","virtual-ref":c.value,"virtual-triggering":"",width:"auto"},{default:s(()=>[E("ul",null,[(P(!0),I(M,null,U(S.value,d=>(P(),I("li",{class:"ac-popper-menu__item",key:d.selector,onClick:R=>_(d),innerHTML:d.menuHtml},null,8,mo))),128))])]),_:1},8,["visible","virtual-ref"]),t(Ge,{ref_key:"projectExportModal",ref:b},null,512),t(xe,{ref_key:"projectShareModal",ref:m},null,512),t(_o,{ref_key:"changeProjectGroupModal",ref:j,onOnOk:u},null,512)],64)}}});const ho=e=>(Ve("data-v-016d4faa"),e=e(),Be(),e),Eo={class:"truncate"},go={class:"ac-project"},vo={class:"ac-project-thumb"},Po=["title","href"],jo=["src"],wo=["onClick"],ko=["title"],Co={class:"ac-project-thumb"},bo=ho(()=>E("p",null,"\u65B0\u5EFA\u9879\u76EE",-1)),So=se({setup(e){const[o,n]=We(Ze,{isShowMessage:!1}),A=$(),{activeGroup:i}=te(A),c=g([]),a=g(),b=g(),m=g([]),j=f=>{m.value.push(f)},S=(f,C)=>{b.value.show(f.currentTarget,C)},w=()=>{a.value.show()},u=async()=>{await k()},k=async()=>{const{data:f}=await n(i.value.id);f&&(c.value=(f.projects||[]).map(C=>(C.publicHref=Xe({project_id:C.id}),C)))};return ne(()=>i.value,async()=>await k()),Le(()=>{m.value=[]}),De(async()=>{await k()}),(f,C)=>{const O=K,L=ke,y=Ce;return P(),I(M,null,[Me((P(),B(L,{shadow:"never"},{header:s(()=>[E("div",Eo,z(V(i).name),1)]),default:s(()=>[E("div",go,[(P(!0),I(M,null,U(c.value,v=>(P(),I("div",{class:"ac-project-item",key:v.id},[E("div",vo,[E("a",{title:v.publicHref,href:v.publicHref},[E("img",{src:v.icon},null,8,jo)],8,Po),E("span",{class:"ac-project-action",ref_for:!0,ref:j,onClick:_=>S(_,v)},[t(O,null,{default:s(()=>[t(V(je))]),_:1})],8,wo)]),E("p",{title:v.name,class:"truncate ac-project-title"},z(v.name),9,ko)]))),128)),E("div",{class:"ac-project-item ac-project-new",onClick:w},[E("div",Co,[t(O,{size:26},{default:s(()=>[t(V(we))]),_:1})]),bo])])]),_:1})),[[y,V(o)]]),t(ao,{ref_key:"newProjectModal",ref:a,onOnOk:u},null,512),t(fo,{ref_key:"projectDropmenu",ref:b,onChangeGroup:k,onDeleteProject:k,onQuitProject:k,"ignore-ele":m.value},null,8,["ignore-ele"])],64)}}});var Oo=G(So,[["__scopeId","data-v-016d4faa"]]);export{Oo as default};
