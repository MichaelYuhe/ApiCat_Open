var ke=Object.defineProperty,ye=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var se=(e,t,l)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,$=(e,t)=>{for(var l in t||(t={}))Ce.call(t,l)&&se(e,l,t[l]);if(le)for(var l of le(t))ve.call(t,l)&&se(e,l,t[l]);return e},oe=(e,t)=>ye(e,ge(t));import{d as de,a as Ee,I as ce,J as ue,b as xe,e as Q,c as fe,v as he,T as be,U as Te,V as Fe,z as Ne,E as Ae,H as De}from"./element-plus.ccbabc0c.js";import{u as Ie,_ as Pe}from"./useTable.6d413452.js";import{K as X,a$ as _e,r as T,a5 as Ve,x as M,o as D,Y as j,Z as x,$ as u,T as ee,v as b,a0 as Se,h as U,at as me,W as q,ak as P,al as te,aw as we,bJ as ae,bK as Y,j as E,a1 as G,L as H,V as re,a2 as Be,y as Ke,U as je,D as Le}from"./vendor.4578470d.js";import{ai as pe,u as Z,aj as ze,ak as Re,al as Oe,c as He,am as Ue,an as $e,D as ie,ao as Me,ap as qe,l as Je,e as Ye,aq as Ge,ar as We}from"./index.82a37249.js";import"./usePage.11ff97df.js";const Ze=P(" \u53D6\u6D88 "),Qe=P(" \u786E \u5B9A "),Xe=X({emits:["ok"],setup(e,{expose:t,emit:l}){const o=pe(),{activeTab:a}=_e(o),[r,f]=Z(ze),c=T(),m=T(!1),h=T(!1),i=T(!1),d=T("\u65B0\u5EFA\u8FED\u4EE3"),F=T([]);let V=null;const A={title:"",project_id:"",description:""};let p=Ve($({},A));const L={title:[{required:!0,message:"\u8BF7\u8F93\u5165\u8FED\u4EE3\u540D\u79F0",trigger:"blur"},{min:2,message:"\u8FED\u4EE3\u540D\u79F0\u4E0D\u80FD\u5C11\u4E8E\u4E24\u4E2A\u5B57",trigger:"blur"}],project_id:{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u9879\u76EE",trigger:"change"}},z=y=>{m.value=!0,i.value=!!y,d.value=i.value?"\u7F16\u8F91\u8FED\u4EE3":"\u65B0\u5EFA\u8FED\u4EE3",V=i.value?Re:Oe,y&&(p=Object.assign(p,y)),N()},w=()=>{m.value=!1},R=()=>{var y;(y=c.value)==null||y.resetFields(),p=Object.assign(p,A),p.project_id=""},g=async y=>{!y||await y.validate(async _=>{if(_)try{let v=$({},te(p));i.value&&(v={iteration_id:p.id,title:p.title,description:p.description}),h.value=!0;try{await V(v),o.switchActiveCollectTab(p.project_id),l("ok"),w()}catch{}finally{h.value=!1}}catch{}})},C=()=>{w()},N=async()=>{const{data:y}=await f();F.value=y||[];const _=F.value.find(v=>v.id===a.value);p.project_id=_?_.id:p.project_id?p.project_id:"",setTimeout(()=>{var v;return(v=c.value)==null?void 0:v.clearValidate()},0)};return M(()=>m.value,()=>!m.value&&R()),t({show:z}),(y,_)=>{const v=de,s=Ee,n=ce,I=ue,O=xe,B=Q,K=fe,J=he;return D(),j(K,{modelValue:m.value,"onUpdate:modelValue":_[6]||(_[6]=k=>m.value=k),width:400,"close-on-click-modal":!1,title:d.value,"append-to-body":"",class:"show-footer-line"},{footer:x(()=>[u(B,{onClick:_[4]||(_[4]=k=>C())},{default:x(()=>[Ze]),_:1}),u(B,{loading:h.value,type:"primary",onClick:_[5]||(_[5]=k=>g(c.value))},{default:x(()=>[Qe]),_:1},8,["loading"])]),default:x(()=>[ee((D(),j(O,{ref_key:"iterateForm",ref:c,model:b(p),rules:L,"label-position":"top",class:"py-2 pl-2",onSubmit:_[3]||(_[3]=Se(k=>g(c.value),["prevent"]))},{default:x(()=>[u(s,{label:"\u8FED\u4EE3\u540D\u79F0",prop:"title",class:"hide_required"},{default:x(()=>[u(v,{modelValue:b(p).title,"onUpdate:modelValue":_[0]||(_[0]=k=>b(p).title=k),placeholder:"\u8FED\u4EE3\u540D\u79F0",maxlength:"255"},null,8,["modelValue"])]),_:1}),u(s,{label:"\u6240\u5C5E\u9879\u76EE",prop:"project_id",class:"hide_required"},{default:x(()=>[u(I,{disabled:i.value,modelValue:b(p).project_id,"onUpdate:modelValue":_[1]||(_[1]=k=>b(p).project_id=k),filterable:"","no-data-text":"\u6682\u65E0\u6570\u636E","no-match-text":"\u6682\u65E0\u6570\u636E",placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u9879\u76EE",class:"w-full","popper-class":"w-full",teleported:!1},{default:x(()=>[(D(!0),U(q,null,me(F.value,k=>(D(),j(n,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1}),u(s,{label:"\u8FED\u4EE3\u63CF\u8FF0"},{default:x(()=>[u(v,{modelValue:b(p).description,"onUpdate:modelValue":_[2]||(_[2]=k=>b(p).description=k),type:"textarea",autosize:{minRows:4,maxRows:4},maxlength:"255"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[J,b(r)]])]),_:1},8,["modelValue","title"])}}});var et=Xe;const tt=(e,t,l={id:"id",parentId:"parentId",root:0})=>{let o=[];return function a(r){if(r[l.parentId]===l.root)return o;const f=t.find(c=>c[l.id]===r[l.parentId]);return f?(o.push(f),a(f)):o}(e)},S=(e=[],t="children")=>e.reduce((l,o)=>{const a=we(o);return l.concat(a,a[t]?S(a[t],t):[])},[]);let ne=0;const lt=e=>{let t=[];if(e)for(t.push(e);t.length;){let l=t.shift();l.sort=ne,ne++;let o=l.sub_nodes||[];for(let a=0;a<o.length;a++)t.push(o[a])}},W=(e=[],t={id:"id",pid:"pid",children:"children",rootPidVal:null})=>{const l=[];let o={};return(e||[]).forEach(a=>{const{id:r,parent_id:f}=a;o[r]||(o[r]={sub_nodes:[]}),o[r]=oe($({},a),{sub_nodes:o[r].sub_nodes});const c=o[r];f===0?l.push(c):(o[f]||(o[f]={sub_nodes:[]}),o[f].sub_nodes.push(c))}),l},st={name:"AcTransferTree",props:{width:{type:String,default:"100%"},height:{type:String,default:"320px"},title:{type:Array,default:()=>["\u6E90\u5217\u8868","\u76EE\u6807\u5217\u8868"]},button_text:{type:Array,default:()=>["\u6DFB\u52A0","\u79FB\u9664"]},from_data:{type:Array,default:()=>[]},to_data:{type:Array,default:()=>[]},defaultProps:Object,node_key:{type:String,default:"id"},pid:{type:String,default:"pid"},rootPidValue:{type:[String,Number],default:0},filter:{type:Boolean,default:!1},openAll:{type:Boolean,default:!1},transferOpenNode:{type:Boolean,default:!0},defaultCheckedKeys:{type:Array,default:()=>[]},defaultExpandedKeys:{type:Array,default:()=>[]},placeholder:{type:String,default:"\u8F93\u5165\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4"},filterNode:Function,defaultTransfer:{type:Boolean,default:!1},lazy:{type:Boolean,default:!1},lazyRight:{type:Boolean,default:!1},lazyFn:Function,highLight:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},checkStrictlyType:{type:String,default:"authorization",validator:function(e){return["authorization","puppet","modular"].indexOf(e)!==-1}},accordion:{type:Boolean,default:!1},renderAfterExpand:{type:Boolean,default:!0},expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:{type:Boolean,default:!1},indent:{type:Number,default:16}},data(){return{allExpandedKeys:[],DArrowRight:ae(be),DArrowLeft:ae(Te),from_is_indeterminate:!1,from_check_all:!1,from_expanded_keys:[],from_disabled:!0,from_check_keys:[],from_array_clone:[],to_check_all:!1,to_is_indeterminate:!1,to_expanded_keys:[],to_disabled:!0,to_check_keys:[],to_array_clone:[],filterFrom:"",filterTo:"",strictly_parents:[],strictly_transferred:[]}},computed:{self_from_data(){return this.from_data},self_to_data(){return this.to_data},fromTitle(){let[e]=this.title;return e},toTitle(){let[,e]=this.title;return e},selfDefaultProps(){return $({label:"label",children:"children"},this.defaultProps)}},watch:{from_check_keys(e){if(e.length>0){this.from_disabled=!1,this.from_is_indeterminate=!0;let t=!1;this.checkStrictly?t=e.length===this.from_array_clone.length:t=e.filter(o=>o[this.pid]===this.rootPidValue).length===this.self_from_data.length,t?(this.from_is_indeterminate=!1,this.from_check_all=!0):(this.from_is_indeterminate=!0,this.from_check_all=!1)}else this.from_disabled=!0,this.from_is_indeterminate=!1,this.from_check_all=!1},to_check_keys(e){if(e.length>0){this.to_disabled=!1,this.to_is_indeterminate=!0;let t=!1;this.checkStrictly?t=e.length===this.to_array_clone.length:t=e.filter(o=>o[this.pid]===this.rootPidValue).length===this.self_to_data.length,t?(this.to_is_indeterminate=!1,this.to_check_all=!0):(this.to_is_indeterminate=!0,this.to_check_all=!1)}else this.to_disabled=!0,this.to_is_indeterminate=!1,this.to_check_all=!1},filterFrom(e){this.$refs["from-tree"].filter(e)},filterTo(e){this.$refs["to-tree"].filter(e)},defaultCheckedKeys:{handler(e){this.from_check_keys=e||[],this.defaultTransfer&&this.from_check_keys.length&&this.$nextTick(()=>{this.addToAims(!1)})},immediate:!0},defaultExpandedKeys:{handler(e){let t=new Set(this.from_expanded_keys.concat(e));this.from_expanded_keys=[...t];let l=new Set(this.to_expanded_keys.concat(e));this.to_expanded_keys=[...l]},immediate:!0}},methods:{onNodeExpand(e,t,l){let o=l==="from"?this.from_expanded_keys:this.to_expanded_keys;const a=new Set(o.concat(e.id));this[l==="from"?"from_expanded_keys":"to_expanded_keys"]=[...a]},onNodeCollapse(e,t,l){const o=t.store,a=[e.id];let r=l==="from"?this.from_expanded_keys:this.to_expanded_keys;(r||[]).forEach(c=>{let m=o.getNode(c);t.contains(m)&&a.push(c)});const f=r.filter(c=>a.indexOf(c)===-1);this[l==="from"?"from_expanded_keys":"to_expanded_keys"]=[...f]},addToAims(e){let t=this.$refs["from-tree"].getCheckedKeys(),l=this.$refs["from-tree"].getHalfCheckedKeys(),o=this.$refs["from-tree"].getCheckedNodes(),a=this.$refs["from-tree"].getHalfCheckedNodes(),r=this.selfDefaultProps.children||"children",f=this.pid||"pid",c=this.node_key||"id",m=this.rootPidValue||0;this.to_array_clone=S(this.self_to_data,this.selfDefaultProps.children),a.forEach(d=>{if(this.to_array_clone.some(A=>A[c]===d[c]))return;let V=m!==d[f]?d[f]:null;this.$refs["to-tree"].append(Object.assign({},d,{[r]:[]}),V)});let h=Y(o,this.to_array_clone,c);h.forEach(d=>{if(h.some(A=>A[c]===d[f]))return;let V=m!==d[f]?d[f]:null;this.$refs["to-tree"].append(d,V)}),o.map(d=>this.$refs["from-tree"].remove(d)),this.from_check_keys=[],this.$refs["to-tree"].setCheckedKeys([]),this.to_check_all=!1,this.to_is_indeterminate=!1;const i=[...o,...this.strictly_parents];e&&this.$emit("add-btn",this.self_from_data,this.self_to_data,{keys:t,nodes:i,harfKeys:l,halfNodes:a}),this.$refs["from-tree"].setCheckedKeys([])},removeToSource(){let e=this.$refs["to-tree"].getCheckedKeys(),t=this.$refs["to-tree"].getHalfCheckedKeys(),l=this.$refs["to-tree"].getCheckedNodes(),o=this.$refs["to-tree"].getHalfCheckedNodes(),a=this.selfDefaultProps.children||"children",r=this.pid||"pid",f=this.node_key||"id",c=this.rootPidValue||0;this.from_array_clone=S(this.self_from_data,this.selfDefaultProps.children),o.forEach(h=>{if(this.from_array_clone.some(F=>F[f]===h[f]))return;let d=c!==h[r]?h[r]:null;this.$refs["from-tree"].append(Object.assign({},h,{[a]:[]}),d)});let m=Y(l,this.from_array_clone,f);m.forEach(h=>{if(m.some(F=>F[f]===h[r]))return;let d=c!==h[r]?h[r]:null;this.$refs["from-tree"].append(h,d)}),l.map(h=>this.$refs["to-tree"].remove(h)),this.to_check_keys=[],this.$refs["from-tree"].setCheckedKeys([]),this.from_check_all=!1,this.from_is_indeterminate=!1,this.$emit("remove-btn",this.self_from_data,this.self_to_data,{keys:e,nodes:l,harfKeys:t,halfNodes:o}),this.$refs["to-tree"].setCheckedKeys([])},leftloadNode(e,t){this.lazyFn&&this.lazyFn(e,t,"left")},rightloadNode(e,t){this.lazyFn&&this.lazyFn(e,t,"right")},fromTreeChecked(e,t){this.from_check_keys=t.checkedNodes,this.checkStrictly&&this.checkStrictlyType==="authorization"&&this.from_check_keys.some(l=>l[this.node_key]===e[this.node_key])&&this.authorizationAutoCheckLeft(e),this.$nextTick(()=>{this.$emit("left-check-change",e,t,this.from_check_all)})},authorizationAutoCheckLeft(e){const t=tt(e,this.from_array_clone,{id:this.node_key,parentId:this.pid,root:this.rootPidValue});if(!t.length)return;Y(t,this.from_check_keys,this.node_key).forEach(o=>{this.$refs["from-tree"].setChecked(o,!0),this.from_check_keys.push(o)})},toTreeChecked(e,t){this.to_check_keys=t.checkedNodes,this.checkStrictly&&this.checkStrictlyType==="authorization"&&this.to_check_keys.some(l=>l[this.node_key]===e[this.node_key])&&this.authorizationAutoCheckRight(e),this.$nextTick(()=>{this.$emit("right-check-change",e,t,this.to_check_all)})},authorizationAutoCheckRight(e){const t=S([e],this.selfDefaultProps.children);if(!t.length)return;Y(t,this.to_check_keys,this.node_key).forEach(o=>{this.to_check_keys.push(o),this.$refs["to-tree"].setChecked(o,!0)})},fromAllBoxChange(e){!this.self_from_data.length||(e?(this.from_check_keys=this.checkStrictly?S(this.self_from_data,this.selfDefaultProps.children):this.self_from_data,this.$refs["from-tree"].setCheckedNodes(this.from_check_keys)):(this.$refs["from-tree"].setCheckedNodes([]),this.from_check_keys=[]),this.$emit("left-check-change",null,null,this.from_check_all))},toAllBoxChange(e){!this.self_to_data.length||(e?(this.to_check_keys=this.checkStrictly?S(this.self_to_data,this.selfDefaultProps.children):this.self_to_data,this.$refs["to-tree"].setCheckedNodes(this.to_check_keys)):(this.$refs["to-tree"].setCheckedNodes([]),this.to_check_keys=[]),this.$emit("right-check-change",null,null,this.to_check_all))},filterNodeFrom(e,t){return this.filterNode?this.filterNode(e,t,"form"):e?t[this.selfDefaultProps.label].indexOf(e)!==-1:!0},filterNodeTo(e,t){return this.filterNode?this.filterNode(e,t,"to"):e?t[this.selfDefaultProps.label].indexOf(e)!==-1:!0},clearChecked(e="all"){e==="left"?(this.$refs["from-tree"].setCheckedKeys([]),this.from_is_indeterminate=!1,this.from_check_all=!1):e==="right"?(this.$refs["to-tree"].setCheckedKeys([]),this.to_is_indeterminate=!1,this.to_check_all=!1):(this.$refs["from-tree"].setCheckedKeys([]),this.$refs["to-tree"].setCheckedKeys([]),this.from_is_indeterminate=!1,this.from_check_all=!1,this.to_is_indeterminate=!1,this.to_check_all=!1)},clearExpand(){this.from_expanded_keys=[],this.to_expanded_keys=[]},getChecked(){let e=this.$refs["from-tree"].getCheckedKeys(),t=this.$refs["from-tree"].getHalfCheckedKeys(),l=this.$refs["from-tree"].getCheckedNodes(),o=this.$refs["from-tree"].getHalfCheckedNodes(),a=this.$refs["to-tree"].getCheckedKeys(),r=this.$refs["to-tree"].getHalfCheckedKeys(),f=this.$refs["to-tree"].getCheckedNodes(),c=this.$refs["to-tree"].getHalfCheckedNodes();return{leftKeys:e,leftHarfKeys:t,leftNodes:l,leftHalfNodes:o,rightKeys:a,rightHarfKeys:r,rightNodes:f,rightHalfNodes:c}},setChecked(e=[],t=[]){this.$refs["from-tree"].setCheckedKeys(e),this.$refs["to-tree"].setCheckedKeys(t)},clearFilter(e="all"){e==="left"?this.filterFrom="":e==="right"?this.filterTo="":(this.filterFrom="",this.filterTo="")},getFlattenValues(){return S(this.self_to_data,this.selfDefaultProps.children).map(e=>te(e))}}},ot={class:"transfer-left"},at={class:"transfer-title"},rt={class:"transfer-main"},it=["title"],nt={class:"transfer-center"},dt={class:"transfer-center-item"},ct={class:"transfer-center-item"},ut={class:"transfer-center-item"},ft={class:"transfer-center-item"},ht={class:"transfer-right"},_t={class:"transfer-title"},mt={class:"transfer-main"},pt=["title"];function kt(e,t,l,o,a,r){const f=Ne,c=de,m=Fe,h=Q;return D(),U("div",{class:"wl-transfer transfer",style:Be({width:l.width,height:l.height})},[E("div",ot,[E("h3",at,[u(f,{indeterminate:a.from_is_indeterminate,modelValue:a.from_check_all,"onUpdate:modelValue":t[0]||(t[0]=i=>a.from_check_all=i),onChange:r.fromAllBoxChange},null,8,["indeterminate","modelValue","onChange"]),E("span",null,G(r.fromTitle),1),H(e.$slots,"title-left")]),E("div",rt,[l.filter?(D(),j(c,{key:0,clearable:"",size:"small",placeholder:l.placeholder,modelValue:a.filterFrom,"onUpdate:modelValue":t[1]||(t[1]=i=>a.filterFrom=i),class:"filter-tree"},null,8,["placeholder","modelValue"])):re("",!0),u(m,{ref:"from-tree","show-checkbox":"","empty-text":"\u6682\u65E0\u6570\u636E",lazy:l.lazy,indent:l.indent,"node-key":l.node_key,load:r.leftloadNode,data:r.self_from_data,accordion:l.accordion,props:r.selfDefaultProps,"default-expand-all":l.openAll,"highlight-current":l.highLight,"check-strictly":l.checkStrictly,"filter-node-method":r.filterNodeFrom,"check-on-click-node":l.checkOnClickNode,"render-after-expand":l.renderAfterExpand,"expand-on-click-node":l.expandOnClickNode,"default-checked-keys":l.defaultCheckedKeys,"default-expanded-keys":a.from_expanded_keys,onNodeExpand:t[2]||(t[2]=(i,d)=>r.onNodeExpand(i,d,"from")),onNodeCollapse:t[3]||(t[3]=(i,d)=>r.onNodeCollapse(i,d,"from")),onCheck:r.fromTreeChecked},{default:x(({node:i,data:d})=>[E("div",{class:"block truncate",title:i.label},[H(e.$slots,"content-left",{node:i,data:d},()=>[P(G(i.label),1)])],8,it)]),_:3},8,["lazy","indent","node-key","load","data","accordion","props","default-expand-all","highlight-current","check-strictly","filter-node-method","check-on-click-node","render-after-expand","expand-on-click-node","default-checked-keys","default-expanded-keys","onCheck"]),H(e.$slots,"left-footer")])]),E("div",nt,[l.button_text?(D(),U(q,{key:0},[E("p",dt,[u(h,{type:"primary",onClick:t[4]||(t[4]=i=>r.addToAims(!0)),disabled:a.from_disabled,icon:a.DArrowRight},null,8,["disabled","icon"])]),E("p",ct,[u(h,{type:"primary",onClick:r.removeToSource,disabled:a.to_disabled,icon:a.DArrowLeft},null,8,["onClick","disabled","icon"])])],64)):(D(),U(q,{key:1},[E("p",ut,[u(h,{type:"primary",onClick:t[5]||(t[5]=i=>r.addToAims(!0)),disabled:a.from_disabled,circle:""},null,8,["disabled"])]),E("p",ft,[u(h,{type:"primary",onClick:r.removeToSource,disabled:a.to_disabled,icon:"el-icon-arrow-left",circle:""},null,8,["onClick","disabled"])])],64))]),E("div",ht,[E("h3",_t,[u(f,{indeterminate:a.to_is_indeterminate,modelValue:a.to_check_all,"onUpdate:modelValue":t[6]||(t[6]=i=>a.to_check_all=i),onChange:r.toAllBoxChange},null,8,["indeterminate","modelValue","onChange"]),E("span",null,G(r.toTitle),1),H(e.$slots,"title-right")]),E("div",mt,[l.filter?(D(),j(c,{key:0,clearable:"",size:"small",modelValue:a.filterTo,"onUpdate:modelValue":t[7]||(t[7]=i=>a.filterTo=i),placeholder:l.placeholder,class:"filter-tree"},null,8,["modelValue","placeholder"])):re("",!0),u(m,{ref:"to-tree","show-checkbox":"","empty-text":"\u6682\u65E0\u6570\u636E",indent:l.indent,lazy:l.lazyRight,data:r.self_to_data,"node-key":l.node_key,load:r.rightloadNode,props:r.selfDefaultProps,"default-expand-all":l.openAll,"highlight-current":l.highLight,"check-strictly":l.checkStrictly,"filter-node-method":r.filterNodeTo,"check-on-click-node":l.checkOnClickNode,"render-after-expand":l.renderAfterExpand,"expand-on-click-node":l.expandOnClickNode,"default-expanded-keys":a.to_expanded_keys,onNodeExpand:t[8]||(t[8]=(i,d)=>r.onNodeExpand(i,d,"to")),onNodeCollapse:t[9]||(t[9]=(i,d)=>r.onNodeCollapse(i,d,"to")),onCheck:r.toTreeChecked},{default:x(({node:i,data:d})=>[E("div",{class:"block truncate",title:i.label},[H(e.$slots,"content-left",{node:i,data:d},()=>[P(G(i.label),1)])],8,pt)]),_:3},8,["indent","lazy","data","node-key","load","props","default-expand-all","highlight-current","check-strictly","filter-node-method","check-on-click-node","render-after-expand","expand-on-click-node","default-expanded-keys","onCheck"]),H(e.$slots,"right-footer")])])],4)}var yt=He(st,[["render",kt]]);const gt=E("p",{class:"title border-l-[3px] p-2 mb-3 italic"},"\u89C4\u5212\u672C\u6B21\u8FED\u4EE3\u6240\u6D89\u53CA\u7684API",-1),Ct=P(" \u53D6\u6D88 "),vt=P(" \u786E \u5B9A "),Et=X({emits:["ok"],setup(e,{expose:t,emit:l}){const o={label:"title",children:"sub_nodes"},[a,r]=Z(Ue),[f,c]=Z($e,{isCatch:!1}),m=T(!1),h=T(null),i=T(),d=T([]),F=T([]),V=T([]),A=g=>{m.value=!0,h.value=g.id},p=()=>{m.value=!1},L=()=>{p()},z=async()=>{const g=b(h);if(g===null)return;const C=i.value.getFlattenValues().map(N=>N.id);await c({iteration_id:g,node_ids:C}),l("ok"),p()};M(m,()=>{var g;m.value||(d.value=[],F.value=[],V.value=[],h.value=null,(g=i.value)==null||g.clearExpand())}),M(h,async()=>{const g=b(h);if(g===null)return;const{data:C}=await r({iteration_id:g});lt({sub_nodes:C});const N=S(C||[],o.children),y=[],_=new Set;N.forEach(n=>{n.selected&&(n.sub_nodes=[],y.push(n),n.type===ie.DOC&&_.add(n.id))});let v=N.filter(n=>!_.has(n.id));v.map(n=>(n.sub_nodes=[],n)),v=W(v);const s=(n,I,O)=>{let B=n.length;for(;B--;){const K=n[B];s(K.sub_nodes,K,n)}if(I&&I.type===ie.DIR&&!(I.sub_nodes||[]).length){const k=O.indexOf(I);k!=-1&&O.splice(k,1)}};s(v,null,null),y.map(n=>(n.sub_nodes=[],n)),d.value=v,F.value=W(y)});const w=g=>{(g||[]).forEach(C=>{C.sub_nodes&&C.sub_nodes.length&&w(C.sub_nodes)}),g.sort((C,N)=>C.sort-N.sort)},R=(g,C)=>{const N=W(S(g||[],o.children)),y=W(S(C||[],o.children));w(N),w(y),d.value=N,F.value=y};return t({show:A}),(g,C)=>{const N=yt,y=Q,_=fe,v=he;return D(),j(_,{modelValue:m.value,"onUpdate:modelValue":C[1]||(C[1]=s=>m.value=s),width:800,"close-on-click-modal":!1,title:"\u89C4\u5212\u8FED\u4EE3","append-to-body":"",class:"show-footer-line"},{footer:x(()=>[u(y,{onClick:C[0]||(C[0]=s=>L())},{default:x(()=>[Ct]),_:1}),u(y,{loading:b(f),type:"primary",onClick:z},{default:x(()=>[vt]),_:1},8,["loading"])]),default:x(()=>[gt,ee(u(N,{height:"500px",ref_key:"transferTreeRef",ref:i,defaultProps:o,from_data:d.value,to_data:F.value,pid:"parent_id",filter:"",title:["\u6240\u6709API","\u5DF2\u89C4\u5212API"],onAddBtn:R,onRemoveBtn:R},null,8,["from_data","to_data"]),[[v,b(a)]])]),_:1},8,["modelValue"])}}});var xt=Et;const bt={class:"flex items-center justify-between"},Tt=E("span",null,"\u8FED\u4EE3\u5217\u8868",-1),Ft={class:"absolute flex right-2"},Nt=E("p",{class:"p-2 text-center"},"\u6682\u65E0\u9879\u76EE",-1),At=P("\u65B0\u5EFA\u8FED\u4EE3");var Bt=X({setup(e){const t={project_id:""},l=pe(),{isActiveIterateList:o,activeTab:a}=_e(l),r=s=>(s.to=We(s.id),s),{isLoading:f,currentPage:c,data:m,total:h,getTableData:i}=Ie(Me,{searchParam:t,totalKey:"total_iterations",dataKey:"iterations",isLoaded:!1,transform:r}),[d,F]=Z(qe),V=T([{title:"\u8FED\u4EE3\u540D\u79F0",ellipsis:!0,tooltip:!0,key:"title",render(s){return u("a",{href:s.to,class:"text-blue-600 cursor-pointer"},[s.title])}},{title:"\u6240\u5C5E\u9879\u76EE",ellipsis:!0,tooltip:!0,width:200,key:"project_title",render(s){return u("div",{class:"flex items-center collect-item"},[u("div",{class:"overflow-hidden"},[u("p",{class:"truncate "},[s.project_title])]),o.value&&u("i",{class:["cursor-pointer collect-icon iconfont h-[21px]",{"iconstar-fill":s.star,iconstar:!s.star}],onClick:()=>R(s)},null)])}},{title:"API\u6570\u91CF",ellipsis:!0,tooltip:!0,key:"api_num"},{title:"\u521B\u5EFA\u65F6\u95F4",key:"created_at"},{title:"\u64CD\u4F5C",width:150,ellipsis:!1,tooltip:!1,render(s){return s.authority===Je.READER?[]:u("div",null,[u("span",{class:"mr-3 cursor-pointer",onClick:()=>C(s)},[P("\u7F16\u8F91")]),u("span",{class:"mr-3 cursor-pointer",onClick:()=>N(s)},[P("\u89C4\u5212")]),u("span",{class:"mr-3 text-red-400 cursor-pointer",onClick:()=>y(s)},[P("\u5220\u9664")])])}}]),A=T(""),p=T([]),L=T(),z=T(),w=s=>{var n;(n=L.value)==null||n.show(s)},R=async s=>{const n=s.star?l.removeProjectFromCollect:l.addProjectToCollect;s.star=!s.star;try{await n(s),g(s.project_id,s.star)}catch{s.star=!s.star,g(s.project_id,s.star)}},g=(s,n)=>{m.value.forEach(I=>{I.project_id===s&&(I.star=n)})},C=s=>w(s),N=s=>{var n;(n=z.value)==null||n.show(te(s))},y=s=>{Ye({title:"\u5220\u9664\u63D0\u793A",content:u("div",{class:"truncate",title:s.title},[P("\u786E\u5B9A\u5220\u9664\u8FED\u4EE3\u300C"),s.title,P("\u300D\u5417\uFF1F")]),onOk:()=>Ge({iteration_id:s.id}).then(n=>{Ae.success(n.msg||"\u5220\u9664\u6210\u529F\uFF01"),i()})})},_=async()=>{await i()};return M(()=>A.value,async()=>{a.value||(t.project_id=A.value,await _())}),M(a,async()=>{A.value="",c.value=1,t.project_id=a.value,await _()}),Ke(async()=>{const[{data:s}]=await Promise.all([F()]);p.value=s||[]}),(s,n)=>{const I=ce,O=ue,B=Q,K=Pe,J=De;return D(),U(q,null,[u(J,{shadow:"never","body-style":{padding:0}},{header:x(()=>[E("div",bt,[Tt,E("div",Ft,[ee(u(O,{modelValue:A.value,"onUpdate:modelValue":n[0]||(n[0]=k=>A.value=k),filterable:"",placeholder:"\u6240\u6709\u9879\u76EE",clearable:"",loading:b(d),"loading-text":"\u52A0\u8F7D\u4E2D...",class:"w-52","popper-class":"w-52"},{empty:x(()=>[Nt]),default:x(()=>[(D(!0),U(q,null,me(p.value,k=>(D(),j(I,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),[[je,b(o)]]),u(B,{class:"ml-2",type:"primary",onClick:n[1]||(n[1]=k=>w())},{default:x(()=>[At]),_:1})])])]),default:x(()=>[u(K,{loading:b(f),"table-data":b(m),"page-total":b(h),"current-page":b(c),"onUpdate:current-page":n[2]||(n[2]=k=>Le(c)?c.value=k:null),columns:V.value,class:"pb-3"},null,8,["loading","table-data","page-total","current-page","columns"])]),_:1}),u(et,{ref_key:"addIterateModal",ref:L,onOk:_},null,512),u(xt,{ref_key:"planIterateModal",ref:z,onOk:b(i)},null,8,["onOk"])],64)}}});export{Bt as default};
