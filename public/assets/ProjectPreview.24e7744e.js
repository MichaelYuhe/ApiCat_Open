var L=Object.defineProperty,b=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var w=(i,e,t)=>e in i?L(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,v=(i,e)=>{for(var t in e||(e={}))P.call(e,t)&&w(i,t,e[t]);if(C)for(var t of C(e))T.call(e,t)&&w(i,t,e[t]);return i},j=(i,e)=>b(i,k(e));import{v as S}from"./element-plus.33434d3d.js";import{a1 as f,o as c,e as h,T as I,an as M,Z as p,U as x,f as a,_ as N,V as y,S as m,Y as D,bd as A,Q as O}from"./vendor.1b70e788.js";import{b as g,D as R,ab as _,ac as B,ad as K,ae as V,af as Y,a1 as H}from"./index.0747997f.js";import{A as J}from"./AcEditorDocument.b84bfe67.js";import"./useHighlight.71d85164.js";const U={name:"DocumentTree",props:{tree:{type:Array,default:()=>[]}},data(){return{project_id:this.$route.params.project_id||"",node_id:this.$route.params.node_id||""}},methods:{onItemClick(i){if(!i.isLeaf){i.expanded=!i.expanded;return}this.$router.push({name:"preview.project.document",params:{project_id:this.project_id,node_id:i.id}})},onItemMouseEnter(i,e){i.isHover=e},getItemClass(i){return{open:i.expanded,hover:i.isHover,active:i.selected}}}},z=["onClick"],F=["onMouseenter","onMouseleave"],Q=["onMouseenter","onMouseleave"],Z={class:"text"},q=a("i",{class:"icon iconfont iconarrow-right"},null,-1),G=["id"];function W(i,e,t,s,r,o){const l=f("document-tree",!0);return c(),h("ul",null,[(c(!0),h(I,null,M(t.tree,n=>(c(),h("li",{onClick:p(d=>o.onItemClick(n),["stop"]),key:n.id,class:x(o.getItemClass(n))},[a("div",{class:"ac-preview-catalog_highlight",onMouseenter:p(d=>o.onItemMouseEnter(n,!0),["stop"]),onMouseleave:p(d=>o.onItemMouseEnter(n,!1),["stop"])},null,40,F),a("div",{class:"flex items-center",onMouseenter:p(d=>o.onItemMouseEnter(n,!0),["stop"]),onMouseleave:p(d=>o.onItemMouseEnter(n,!1),["stop"])},[n.isLeaf?(c(),h("a",{key:1,id:"tree_"+n.id,href:"javascript:void(0);",class:"text dis_hover"},N(n.name),9,G)):(c(),h(I,{key:0},[a("span",Z,N(n.name),1),q],64))],40,Q),n.children&&n.children.length?(c(),y(l,{key:0,tree:n.children},null,8,["tree"])):m("",!0)],10,z))),128))])}var X=g(U,[["render",W]]);class ${constructor(e){const{id:t,isLeaf:s,editable:r,expanded:o,selected:l}=e;this.id=typeof t=="undefined"?new Date().valueOf():t,this.parent=null,this.children=null,this.isLeaf=!!s,this.isHover=!1,this.editable=!!r,this.expanded=!!o,this.selected=!!l,this.dragDisabled=!1;for(var n in e)n!=="id"&&n!=="children"&&n!=="isLeaf"&&(this[n]=e[n])}changeName(e){this.name=e}addChildren(e,t=!1){if(this.children||(this.children=[]),Array.isArray(e)){for(let s=0,r=e.length;s<r;s++){const o=e[s];o.parent=this,o.pid=this.id}this.children.concat(e)}else{const s=e;s.parent=this,s.pid=this.id,s.level=this.level+1,this.children[t?"unshift":"push"](s)}this.sort(this)}remove(){const e=this.parent,t=e.findChildIndex(this);e.children.splice(t,1),this.sort(e)}_removeChild(e){for(var t=0,s=this.children.length;t<s;t++)if(this.children[t]===e){this.children.splice(t,1);break}}isTargetChild(e){let t=e.parent;for(;t;){if(t===this)return!0;t=t.parent}return!1}moveInto(e){this.name==="root"||this===e||this.isTargetChild(e)||e.isLeaf||(this.parent._removeChild(this),this.parent=e,this.pid=e.id,e.children||(e.children=[]),e.children.unshift(this),this.sort(e))}findChildIndex(e){var t;for(let s=0,r=this.children.length;s<r;s++)if(this.children[s]===e){t=s;break}return t}_canInsert(e){return this.name==="root"||this===e||this.isTargetChild(e)?!1:(this.parent._removeChild(this),this.parent=e.parent,this.pid=e.parent.id,!0)}insertBefore(e){if(!this._canInsert(e))return;const t=e.parent.findChildIndex(e);e.parent.children.splice(t,0,this),this.sort(e.parent)}insertAfter(e){if(!this._canInsert(e))return;const t=e.parent.findChildIndex(e);e.parent.children.splice(t+1,0,this),this.sort(e.parent)}insertAfterNoSwap(e){let t=this.parent,s=t.findChildIndex(this);t.children.splice(s+1,0,e),this.sort(t)}sort(e){let t=e.level;(e.children||[]).forEach((s,r)=>{s.index=r,s.level=t+1,s.children&&s.children.length&&this.sort(s)})}}class u{constructor(e){return this.root=new $({name:"root",isLeaf:!1,id:0,isRoot:!0,level:0}),this.getNodes(this.root,e),this}getNodes(e,t,s=[]){(t||[]).forEach((r,o)=>{var l=s.concat(o),n=this.getNode(l,r,o),d=new $(n);e.addChildren(d),r.sub_nodes&&r.sub_nodes.length>0&&this.getNodes(d,r.sub_nodes,l)})}getNode(e,t,s){return j(v({index:s,isLeaf:t.type!==R.DIR,name:t.title||""},t),{_id:t.doc_type+t.id,path:e,level:e.length})}static traverse(e,t=null,s=[]){if(!t)return;let r=!1;const o=[];for(let l=0;l<t.length;l++){const n=t[l],d=s.concat(l);if(r=e(n,t)===!1,o.push(n),r||n.children&&(r=this.traverse(e,n.children,d)===!1,r))break}return r?!1:o}static getDepth(e){if(!e.children||!e.children.length)return 1;let t=s=>{let r=1;return s.forEach(o=>{o.children?r=Math.max(r,t(o.children)+1):r=r+1}),r};return t(e.children)}static findNode(e,t){let s=null;return u.traverse(r=>{if(r.id===e)return s=r,!1},t),s}comparePaths(e,t){for(let s=0;s<e.length;s++){if(t[s]==null||e[s]>t[s])return 1;if(e[s]<t[s])return-1}return t[e.length]==null?0:-1}getNextNode(e,t=null){let s=null;return u.traverse(r=>{if(!(this.comparePaths(r.path,e)<1)&&(!t||t(r)))return s=r,!1},this.root.children),s}getPrevNode(e,t){let s=[];u.traverse(o=>{if(this.comparePaths(o.path,e)>=0)return!1;s.push(o)},this.root.children);let r=s.length;for(;r--;){const o=s[r];if(!t||t(o))return o}return null}}const ee={name:"DocumentCatalog",components:{DocumentTree:X},props:{list:{type:Array,default:()=>[]},project:{type:Object,default:()=>({})}},watch:{"$route.params.node_id":function(){let i=parseInt(this.$route.params.node_id,10);this.node_id=isNaN(i)?null:i,this.activeNode()},list:function(){this.initProjectCatalog()}},data(){let i=parseInt(this.$route.params.node_id,10);return{project_id:this.$route.params.project_id,node_id:isNaN(i)?null:i,token:_.get(_.KEYS.SECRET_PROJECT_TOKEN+this.$route.params.project_id||"",!0),tree:[]}},methods:{reactiveNode(){let i=!1;if(u.traverse(e=>{if(e.selected)return i=e.selected,!1},this.tree),!i){let e=null;u.traverse(s=>{if(s.isLeaf)return e=s,!1},this.tree);let t={project_id:this.project_id};e&&(t.node_id=e.id,this.node_id!==e.id&&this.$router.push({name:"preview.project.document",params:t}))}},activeNode(){let i=null;for(u.traverse(e=>{e.selected=!1,e.id===parseInt(this.node_id,10)&&(e.selected=!0,i=e)},this.tree);i&&i.parent;)i=i.parent,i.isRoot||(i.expanded=!0)},initProjectCatalog(){let{root:i}=new u(this.list||[]);this.tree=i.children||[],this.node_id?this.activeNode():this.reactiveNode()}},created(){this.initProjectCatalog()}},te={class:"ac-preview-catalog scroll-content"},se=a("div",{class:"sidebar-header"},null,-1);function ie(i,e,t,s,r,o){const l=f("document-tree");return c(),h("div",te,[se,D(l,{tree:r.tree},null,8,["tree"])])}var re=g(ee,[["render",ie]]),ne="/assets/img-empty.af8d0028.png";const oe={name:"ProjectPreview",components:{DocumentCatalog:re,AcEditorDocument:J},data(){return{isLoading:!1,isShowCatalog:!0,navigation:{},documentInfo:{},catalogList:[],project_id:this.$route.params.project_id,token:_.get(_.KEYS.SECRET_PROJECT_TOKEN+this.$route.params.project_id||"",!0)}},computed:v({},A(B,["projectInfo"])),watch:{$route:function(){this.getDocumentDetail()}},methods:{setTitle(i){document.title=i||"ApiCat \u6587\u6863\u9884\u89C8"},async getProjectCatalog(){try{const{data:i}=await K(this.token,this.project_id);this.catalogList=i||[]}catch{}},syncTreeTitle(i,e){let t=document.getElementById("tree_"+i);t&&t.innerText!==e&&(t.innerText=e)},getDocumentDetail(){!this.$route.params.node_id||!this.catalogList.length||(this.isLoading=!0,V(this.token,this.project_id,this.$route.params.node_id).then(i=>{this.documentInfo=i.data||{},this.setTitle(this.documentInfo.title),this.syncTreeTitle(this.$route.params.node_id,this.documentInfo.title)}).catch(()=>{}).finally(()=>{this.isLoading=!1}))}},async mounted(){Y(),await this.getProjectCatalog(),H(),this.getDocumentDetail()}},ae={class:"sidebar"},le={class:"sidebar-body"},de={class:"sidebar-pin-wrapper"},ce=a("div",{class:"pin-inner"},[a("i",{class:"iconfont iconback"})],-1),he=[ce],ue={class:"ac-preview-content"},pe={key:1,class:"text-center pt-16"},fe=a("div",{class:"result"},[a("div",{class:"result-img"},[a("img",{src:ne,alt:""})]),a("p",{class:"mt-6 result-title"},"\u8FD9\u662F\u4E00\u7BC7\u8352\u829C\u4E4B\u5730\uFF0C\u8FD8\u672A\u521B\u5EFA\u8FC7\u4E00\u7BC7\u6587\u6863...")],-1),_e=[fe];function ve(i,e,t,s,r,o){const l=f("DocumentCatalog"),n=f("AcEditorDocument"),d=S;return c(),h("main",{class:x(["ac-preview",{"open-sidebar":r.isShowCatalog}])},[a("aside",ae,[a("div",le,[D(l,{project:i.projectInfo,list:r.catalogList},null,8,["project","list"])]),a("div",{class:"sidebar-dragbar",onClick:e[0]||(e[0]=E=>r.isShowCatalog=!r.isShowCatalog)}),a("div",de,[a("div",{class:"pin",onClick:e[1]||(e[1]=E=>r.isShowCatalog=!r.isShowCatalog)},he)])]),O((c(),h("div",ue,[r.catalogList.length?(c(),y(n,{key:0,doc:r.documentInfo},null,8,["doc"])):m("",!0),r.catalogList.length?m("",!0):(c(),h("div",pe,_e))])),[[d,r.isLoading]])],2)}var Ne=g(oe,[["render",ve]]);export{Ne as default};
