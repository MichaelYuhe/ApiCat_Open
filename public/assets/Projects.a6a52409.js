var oe=Object.defineProperty;var q=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var H=(e,o,n)=>o in e?oe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,M=(e,o)=>{for(var n in o||(o={}))te.call(o,n)&&H(e,n,o[n]);if(q)for(var n of q(o))se.call(o,n)&&H(e,n,o[n]);return e};import{_ as ne,a as le}from"./ImagePreview.aca73709.js";import{D as re,e as J,f as G,g as ie,h as ae,$ as ue,b as $,j as ce,k as a,l as de,n as pe,o as _e,d as z,p as me,q as fe,r as he,u as Ee,t as ve,v as ge,w as Pe,x as ke}from"./index.6adbff9a.js";import{a8 as we,aC as je,bu as be,a6 as r,o as j,S as N,T as s,_ as t,a5 as K,Y as O,ba as W,a as k,c as R,ai as x,F as B,d as X,be as Ce,r as w,bg as Ae,x as Z,aF as Se,y as ye,ar as Re,U as Oe,v as V,Z as Y,b7 as Fe,b8 as Ie}from"./vendor.2ee35ec0.js";import{n as Le,v as De,o as Me,E as Q,q as Be,p as Ve}from"./element-plus.5b1d6711.js";const T="/static/icon-project.png",Ne={setup(){const e=we({isShow:!1,PROJECT_DEFAULT_ICON:T,isLoading:!1,imgUrl:null,file:null,disableType:!1,docTypes:re,form:{icon_link:T,name:"",type:J.API.value,visibility:0,description:""},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\u79F0",trigger:"blur"},{min:2,message:"\u9879\u76EE\u540D\u79F0\u4E0D\u80FD\u5C11\u4E8E\u4E24\u4E2A\u5B57",trigger:"blur"}]}});return M({},je(e))},computed:M({},be(G,["activeGroup"])),components:{Lock:Le,View:De,Upload:Me},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{handleUpload(e){return e.append("icon",this.file),ie(e)},show(){this.isShow=!0},hide(){this.isShow=!1},reset(){this.$refs.projectForm.resetFields(),this.form={icon_link:T,name:"",type:J.API.value,visibility:0,description:""}},onCloseBtnClick(){this.isShow=!1,this.reset()},onImageUpload(e,o){this.imgUrl=e,this.file=o},onProjectIconUploadSuccess(e){this.form.icon_link=e},handleSubmit(e){this.$refs[e].validate(o=>{o&&(this.isLoading=!0,this.form.group_id=this.activeGroup.id,ae(this.form).then(n=>{this.$message.success(n.msg||"\u9879\u76EE\u521B\u5EFA\u6210\u529F\uFF01"),ue(this,"on-ok",n.data||{})}).catch(n=>{}).finally(()=>{this.isLoading=!1,this.hide()}))})}},emits:["on-ok"]},Ue=O("\u4E0A\u4F20\u65B0\u56FE\u6807 "),Te=O("\u79C1\u6709 "),Ge=O("\u516C\u5F00 "),$e=O(" \u53D6\u6D88 "),xe=O(" \u786E \u5B9A ");function qe(e,o,n,I,f,u){const g=r("el-avatar"),c=r("Upload"),h=r("el-icon"),b=r("el-button"),A=ne,P=r("el-form-item"),d=r("el-input"),C=r("Lock"),E=r("el-radio-button"),_=r("View"),L=r("el-radio-group"),F=le,D=r("el-form"),y=r("el-dialog");return j(),N(y,{modelValue:e.isShow,"onUpdate:modelValue":o[6]||(o[6]=i=>e.isShow=i),width:440,"close-on-click-modal":!1,title:"\u65B0\u5EFA\u9879\u76EE","append-to-body":"","custom-class":"show-footer-line"},{footer:s(()=>[t(b,{onClick:o[4]||(o[4]=i=>u.onCloseBtnClick())},{default:s(()=>[$e]),_:1}),t(b,{loading:e.isLoading,type:"primary",onClick:o[5]||(o[5]=i=>u.handleSubmit("projectForm"))},{default:s(()=>[xe]),_:1},8,["loading"])]),default:s(()=>[t(D,{ref:"projectForm",model:e.form,rules:e.rules,"label-position":"top",style:{width:"400px"},class:"py-2 pl-2",onSubmit:o[3]||(o[3]=K(i=>u.handleSubmit("projectForm"),["prevent"]))},{default:s(()=>[t(P,{label:""},{default:s(()=>[t(g,{class:"mr-7",shape:"square",size:60,src:e.form.icon_link?e.form.icon_link:e.PROJECT_DEFAULT_ICON},null,8,["src"]),t(A,{onDone:u.onImageUpload},{default:s(()=>[t(b,null,{default:s(()=>[t(h,null,{default:s(()=>[t(c)]),_:1}),Ue]),_:1})]),_:1},8,["onDone"])]),_:1}),t(P,{label:"\u9879\u76EE\u540D\u79F0",prop:"name",class:"hide_required"},{default:s(()=>[t(d,{modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=i=>e.form.name=i),placeholder:"\u9879\u76EE\u540D\u79F0",maxlength:"255"},null,8,["modelValue"])]),_:1}),t(P,{label:"\u6743\u9650"},{default:s(()=>[t(L,{modelValue:e.form.visibility,"onUpdate:modelValue":o[1]||(o[1]=i=>e.form.visibility=i)},{default:s(()=>[t(E,{label:0},{default:s(()=>[t(h,{class:"mr-1"},{default:s(()=>[t(C)]),_:1}),Te]),_:1}),t(E,{label:1},{default:s(()=>[t(h,{class:"mr-1"},{default:s(()=>[t(_)]),_:1}),Ge]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(P,{label:"\u9879\u76EE\u63CF\u8FF0"},{default:s(()=>[t(d,{modelValue:e.form.description,"onUpdate:modelValue":o[2]||(o[2]=i=>e.form.description=i),type:"textarea",autosize:{minRows:4,maxRows:4},maxlength:"255"},null,8,["modelValue"])]),_:1}),t(F,{"img-url":e.imgUrl,file:e.file,onOnOk:u.onProjectIconUploadSuccess,"handle-upload":u.handleUpload},null,8,["img-url","file","onOnOk","handle-upload"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var He=$(Ne,[["render",qe]]);const Je={emits:["on-ok"],data(){return{isShow:!1,isLoading:!1,form:{new_group_id:"",project_id:"",old_group_id:""},rules:{new_group_id:{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE\u5206\u7EC4",type:"number",trigger:"blur"}}}},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{show(e){this.form.project_id=e.id;let o=e.group_id||parseInt(this.$route.params.cid||0,10);this.form.old_group_id=isNaN(o)?0:o,this.form.new_group_id=isNaN(o)?0:o,this.isShow=!0},hide(){this.isShow=!1},onCloseBtnClick(){this.isShow=!1,this.reset()},reset(){this.form.project_id="",this.form.old_group_id="",this.form.new_group_id=""},handleSubmit(e){this.$refs[e].validate(o=>o&&this.submit())},submit(){this.isLoading=!0,ce(this.form).then(e=>{this.$Message.success(e.msg||"\u66F4\u6362\u5206\u7EC4\u6210\u529F!"),this.onCloseBtnClick(),this.$emit("on-ok")}).finally(()=>{this.isLoading=!1}).catch(e=>{})}},setup(){const e=G();return M({},W(e))}},ze=O("\u53D6\u6D88"),Ye=O("\u786E\u5B9A");function Qe(e,o,n,I,f,u){const g=r("el-option"),c=r("el-select"),h=r("el-form-item"),b=r("el-form"),A=r("el-button"),P=r("el-dialog");return j(),N(P,{modelValue:f.isShow,"onUpdate:modelValue":o[4]||(o[4]=d=>f.isShow=d),width:340,"close-on-click-modal":!1,title:"\u79FB\u52A8\u9879\u76EE\u5206\u7EC4","append-to-body":"","custom-class":"show-footer-line"},{footer:s(()=>[k("div",null,[t(A,{onClick:o[2]||(o[2]=d=>u.onCloseBtnClick())},{default:s(()=>[ze]),_:1}),t(A,{loading:f.isLoading,type:"primary",onClick:o[3]||(o[3]=d=>u.handleSubmit("teamForm"))},{default:s(()=>[Ye]),_:1},8,["loading"])])]),default:s(()=>[t(b,{onSubmit:o[1]||(o[1]=K(d=>u.handleSubmit("teamForm"),["prevent"])),ref:"teamForm",model:f.form,rules:f.rules,"label-position":"top",style:{"margin-bottom":"-19px"}},{default:s(()=>[t(h,{label:"\u9009\u62E9\u9879\u76EE\u5206\u7EC4",prop:"new_group_id",class:"hide_required"},{default:s(()=>[t(c,{class:"w-full",modelValue:f.form.new_group_id,"onUpdate:modelValue":o[0]||(o[0]=d=>f.form.new_group_id=d),"not-data-text":"\u6682\u65E0\u9879\u76EE\u5206\u7EC4","no-match-text":"\u672A\u67E5\u627E\u5230\u5206\u7EC4",placeholder:"\u9009\u62E9\u88AB\u79FB\u52A8\u7684\u9879\u76EE\u5206\u7EC4",teleported:!1,"popper-class":"w-full overflow-hidden"},{default:s(()=>[t(g,{value:0,label:"\u4E0D\u5206\u7EC4"}),(j(!0),R(B,null,x(e.projectGroupList,d=>(j(),N(g,{value:d.id,key:d.id,label:d.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var Ke=$(Je,[["render",Qe]]);const We=["onClick","innerHTML"],Xe=X({props:{ignoreEle:{default:[]}},emits:["changeGroup","quitProject","deleteProject"],setup(e,{expose:o,emit:n}){const I=e,f=Ce(),u=w(!1),g=w(null),c=w({}),h=w(),b=w(),A=w(),P=w([]);Ae(g,l=>{const m=l.composedPath(),v=I.ignoreEle;v&&v.length>0&&v.some(p=>p&&(l.target===p||m.includes(p)))||(u.value=!1)});const d=()=>{A.value.show(c.value)},C=()=>{n("changeGroup")},E=()=>{z({title:"\u5220\u9664\u63D0\u793A",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u76EE\u5417\uFF1F",onOk:l=>me(c.value.id).then(m=>{Q.success(m.msg||"\u5220\u9664\u6210\u529F\uFF01"),n("deleteProject")}).catch(()=>{l(),n("quitProject")})})},_=()=>{z({title:"\u9000\u51FA\u63D0\u793A",content:"\u786E\u5B9A\u9000\u51FA\u8BE5\u9879\u76EE\u5417\uFF1F",onOk:l=>fe(c.value.id).then(m=>{Q.success(m.msg||"\u5220\u9664\u6210\u529F\uFF01"),n("quitProject")}).catch(()=>{l(),n("quitProject")})})},L=()=>{b.value.show(c.value)},F=()=>{h.value.show({project_id:c.value.id},he)},D=[{text:"\u9884\u89C8\u9879\u76EE",selector:"project_preview",isNewOpen:!0,href:"{id}",field:"preview_link",icon:"iconIconPopoverPlay",roles:[a.MANAGER,a.DEVELOPER]},{text:"\u9879\u76EE\u6210\u5458",selector:"project_members",href:"/project/{id}/members",icon:"iconIconPopoverUser",route:{name:"project.members"},roles:[a.MANAGER,a.DEVELOPER,a.READER]},{text:"\u5206\u4EAB\u9879\u76EE",selector:"project_share",clickFn:L,icon:"iconshare",roles:[a.MANAGER,a.DEVELOPER,a.READER]},{text:"\u5BFC\u51FA\u9879\u76EE",selector:"project_export",clickFn:F,icon:"iconIconPopoverUpload",roles:[a.MANAGER,a.DEVELOPER]},{text:"\u9879\u76EE\u8BBE\u7F6E",selector:"project_edit",href:"/project/{id}/setting",icon:"iconIconPopoverSetting",route:{name:"project.setting"},roles:[a.MANAGER]},{text:"\u9879\u76EE\u5206\u7EC4",selector:"project_group",clickFn:d,icon:"iconfenzu",roles:[a.MANAGER,a.DEVELOPER,a.READER]},{text:"\u5220\u9664\u9879\u76EE",selector:"project_delete",clickFn:E,icon:"iconIconPopoverAlert",roles:[a.MANAGER]},{text:"\u9000\u51FA\u9879\u76EE",selector:"project_quit",clickFn:_,icon:"iconIconPopoverExit",roles:[a.DEVELOPER,a.READER]}],y={};[a.MANAGER,a.DEVELOPER,a.READER].forEach(l=>{const m=y[l]=y[l]||[];D.forEach(v=>{v.roles.join(",").indexOf(l)!==-1&&m.push(v)})});const i=()=>{let m=(_e.find(p=>p.value===c.value.authority)||{}).key,v=y[m]||[];m===a.READER&&!c.value.visibility&&(v=v.filter(p=>p.selector!=="project_share")),P.value=v.map(p=>{let S=M({},p);return S.href&&(S.href=S.href.replace("{id}",c.value[p.field||"id"])),S.menuHtml=`<i class="icon iconfont mr-1 ${S.icon||""}"></i>${S.text}`,S})},U=l=>{if(l.clickFn){l.clickFn();return}if(l.isNewOpen){window.open(l.href);return}l.href&&!l.isNewOpen&&(l.route.params={project_id:c.value[l.field||"id"]},f.push(l.route))},ee=(l,m)=>{g.value=l,c.value=m,u.value=!0};return Z(c,()=>{i()}),o({show:ee}),(l,m)=>{const v=r("el-popover");return j(),R(B,null,[t(v,{visible:u.value,"onUpdate:visible":m[0]||(m[0]=p=>u.value=p),ref:"popoverRef","popper-class":"ac-popper-menu","virtual-ref":g.value,"virtual-triggering":"",width:"auto"},{default:s(()=>[k("ul",null,[(j(!0),R(B,null,x(P.value,p=>(j(),R("li",{class:"ac-popper-menu__item",key:p.selector,onClick:S=>U(p),innerHTML:p.menuHtml},null,8,We))),128))])]),_:1},8,["visible","virtual-ref"]),t(de,{ref_key:"projectExportModal",ref:h},null,512),t(pe,{ref_key:"projectShareModal",ref:b},null,512),t(Ke,{ref_key:"changeProjectGroupModal",ref:A,onOnOk:C},null,512)],64)}}});const Ze=e=>(Fe("data-v-7e014a70"),e=e(),Ie(),e),eo={class:"truncate"},oo={class:"ac-project"},to={class:"ac-project-thumb"},so=["src"],no=["onClick"],lo=["title"],ro={class:"ac-project-thumb"},io=Ze(()=>k("p",null,"\u65B0\u5EFA\u9879\u76EE",-1)),ao=X({setup(e){const[o,n]=Ee(ve,{isShowMessage:!1}),I=G(),{activeGroup:f}=W(I),u=w([]),g=w(),c=w(),h=w([]),b=E=>{h.value.push(E)},A=(E,_)=>{c.value.show(E.currentTarget,_)},P=()=>{g.value.show()},d=async()=>{await C()},C=async()=>{const{data:E}=await n(f.value.id);E&&(u.value=(E.projects||[]).map(_=>(_.isBlank=!1,_.publicHref=ge({project_id:_.id}),_.authority===Pe.READER&&(_.isBlank=!0,_.publicHref=ke({project_id:_.id})),_)))};return Z(()=>f.value,async()=>await C()),Se(()=>{h.value=[]}),ye(async()=>{await C()}),(E,_)=>{const L=r("router-link"),F=r("el-icon"),D=r("el-card"),y=Re("loading");return j(),R(B,null,[Oe((j(),N(D,{shadow:"never"},{header:s(()=>[k("div",eo,Y(V(f).name),1)]),default:s(()=>[k("div",oo,[(j(!0),R(B,null,x(u.value,i=>(j(),R("div",{class:"ac-project-item",key:i.id},[k("div",to,[t(L,{title:i.publicHref,to:{path:i.publicHref},target:i.isBlank?"_blank":"_self"},{default:s(()=>[k("img",{src:i.icon},null,8,so)]),_:2},1032,["title","to","target"]),k("span",{class:"ac-project-action",ref_for:!0,ref:b,onClick:U=>A(U,i)},[t(F,null,{default:s(()=>[t(V(Be))]),_:1})],8,no)]),k("p",{title:i.name,class:"ac-project-title truncate"},Y(i.name),9,lo)]))),128)),k("div",{class:"ac-project-item ac-project-new",onClick:P},[k("div",ro,[t(F,{size:26},{default:s(()=>[t(V(Ve))]),_:1})]),io])])]),_:1})),[[y,V(o)]]),t(He,{ref_key:"newProjectModal",ref:g,onOnOk:d},null,512),t(Xe,{ref_key:"projectDropmenu",ref:c,onChangeGroup:C,onDeleteProject:C,onQuitProject:C,"ignore-ele":h.value},null,8,["ignore-ele"])],64)}}});var fo=$(ao,[["__scopeId","data-v-7e014a70"]]);export{fo as default};
