var ue=Object.defineProperty,ne=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var x=(e,o,s)=>o in e?ue(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,g=(e,o)=>{for(var s in o||(o={}))ie.call(o,s)&&x(e,s,o[s]);if(j)for(var s of j(o))de.call(o,s)&&x(e,s,o[s]);return e},T=(e,o)=>ne(e,re(o));import{E as I,a as Z,I as me,J as pe,b as G,c as H,d as W,e as O,K as ce,L as fe,M as _e,H as he,v as be}from"./element-plus.ccbabc0c.js";import{K as N,r as F,a$ as Y,a5 as Q,x as X,ap as ee,o as c,Y as k,Z as l,$ as t,V as S,h as $,at as ge,W as P,aA as ve,ak as A,a0 as we,bn as ye,J as Ee,p as Ce,y as ke,T as Be,v,j as C,a1 as Fe,D as Se}from"./vendor.4578470d.js";import{A as D,a as oe,T as Me,c as se,d as Ve,u as $e,P as Ae,e as De}from"./index.7c9715bd.js";import{u as Le}from"./usePage.11ff97df.js";const Re=(e={})=>D.get("/team/members",{params:e}),Te=(e={})=>D.post("/team/add_member",e),Pe=(e={})=>D.post("/team/edit_member_info",e),Ue=(e={})=>D.post("/team/edit_member_password",e),qe=e=>D.post("/team/remove_member",{user_id:e}),z={name:"",email:"",password:"",authority:Ve.NORMAL},Ie=N({emits:["on-ok"],setup(e,{emit:o}){const s=F(),E=oe(),{isAdmin:w}=Y(E),a=Q({isEdit:!1,isShow:!1,isLoading:!1,form:g({},z)}),f={name:{required:!0,message:"\u8BF7\u8F93\u5165\u59D3\u540D"},password:{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"},email:{required:!0,type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:"blur"}},m=()=>{a.isShow=!1},r=()=>{var u;a.form=g({},z),(u=s.value)==null||u.resetFields()},i=()=>{var u;(u=s.value)==null||u.validate(b=>{if(b){a.isLoading=!0;let n=a.isEdit?Pe:Te;const L=g({},a.form);a.isEdit&&delete L.password,n(L).then(M=>{I.success(M.msg||(a.isEdit?"\u4FEE\u6539\u6210\u529F!":"\u6DFB\u52A0\u6210\u529F!")),m(),o("on-ok")}).catch(M=>{}).finally(()=>{a.isLoading=!1})}})};X(()=>a.isShow,()=>!a.isShow&&r());const _=u=>{var b;a.isEdit=u!==void 0,u&&(a.form=g({},u)),a.isShow=!0,(b=s.value)==null||b.clearValidate()};return T(g({isAdmin:w,rules:f},ee(a)),{TEAM_ROLE_LIST:Me,formRef:s,onCloseBtnClick:m,handleSubmit:i,show:_})}}),Oe=A("\u53D6\u6D88"),Ne=A("\u786E\u5B9A");function Ke(e,o,s,E,w,a){const f=W,m=Z,r=me,i=pe,_=G,u=O,b=H;return c(),k(b,{modelValue:e.isShow,"onUpdate:modelValue":o[4]||(o[4]=n=>e.isShow=n),width:400,"close-on-click-modal":!1,"append-to-body":"",class:"show-footer-line vertical-center-modal",title:(e.isEdit?"\u7F16\u8F91":"\u6DFB\u52A0")+"\u6210\u5458"},{footer:l(()=>[t(u,{onClick:e.onCloseBtnClick},{default:l(()=>[Oe]),_:1},8,["onClick"]),t(u,{loading:e.isLoading,type:"primary",onClick:e.handleSubmit},{default:l(()=>[Ne]),_:1},8,["loading","onClick"])]),default:l(()=>[t(_,{onKeyup:ve(e.handleSubmit,["enter"]),ref:"formRef",model:e.form,rules:e.rules,"label-position":"top"},{default:l(()=>[t(m,{label:"\u59D3\u540D",prop:"name",class:"hide_required"},{default:l(()=>[t(f,{modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=n=>e.form.name=n),placeholder:"\u59D3\u540D",maxlength:"100"},null,8,["modelValue"])]),_:1}),t(m,{label:"\u90AE\u7BB1",prop:"email",class:"hide_required"},{default:l(()=>[t(f,{modelValue:e.form.email,"onUpdate:modelValue":o[1]||(o[1]=n=>e.form.email=n),placeholder:"\u90AE\u7BB1",maxlength:"100"},null,8,["modelValue"])]),_:1}),e.isEdit?S("",!0):(c(),k(m,{key:0,label:"\u5BC6\u7801",prop:"password",class:"hide_required"},{default:l(()=>[t(f,{type:"password",modelValue:e.form.password,"onUpdate:modelValue":o[2]||(o[2]=n=>e.form.password=n),placeholder:"\u5BC6\u7801",maxlength:"100","show-password":""},null,8,["modelValue"])]),_:1})),e.isAdmin?(c(),k(m,{key:1,label:"\u6743\u9650",prop:"authority"},{default:l(()=>[t(i,{modelValue:e.form.authority,"onUpdate:modelValue":o[3]||(o[3]=n=>e.form.authority=n),placeholder:"\u9009\u62E9\u6743\u9650",class:"w-full"},{default:l(()=>[(c(!0),$(P,null,ge(e.TEAM_ROLE_LIST,n=>(c(),k(r,{value:n.value,key:n.value,label:n.text},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):S("",!0)]),_:1},8,["onKeyup","model","rules"])]),_:1},8,["modelValue","title"])}var je=se(Ie,[["render",Ke]]);const J={password:""},xe=N({setup(){const e=F();let o=null;const s=Q({isEdit:!1,isShow:!1,isLoading:!1,form:g({},J)}),E={password:{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}},w=()=>{s.isShow=!1},a=()=>{var r;s.form=g({},J),o=null,(r=e.value)==null||r.resetFields()},f=()=>{var r;(r=e.value)==null||r.validate(i=>{i&&o&&(s.isLoading=!0,Ue(T(g({},s.form),{user_id:o})).then(_=>{I.success(_.msg||"\u5BC6\u7801\u4FEE\u6539\u6210\u529F"),w()}).catch(_=>{}).finally(()=>{s.isLoading=!1}))})};X(()=>s.isShow,()=>!s.isShow&&a());const m=r=>{var i;s.isShow=!0,o=r,(i=e.value)==null||i.clearValidate()};return T(g({rules:E},ee(s)),{formRef:e,onCloseBtnClick:w,handleSubmit:f,show:m})}}),ze=A("\u53D6\u6D88"),Je=A("\u786E\u5B9A");function Ze(e,o,s,E,w,a){const f=W,m=Z,r=G,i=O,_=H;return c(),k(_,{modelValue:e.isShow,"onUpdate:modelValue":o[1]||(o[1]=u=>e.isShow=u),width:400,"close-on-click-modal":!1,"append-to-body":"",class:"show-footer-line vertical-center-modal",title:"\u4FEE\u6539\u6210\u5458\u5BC6\u7801"},{footer:l(()=>[t(i,{onClick:e.onCloseBtnClick},{default:l(()=>[ze]),_:1},8,["onClick"]),t(i,{loading:e.isLoading,type:"primary",onClick:e.handleSubmit},{default:l(()=>[Je]),_:1},8,["loading","onClick"])]),default:l(()=>[t(r,{onSubmit:we(e.handleSubmit,["prevent"]),ref:"formRef",model:e.form,rules:e.rules,"label-position":"top"},{default:l(()=>[t(m,{label:"\u65B0\u5BC6\u7801",prop:"password",class:"hide_required"},{default:l(()=>[t(f,{type:"password",modelValue:e.form.password,"onUpdate:modelValue":o[0]||(o[0]=u=>e.form.password=u),placeholder:"\u5BC6\u7801",maxlength:"100","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["onSubmit","model","rules"])]),_:1},8,["modelValue"])}var Ge=se(xe,[["render",Ze]]);const He={key:0,class:"absolute right-2",style:{top:"7px"}},We=A("\u6DFB\u52A0\u6210\u5458"),Ye=["onClick"],Qe=["onClick"],Xe=["onClick"],eo=["onClick"],oo=["onClick"],so=["onClick"],ro=N({setup(e){ye.configure({showSpinner:!1});const{page:o}=Le(()=>R()),[s,E]=$e(Re,{isShowMessage:!1}),w=oe(),{isAdmin:a,isManager:f,isNormal:m,userInfo:r}=Y(w),i=F(),_=F(),u=Ee([]),b=F(0),n=F(0),L=Ce(()=>"\u6210\u5458\u5217\u8868"+(b.value?`(${b.value})`:"")),M=y=>{De({title:"\u5220\u9664\u63D0\u793A",content:"\u786E\u5B9A\u79FB\u9664\u8BE5\u6210\u5458\u5417\uFF1F",onOk:()=>qe(y.user_id).then(d=>{I.success(d.msg||"\u79FB\u9664\u6210\u529F\uFF01"),R()})})},U=y=>{var d;(d=i.value)==null||d.show(y)},K=y=>{var d;(d=_.value)==null||d.show(y.user_id)},R=async()=>{const{data:y}=await E({page:o.value}),{members:d,total_members:q,total_page:B}=y||{};u.value=(d||[]).map(h=>(h.to={name:"member.detail",params:{uid:h.user_id}},h.isSelf=h.user_id===r.value.user_id,h.name=h.isSelf?`${h.name}(\u6211)`:h.name,h)),b.value=q||0,n.value=B||0};return ke(async()=>{await R()}),(y,d)=>{const q=O,B=ce,h=fe,te=_e,ae=he,le=be;return c(),$(P,null,[Be((c(),k(ae,{shadow:"never","body-style":{padding:0}},{header:l(()=>[C("span",null,Fe(v(L)),1),v(a)?(c(),$("div",He,[t(q,{type:"primary",onClick:d[0]||(d[0]=p=>U())},{default:l(()=>[We]),_:1})])):S("",!0)]),default:l(()=>[t(h,{data:v(u),class:"pb-3","header-row-class-name":"table__gray_header","empty-text":"\u6682\u65E0\u6210\u5458"},{default:l(()=>[t(B,{prop:"name",label:"\u59D3\u540D","show-overflow-tooltip":""}),t(B,{prop:"email",label:"\u90AE\u7BB1","show-overflow-tooltip":""}),t(B,{prop:"authority_name",label:"\u89D2\u8272"}),v(m)?S("",!0):(c(),k(B,{key:0,label:"\u64CD\u4F5C"},{default:l(({row:p})=>[!p.isSelf&&v(a)?(c(),$(P,{key:0},[C("span",{class:"text-blue-600 hover:text-blue-500 cursor-pointer mr-3",onClick:V=>K(p)},"\u4FEE\u6539\u5BC6\u7801",8,Ye),C("span",{class:"text-blue-600 hover:text-blue-500 cursor-pointer mr-3",onClick:V=>U(p)},"\u7F16\u8F91\u6210\u5458",8,Qe),C("span",{class:"text-red-500 hover:text-red-400 cursor-pointer",onClick:V=>M(p)},"\u79FB\u9664\u6210\u5458",8,Xe)],64)):S("",!0),!p.isSelf&&v(f)&&v(r).authority<p.authority?(c(),$(P,{key:1},[C("span",{class:"text-blue-600 hover:text-blue-500 cursor-pointer mr-3",onClick:V=>K(p)},"\u4FEE\u6539\u5BC6\u7801",8,eo),C("span",{class:"text-blue-600 hover:text-blue-500 cursor-pointer mr-3",onClick:V=>U(p)},"\u7F16\u8F91\u6210\u5458",8,oo),C("span",{class:"text-red-500 hover:text-red-400 cursor-pointer",onClick:V=>M(p)},"\u79FB\u9664\u6210\u5458",8,so)],64)):S("",!0)]),_:1}))]),_:1},8,["data"]),t(te,{class:"justify-end pb-3","page-size":v(Ae),layout:"prev, pager, next","current-page":v(o),"onUpdate:current-page":d[1]||(d[1]=p=>Se(o)?o.value=p:null),"page-count":n.value},null,8,["page-size","current-page","page-count"])]),_:1})),[[le,v(s)]]),t(je,{ref_key:"addMemberRef",ref:i,onOnOk:R},null,512),t(Ge,{ref_key:"modifyMemberPwdRef",ref:_},null,512)],64)}}});export{ro as default};
