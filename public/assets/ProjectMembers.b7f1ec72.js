var se=Object.defineProperty,re=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var W=(a,t,e)=>t in a?se(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,K=(a,t)=>{for(var e in t||(t={}))ie.call(t,e)&&W(a,e,t[e]);if(G)for(var e of G(t))ue.call(t,e)&&W(a,e,t[e]);return a},A=(a,t)=>re(a,le(t));import{b as I,u as ce,y as N,B as J,a as de,C as O,d as $,E as me,F as pe,G as fe,H as he,I as ge}from"./index.6adbff9a.js";import{a6 as y,ar as _e,o as u,c as b,U as ye,S,T as g,X as k,F as j,ai as B,M as H,_ as c,aC as be,a8 as ve,y as Se,d as z,ba as F,x as E,v,B as Ce,bp as D,r as w,be as ke,bg as we,Y as L,a as X,Z as Y,ak as je}from"./vendor.2ee35ec0.js";import{u as Pe}from"./usePage.9fa89480.js";import{a as Me,E as V}from"./element-plus.5b1d6711.js";const Le={name:"AcTable",props:{isShowIndex:{type:Boolean,default:!1},isShowSelection:{type:Boolean,default:!1},columns:{type:Array,default:()=>[]},tableData:{type:Array,default:()=>[]},pageSize:{type:Number,default:()=>15},pageTotal:{type:Number,default:()=>0},pageCount:{type:Number,default:()=>0},currentPage:{type:Number,default:()=>1},loading:{type:Boolean,default:!1},isShowPager:{type:Boolean,default:!0},emptyText:{type:String,default:"\u6682\u65E0\u6570\u636E"},dataKey:{type:Object,default:()=>({label:"title",prop:"key"})}},setup(a,t){const{emit:e}=t;return{handleSizeChange:r=>e("size-change",r),handleCurrentChange:r=>{e("update:currentPage",a.currentPage),e("current-change",r)},handleSelectionChange:r=>e("selection-change",r)}}},Te={class:"ac-table"},Be={key:0,class:"mt-4 flex justify-end"};function xe(a,t,e,p,n,d){const r=y("el-table-column"),f=y("el-table"),l=y("el-pagination"),_=_e("loading");return u(),b("div",Te,[ye((u(),S(f,{data:e.tableData,"empty-text":e.emptyText,onSelectionChange:p.handleSelectionChange},{default:g(()=>[e.isShowIndex?(u(),S(r,{key:0,type:"index",width:"50",label:"\u5E8F\u53F7"})):k("",!0),e.isShowSelection?(u(),S(r,{key:1,type:"selection",width:"55"})):k("",!0),(u(!0),b(j,null,B(e.columns,s=>(u(),b(j,{key:s.prop},[s[e.dataKey.label]&&!s.slot?(u(),S(r,{key:0,prop:s[e.dataKey.prop],"show-overflow-tooltip":"",label:s[e.dataKey.label],formatter:s.render||s.formatter,width:s.width},null,8,["prop","label","formatter","width"])):k("",!0),s.slot&&s[e.dataKey.label]?H(a.$slots,s.slot,{key:1}):k("",!0)],64))),128)),H(a.$slots,"operation")]),_:3},8,["data","empty-text","onSelectionChange"])),[[_,e.loading]]),e.isShowPager&&e.pageTotal?(u(),b("div",Be,[c(l,{"page-size":e.pageSize,layout:"prev, pager, next",total:e.pageTotal,"current-page":e.currentPage,"onUpdate:current-page":t[0]||(t[0]=s=>e.currentPage=s),onSizeChange:p.handleSizeChange,onCurrentChange:p.handleCurrentChange},null,8,["page-size","total","current-page","onSizeChange","onCurrentChange"])])):k("",!0)])}var Z=I(Le,[["render",xe]]);const Q=(a,t={isLoaded:!0,dataKey:"data",totalKey:"total"})=>{const{isLoaded:e=!0,searchParam:p={},dataKey:n,totalKey:d}=t,[r,f]=ce(a,{isShowMessage:!1}),l=ve({data:[],total:0}),{page:_}=Pe(()=>s()),s=async()=>{const m=await f(A(K({},p),{page:_.value}));m&&m.data?(l.data=m.data[n]||[],l.total=m.data[d]||1):(l.data=[],l.total=0)};return e&&Se(async()=>{await s()}),A(K({isLoading:r,currentPage:_},be(l)),{getTableData:s})};var Re=z({emits:["on-success"],setup(a,{emit:t}){const e=[{title:"\u59D3\u540D",key:"name"},{title:"\u90AE\u7BB1",key:"email"},{title:"\u89D2\u8272",render:m=>c("span",{class:"text dis_hover"},[m.authority_name])}],p={project_id:""},n=N(),{projectInfo:d}=F(n),{isLoading:r,total:f,currentPage:l,data:_,getTableData:s}=Q(J,{searchParam:p,totalKey:"total_members",dataKey:"project_members",isLoaded:!1});return E(()=>d.value,async()=>{d.value&&d.value.id&&(p.project_id=d.value.id,await s(),t("on-success",f.value||0))},{immediate:!0}),(m,o)=>{const P=Z;return u(),S(P,{loading:v(r),"table-data":v(_),"page-total":v(f),"current-page":v(l),"onUpdate:current-page":o[0]||(o[0]=C=>Ce(l)?l.value=C:null),columns:e,class:"pb-3"},null,8,["loading","table-data","page-total","current-page"])}}});D.configure({showSpinner:!1});var Ke=z({emits:["on-remove","on-success"],setup(a,{emit:t}){const e={project_id:""},p=N(),{projectInfo:n}=F(p),d=de(),r=w(),f=w(!1),l=w(),_=O,s=ke();let m=null;const{isLoading:o,currentPage:P,data:C,total:T,getTableData:x}=Q(J,{searchParam:e,totalKey:"total_members",dataKey:"project_members",isLoaded:!1}),ee=[{title:"\u59D3\u540D",key:"name"},{title:"\u90AE\u7BB1",key:"email"},{title:"\u89D2\u8272",render:i=>d.userInfo.user_id===i.user_id?c("span",null,[i.authority_name]):c("a",{class:"inline-flex items-center el-icon__more",onClick:h=>te(h,i),"data-role":i.authority,href:"javascript:void(0)"},[c("span",null,[i.authority_name]),c(y("el-icon"),null,{default:()=>[c(Me,null,null)]})])},{title:"\u64CD\u4F5C",width:160,render:i=>{if(i.authority===0)return[];let h=[];return i.authority!==2&&h.push(c("span",{class:"cursor-pointer text-blue-600 mr-2",onClick:()=>ae(i)},[L("\u79FB\u4EA4\u9879\u76EE")])),d.userInfo.user_id!==i.user_id&&h.push(c("span",{class:"cursor-pointer text-red-400",onClick:()=>oe(i)},[L("\u79FB\u9664\u6210\u5458")])),h}}],te=(i,h)=>{m=h,r.value=i.currentTarget,f.value=!0},ae=i=>{$({title:"\u79FB\u4EA4\u63D0\u793A",content:"\u786E\u5B9A\u5C06\u9879\u76EE\u79FB\u4EA4\u7ED9\u8BE5\u6210\u5458\u5417\uFF1F",onOk:h=>me(n.value.id,i.user_id).then(M=>{V.success(M.msg||"\u79FB\u4EA4\u6210\u529F\uFF01"),s.replace({name:"projects"})}).catch(()=>h())})},oe=i=>{$({title:"\u5220\u9664\u63D0\u793A",content:"\u786E\u5B9A\u79FB\u9664\u8BE5\u6210\u5458\u5417\uFF1F",onOk:()=>pe(n.value.id,i.user_id).then(h=>{V.success(h.msg||"\u79FB\u9664\u6210\u529F\uFF01"),t("on-remove"),x()})})},ne=i=>{D.start(),fe({authority:i.value,user_id:m.user_id,project_id:n.value.id}).then(h=>{V.success(h.msg||"\u6743\u9650\u4FEE\u6539\u6210\u529F\uFF01"),m.authority=i.value,m.authority_name=i.text}).catch(()=>{}).finally(()=>{D.done()})};return we(r,i=>{var U,q;const M=i.target.parentNode,R=M.parentNode;((U=M==null?void 0:M.classList)==null?void 0:U.contains("el-icon__more"))||((q=R==null?void 0:R.classList)==null?void 0:q.contains("el-icon__more"))||(f.value=!1)}),E(()=>n.value,async()=>{n.value&&n.value.id&&(e.project_id=n.value.id,await x(),t("on-success",T.value||0))},{immediate:!0}),{isLoading:o,roles:_,project:n,members:C,currentPage:P,total:T,columns:ee,popoverRef:l,isShowPopover:f,rolePopperRef:r,onRoleItemClick:ne,getTableData:x}}});const Ae=["onClick"];function Ve(a,t,e,p,n,d){const r=Z,f=y("el-popover");return u(),b(j,null,[c(r,{loading:a.isLoading,"table-data":a.members,"page-total":a.total,"current-page":a.currentPage,"onUpdate:current-page":t[0]||(t[0]=l=>a.currentPage=l),columns:a.columns,class:"pb-3"},null,8,["loading","table-data","page-total","current-page","columns"]),c(f,{ref:"popoverRef","popper-class":"ac-popper-menu",width:"auto",visible:a.isShowPopover,"onUpdate:visible":t[1]||(t[1]=l=>a.isShowPopover=l),"virtual-ref":a.rolePopperRef,"virtual-triggering":""},{default:g(()=>[X("ul",null,[(u(!0),b(j,null,B(a.roles,l=>(u(),b("li",{key:l.value,class:"ac-popper-menu__item",onClick:_=>a.onRoleItemClick(l)},Y(l.text),9,Ae))),128))])]),_:1},8,["visible","virtual-ref"])],64)}var Oe=I(Ke,[["render",Ve]]);const De={emits:["on-ok"],props:{members:{type:Array,default:()=>[]},project:{type:Object,default:()=>({})}},data(){return{isShow:!1,isLoading:!1,roles:O,form:{user_ids:[],authority:O[0].value},rules:{user_ids:{required:!0,message:"\u8BF7\u9009\u62E9\u9700\u8981\u6DFB\u52A0\u7684\u6210\u5458",trigger:"change",type:"array"}}}},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{show(a){this.form.project_id=a.id,this.isShow=!0},hide(){this.isShow=!1},onCloseBtnClick(){this.isShow=!1,this.reset()},reset(){this.$refs.teamForm.resetFields()},handleSubmit(a){this.$refs[a].validate(t=>t&&this.submit())},submit(){this.isLoading=!0,he(this.form).then(a=>{this.$Message.success(a.msg||"\u6DFB\u52A0\u6210\u5458\u6210\u529F!"),this.hide(),this.$emit("on-ok")}).catch(a=>{}).finally(()=>{this.isLoading=!1})}}},Ie=L("\u53D6\u6D88"),Ne=L("\u786E\u5B9A");function ze(a,t,e,p,n,d){const r=y("el-option"),f=y("el-select"),l=y("el-form-item"),_=y("el-form"),s=y("el-button"),m=y("el-dialog");return u(),S(m,{modelValue:n.isShow,"onUpdate:modelValue":t[5]||(t[5]=o=>n.isShow=o),width:340,"close-on-click-modal":!1,title:"\u6DFB\u52A0\u6210\u5458","append-to-body":"","custom-class":"show-footer-line vertical-center-modal"},{footer:g(()=>[c(s,{onClick:t[3]||(t[3]=o=>d.onCloseBtnClick())},{default:g(()=>[Ie]),_:1}),c(s,{loading:n.isLoading,type:"primary",onClick:t[4]||(t[4]=o=>d.handleSubmit("teamForm"))},{default:g(()=>[Ne]),_:1},8,["loading"])]),default:g(()=>[c(_,{onKeyup:t[2]||(t[2]=je(o=>d.handleSubmit("teamForm"),["enter"])),ref:"teamForm",model:n.form,rules:n.rules,"label-position":"top",style:{"margin-bottom":"-19px"}},{default:g(()=>[c(l,{label:"\u9009\u62E9\u6210\u5458",prop:"user_ids",class:"hide_required"},{default:g(()=>[c(f,{modelValue:n.form.user_ids,"onUpdate:modelValue":t[0]||(t[0]=o=>n.form.user_ids=o),placeholder:"\u9009\u62E9\u6210\u5458","no-data-text":"\u6682\u65E0\u6210\u5458",filterable:"",multiple:"",clearable:"",class:"w-full"},{default:g(()=>[(u(!0),b(j,null,B(e.members,o=>(u(),S(r,{value:o.user_id,key:o.user_id,label:o.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),c(l,{label:"\u6743\u9650",prop:"authority"},{default:g(()=>[c(f,{modelValue:n.form.authority,"onUpdate:modelValue":t[1]||(t[1]=o=>n.form.authority=o),class:"w-full"},{default:g(()=>[(u(!0),b(j,null,B(n.roles,o=>(u(),S(r,{value:o.value,key:o.value,label:o.text},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var Fe=I(De,[["render",ze]]);const Ee={key:0,class:"absolute right-2",style:{top:"7px"}},Ue=L("\u6DFB\u52A0\u6210\u5458");var Je=z({setup(a){const t=N(),{projectInfo:e}=F(t),p=w([]),n=w(),d=w(),r=w(0),f=()=>{var o;(o=n.value)==null||o.show(e.value)},l=async()=>{var o;(o=d.value)==null||o.getTableData(),await m()},_=async()=>{await m()},s=o=>{r.value=o},m=async()=>{const{authority:o,id:P}=e.value||{};if(o===0)try{const{data:C}=await ge(P);p.value=C||[]}catch{p.value=[]}};return E(()=>e.value,async()=>{e.value&&e.value.id&&await m()},{immediate:!0}),(o,P)=>{const C=y("el-button"),T=y("el-card");return u(),b(j,null,[c(T,{shadow:"never","body-style":{padding:0}},{header:g(()=>[X("span",null,"\u6210\u5458\u5217\u8868"+Y(r.value?`(${r.value})`:""),1),v(e)&&v(e).authority===0?(u(),b("div",Ee,[c(C,{onClick:f,type:"primary"},{default:g(()=>[Ue]),_:1})])):k("",!0)]),default:g(()=>[v(e)&&v(e).authority===0?(u(),S(Oe,{key:0,ref_key:"projectMembersManage",ref:d,onOnRemove:_,onOnSuccess:s},null,512)):k("",!0),v(e)&&v(e).authority!==0?(u(),S(Re,{key:1,onOnSuccess:s})):k("",!0)]),_:1}),c(Fe,{members:p.value,ref_key:"addProjectMemberModal",ref:n,onOnOk:l},null,8,["members"])],64)}}});export{Je as default};
