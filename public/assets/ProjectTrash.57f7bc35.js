import{au as h,a6 as u,o as b,S as C,T as l,_ as i,ak as x,Y as g,d as E,ba as T,r as f,x as B,ar as L,c as V,U as $,a as v,F as P,bp as y}from"./vendor.2ee35ec0.js";import{b as N,K as k,M as U,y as I,N as D,O as M,Q as O,U as R}from"./index.6adbff9a.js";import{E as j}from"./element-plus.5b1d6711.js";const A={emits:["on-ok"],data(){return{project_id:this.$route.params.project_id||"",isShow:!1,isLoading:!1,dir:[],form:{dir_id:[]},rules:{dir_id:{required:!0,min_len:1,message:"\u8BF7\u9009\u62E9\u5206\u7C7B",trigger:"change",type:"array"}}}},watch:{isShow:function(){!this.isShow&&this.reset()},"form.dir_id":function(){let t=this.form.dir_id.slice(-1)[0];t!==void 0&&(this.document.node_id=t)}},methods:{show(t){if(!t)throw new Error("\u6587\u6863\u4FE1\u606F\u4E0D\u80FD\u4E3A\u7A7A\uFF01");this.document=t,this.isShow=!0},hide(){this.isShow=!1},onCloseBtnClick(){this.isShow=!1,this.reset()},reset(){this.$refs.teamForm.resetFields()},handleSubmit(t){this.$refs[t].validate(e=>e&&this.submit())},submit(){this.isLoading=!0,k(this.document).then(t=>{this.onCloseBtnClick(),j({type:"success",closable:!0,message:h("span",null,["\u6587\u6863\u6062\u590D\u6210\u529F\uFF0C",h("a",{class:"text-blue-600",href:`/editor/${this.project_id}/doc/${this.document.doc_id}`},"\u67E5\u770B\u8BE6\u60C5")])}),this.$emit("on-ok")}).finally(()=>{this.isLoading=!1})},transferDir(t){let e=[],c=(m,o)=>{(m||[]).forEach(s=>{let _={value:s.id,label:s.title,children:[]};o.push(_),s.sub_nodes&&s.sub_nodes.length&&c(s.sub_nodes,_.children)})};return c(t,e),[{value:0,label:"\u6839\u76EE\u5F55"}].concat(e)},async getDocumentDirList(t){U(t).then(({data:e})=>{this.dir=this.transferDir(e)})}},mounted(){this.getDocumentDirList(this.project_id)}},K=g("\u6682\u65E0\u6570\u636E"),q=g(" \u53D6\u6D88 "),H=g(" \u786E\u5B9A ");function Q(t,e,c,m,o,s){const _=u("el-cascader"),p=u("el-form-item"),n=u("el-form"),r=u("el-button"),a=u("el-dialog");return b(),C(a,{modelValue:o.isShow,"onUpdate:modelValue":e[4]||(e[4]=d=>o.isShow=d),width:400,"custom-class":"show-footer-line vertical-center-modal","close-on-click-modal":!1,"append-to-body":"",title:"\u539F\u6587\u6863\u6240\u5728\u5206\u7C7B\u5DF2\u88AB\u5220\u9664\uFF0C\u8BF7\u9009\u62E9\u5176\u4ED6\u5206\u7C7B"},{footer:l(()=>[i(r,{onClick:e[2]||(e[2]=d=>s.onCloseBtnClick())},{default:l(()=>[q]),_:1}),i(r,{loading:o.isLoading,type:"primary",onClick:e[3]||(e[3]=d=>s.handleSubmit("teamForm"))},{default:l(()=>[H]),_:1},8,["loading"])]),default:l(()=>[i(n,{ref:"teamForm",model:o.form,rules:o.rules,"label-position":"top",style:{"margin-bottom":"-19px"},onKeyup:e[1]||(e[1]=x(d=>s.handleSubmit("teamForm"),["enter"]))},{default:l(()=>[i(p,{label:"",prop:"dir_id",class:"hide_required"},{default:l(()=>[i(_,{modelValue:o.form.dir_id,"onUpdate:modelValue":e[0]||(e[0]=d=>o.form.dir_id=d),class:"w-full",options:o.dir,props:{checkStrictly:!0},placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B"},{empty:l(()=>[K]),_:1},8,["modelValue","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var Y=N(A,[["render",Q]]);const z=v("span",null,"\u56DE\u6536\u7AD9",-1),G=["href"],J=["onClick"],te=E({setup(t){const e=I(),{projectInfo:c}=T(e),m=f(),o=f([]),s=f(!1),_=n=>{y.start();const r={project_id:e.projectInfo.id,doc_id:n.id};k(r).then(({status:a})=>{if(a===D.NO_PARENT_DIR){m.value&&m.value.show(r);return}a===D.OK&&(j({type:"success",showClose:!0,message:()=>h("span",null,["\u6587\u6863\u6062\u590D\u6210\u529F\uFF0C",h("a",{class:"text-blue-600",href:`/editor/${e.projectInfo.id}/doc/${n.id}`},"\u67E5\u770B\u8BE6\u60C5")])}),p())}).catch(a=>{}).finally(()=>{y.done()})},p=async()=>{s.value=!0;try{const{data:n}=await M(e.projectInfo.id);o.value=(n||[]).map(r=>(r.remaining=O(r.deleted_at)+"\u5929",r.previewUrl=R({project_id:e.projectInfo.id,doc_id:r.id}),r))}catch{}finally{s.value=!1}};return B(()=>c.value,async()=>{c.value&&c.value.id&&await p()},{immediate:!0}),(n,r)=>{const a=u("el-table-column"),d=u("el-table"),S=u("el-card"),F=L("loading");return b(),V(P,null,[$((b(),C(S,{shadow:"never","body-style":{padding:0}},{header:l(()=>[z]),default:l(()=>[i(d,{data:o.value,"empty-text":"\u6682\u65E0\u6570\u636E"},{default:l(()=>[i(a,{prop:"title",label:"\u6587\u6863\u540D\u79F0","show-overflow-tooltip":""}),i(a,{prop:"deleted_at",label:"\u5220\u9664\u65F6\u95F4"}),i(a,{prop:"remaining",label:"\u5269\u4F59"}),i(a,{label:"\u64CD\u4F5C"},{default:l(({row:w})=>[v("a",{class:"cursor-pointer mr-3 text-blue-600",target:"_blank",href:w.previewUrl},"\u9884\u89C8",8,G),v("span",{class:"cursor-pointer mr-3 text-blue-600",href:"javascript:void(0)",onClick:W=>_(w)},"\u6062\u590D",8,J)]),_:1})]),_:1},8,["data"])]),_:1})),[[F,s.value]]),i(Y,{ref_key:"restoreDocumentModal",ref:m,onOnOk:p},null,512)],64)}}});export{te as default};
