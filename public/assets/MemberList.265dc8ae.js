var se=Object.defineProperty,te=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var j=(e,o,s)=>o in e?se(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,v=(e,o)=>{for(var s in o||(o={}))ae.call(o,s)&&j(e,s,o[s]);if(K)for(var s of K(o))ue.call(o,s)&&j(e,s,o[s]);return e},U=(e,o)=>te(e,le(o));import{d as O,r as S,ba as G,a8 as J,x as X,aC as Y,a6 as r,o as f,S as F,T as a,_ as t,X as M,c as A,ai as ne,F as P,ak as re,Y as D,a5 as ie,bp as de,J as me,p as pe,y as ce,U as fe,v as w,ar as _e,a as B,Z as he,B as be}from"./vendor.2ee35ec0.js";import{A as R,a as H,T as ge,b as Q,c as ve,u as we,P as ye,d as Ce}from"./index.6adbff9a.js";import{E as I}from"./element-plus.5b1d6711.js";import{u as ke}from"./usePage.9fa89480.js";const Be=(e={})=>R.get("/team/members",{params:e}),Fe=(e={})=>R.post("/team/add_member",e),Ee=(e={})=>R.post("/team/edit_member_info",e),Se=(e={})=>R.post("/team/edit_member_password",e),Me=e=>R.post("/team/remove_member",{user_id:e}),z={name:"",email:"",password:"",authority:ve.NORMAL},Ve=O({emits:["on-ok"],setup(e,{emit:o}){const s=S(),k=H(),{isAdmin:y}=G(k),l=J({isEdit:!1,isShow:!1,isLoading:!1,form:v({},z)}),_={name:{required:!0,message:"\u8BF7\u8F93\u5165\u59D3\u540D"},password:{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"},email:{required:!0,type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:"blur"}},p=()=>{l.isShow=!1},i=()=>{var u;l.form=v({},z),(u=s.value)==null||u.resetFields()},d=()=>{var u;(u=s.value)==null||u.validate(g=>{if(g){l.isLoading=!0;let n=l.isEdit?Ee:Fe;const L=v({},l.form);l.isEdit&&delete L.password,n(L).then(V=>{I.success(V.msg||(l.isEdit?"\u4FEE\u6539\u6210\u529F!":"\u6DFB\u52A0\u6210\u529F!")),p(),o("on-ok")}).catch(V=>{}).finally(()=>{l.isLoading=!1})}})};X(()=>l.isShow,()=>!l.isShow&&i());const h=u=>{var g;l.isEdit=u!==void 0,u&&(l.form=v({},u)),l.isShow=!0,(g=s.value)==null||g.clearValidate()};return U(v({isAdmin:y,rules:_},Y(l)),{TEAM_ROLE_LIST:ge,formRef:s,onCloseBtnClick:p,handleSubmit:d,show:h})}}),$e=D("\u53D6\u6D88"),Ae=D("\u786E\u5B9A");function De(e,o,s,k,y,l){const _=r("el-input"),p=r("el-form-item"),i=r("el-option"),d=r("el-select"),h=r("el-form"),u=r("el-button"),g=r("el-dialog");return f(),F(g,{modelValue:e.isShow,"onUpdate:modelValue":o[4]||(o[4]=n=>e.isShow=n),width:400,"close-on-click-modal":!1,"append-to-body":"","custom-class":"show-footer-line vertical-center-modal",title:(e.isEdit?"\u7F16\u8F91":"\u6DFB\u52A0")+"\u6210\u5458"},{footer:a(()=>[t(u,{onClick:e.onCloseBtnClick},{default:a(()=>[$e]),_:1},8,["onClick"]),t(u,{loading:e.isLoading,type:"primary",onClick:e.handleSubmit},{default:a(()=>[Ae]),_:1},8,["loading","onClick"])]),default:a(()=>[t(h,{onKeyup:re(e.handleSubmit,["enter"]),ref:"formRef",model:e.form,rules:e.rules,"label-position":"top"},{default:a(()=>[t(p,{label:"\u59D3\u540D",prop:"name",class:"hide_required"},{default:a(()=>[t(_,{modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=n=>e.form.name=n),placeholder:"\u59D3\u540D",maxlength:"100"},null,8,["modelValue"])]),_:1}),t(p,{label:"\u90AE\u7BB1",prop:"email",class:"hide_required"},{default:a(()=>[t(_,{modelValue:e.form.email,"onUpdate:modelValue":o[1]||(o[1]=n=>e.form.email=n),placeholder:"\u90AE\u7BB1",maxlength:"100"},null,8,["modelValue"])]),_:1}),e.isEdit?M("",!0):(f(),F(p,{key:0,label:"\u5BC6\u7801",prop:"password",class:"hide_required"},{default:a(()=>[t(_,{type:"password",modelValue:e.form.password,"onUpdate:modelValue":o[2]||(o[2]=n=>e.form.password=n),placeholder:"\u5BC6\u7801",maxlength:"100","show-password":""},null,8,["modelValue"])]),_:1})),e.isAdmin?(f(),F(p,{key:1,label:"\u6743\u9650",prop:"authority"},{default:a(()=>[t(d,{modelValue:e.form.authority,"onUpdate:modelValue":o[3]||(o[3]=n=>e.form.authority=n),placeholder:"\u9009\u62E9\u6743\u9650",class:"w-full"},{default:a(()=>[(f(!0),A(P,null,ne(e.TEAM_ROLE_LIST,n=>(f(),F(i,{value:n.value,key:n.value,label:n.text},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):M("",!0)]),_:1},8,["onKeyup","model","rules"])]),_:1},8,["modelValue","title"])}var Re=Q(Ve,[["render",De]]);const Z={password:""},Le=O({setup(){const e=S();let o=null;const s=J({isEdit:!1,isShow:!1,isLoading:!1,form:v({},Z)}),k={password:{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}},y=()=>{s.isShow=!1},l=()=>{var i;s.form=v({},Z),o=null,(i=e.value)==null||i.resetFields()},_=()=>{var i;(i=e.value)==null||i.validate(d=>{d&&o&&(s.isLoading=!0,Se(U(v({},s.form),{user_id:o})).then(h=>{I.success(h.msg||"\u5BC6\u7801\u4FEE\u6539\u6210\u529F"),y()}).catch(h=>{}).finally(()=>{s.isLoading=!1}))})};X(()=>s.isShow,()=>!s.isShow&&l());const p=i=>{var d;s.isShow=!0,o=i,(d=e.value)==null||d.clearValidate()};return U(v({rules:k},Y(s)),{formRef:e,onCloseBtnClick:y,handleSubmit:_,show:p})}}),Te=D("\u53D6\u6D88"),Ue=D("\u786E\u5B9A");function Pe(e,o,s,k,y,l){const _=r("el-input"),p=r("el-form-item"),i=r("el-form"),d=r("el-button"),h=r("el-dialog");return f(),F(h,{modelValue:e.isShow,"onUpdate:modelValue":o[1]||(o[1]=u=>e.isShow=u),width:400,"close-on-click-modal":!1,"append-to-body":"","custom-class":"show-footer-line vertical-center-modal",title:"\u4FEE\u6539\u6210\u5458\u5BC6\u7801"},{footer:a(()=>[t(d,{onClick:e.onCloseBtnClick},{default:a(()=>[Te]),_:1},8,["onClick"]),t(d,{loading:e.isLoading,type:"primary",onClick:e.handleSubmit},{default:a(()=>[Ue]),_:1},8,["loading","onClick"])]),default:a(()=>[t(i,{onSubmit:ie(e.handleSubmit,["prevent"]),ref:"formRef",model:e.form,rules:e.rules,"label-position":"top"},{default:a(()=>[t(p,{label:"\u65B0\u5BC6\u7801",prop:"password",class:"hide_required"},{default:a(()=>[t(_,{type:"password",modelValue:e.form.password,"onUpdate:modelValue":o[0]||(o[0]=u=>e.form.password=u),placeholder:"\u5BC6\u7801",maxlength:"100","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["onSubmit","model","rules"])]),_:1},8,["modelValue"])}var qe=Q(Le,[["render",Pe]]);const Ne={key:0,class:"absolute right-2",style:{top:"7px"}},Oe=D("\u6DFB\u52A0\u6210\u5458"),Ie=["onClick"],xe=["onClick"],Ke=["onClick"],je=["onClick"],ze=["onClick"],Ze=["onClick"],Qe=O({setup(e){de.configure({showSpinner:!1});const{page:o}=ke(()=>T()),[s,k]=we(Be,{isShowMessage:!1}),y=H(),{isAdmin:l,isManager:_,isNormal:p,userInfo:i}=G(y),d=S(),h=S(),u=me([]),g=S(0),n=S(0),L=pe(()=>"\u6210\u5458\u5217\u8868"+(g.value?`(${g.value})`:"")),V=C=>{Ce({title:"\u5220\u9664\u63D0\u793A",content:"\u786E\u5B9A\u79FB\u9664\u8BE5\u6210\u5458\u5417\uFF1F",onOk:()=>Me(C.user_id).then(m=>{I.success(m.msg||"\u79FB\u9664\u6210\u529F\uFF01"),T()})})},q=C=>{var m;(m=d.value)==null||m.show(C)},x=C=>{var m;(m=h.value)==null||m.show(C.user_id)},T=async()=>{const{data:C}=await k({page:o.value}),{members:m,total_members:N,total_page:E}=C||{};u.value=(m||[]).map(b=>(b.to={name:"member.detail",params:{uid:b.user_id}},b.isSelf=b.user_id===i.value.user_id,b.name=b.isSelf?`${b.name}(\u6211)`:b.name,b)),g.value=N||0,n.value=E||0};return ce(async()=>{await T()}),(C,m)=>{const N=r("el-button"),E=r("el-table-column"),b=r("el-table"),W=r("el-pagination"),ee=r("el-card"),oe=_e("loading");return f(),A(P,null,[fe((f(),F(ee,{shadow:"never","body-style":{padding:0}},{header:a(()=>[B("span",null,he(w(L)),1),w(l)?(f(),A("div",Ne,[t(N,{type:"primary",onClick:m[0]||(m[0]=c=>q())},{default:a(()=>[Oe]),_:1})])):M("",!0)]),default:a(()=>[t(b,{data:w(u),class:"pb-3","header-row-class-name":"table__gray_header","empty-text":"\u6682\u65E0\u6210\u5458"},{default:a(()=>[t(E,{prop:"name",label:"\u59D3\u540D","show-overflow-tooltip":""}),t(E,{prop:"email",label:"\u90AE\u7BB1","show-overflow-tooltip":""}),t(E,{prop:"authority_name",label:"\u89D2\u8272"}),w(p)?M("",!0):(f(),F(E,{key:0,label:"\u64CD\u4F5C"},{default:a(({row:c})=>[!c.isSelf&&w(l)?(f(),A(P,{key:0},[B("span",{class:"text-blue-600 hover:text-blue-500 cursor-pointer mr-3",onClick:$=>x(c)},"\u4FEE\u6539\u5BC6\u7801",8,Ie),B("span",{class:"text-blue-600 hover:text-blue-500 cursor-pointer mr-3",onClick:$=>q(c)},"\u7F16\u8F91\u6210\u5458",8,xe),B("span",{class:"text-red-500 hover:text-red-400 cursor-pointer",onClick:$=>V(c)},"\u79FB\u9664\u6210\u5458",8,Ke)],64)):M("",!0),!c.isSelf&&w(_)&&w(i).authority<c.authority?(f(),A(P,{key:1},[B("span",{class:"text-blue-600 hover:text-blue-500 cursor-pointer mr-3",onClick:$=>x(c)},"\u4FEE\u6539\u5BC6\u7801",8,je),B("span",{class:"text-blue-600 hover:text-blue-500 cursor-pointer mr-3",onClick:$=>q(c)},"\u7F16\u8F91\u6210\u5458",8,ze),B("span",{class:"text-red-500 hover:text-red-400 cursor-pointer",onClick:$=>V(c)},"\u79FB\u9664\u6210\u5458",8,Ze)],64)):M("",!0)]),_:1}))]),_:1},8,["data"]),t(W,{class:"justify-end pb-3","page-size":w(ye),layout:"prev, pager, next","current-page":w(o),"onUpdate:current-page":m[1]||(m[1]=c=>be(o)?o.value=c:null),"page-count":n.value},null,8,["page-size","current-page","page-count"])]),_:1})),[[oe,w(s)]]),t(Re,{ref_key:"addMemberRef",ref:d,onOnOk:T},null,512),t(qe,{ref_key:"modifyMemberPwdRef",ref:h},null,512)],64)}}});export{Qe as default};
